---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0110.html
next: f_0112.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.problem.chars">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 78</td>
<td class="arr-recipe-name">Escape Problem Characters</td>
</tr>
</table>
<p id="N1884A" class="calibre4">
<span class="calibre5">
        The <code class="cf">\V</code> literal switch makes it easier to search for text verbatim because it disables the special meanings for the <code class="cf">.</code>, <code class="cf">+</code>, and <code class="cf">*</code> symbols, but there are a few characters whose special meaning can’t be turned off. In this advanced tip, we’ll look at how to handle these.
    </span>
</p>
<h3 class="calibre22">Escape <code class="cf2">/</code> Characters When Searching Forward</h3>
<p id="N18872" class="calibre4">
      Take this excerpt from a Markdown document (the true URL is at vimdoc.sourceforge.net,<a id="FNPTR-22" href="#FOOTNOTE-22">[22]</a> but it has been abbreviated here to fit):
    </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/patterns/search-url.markdown">patterns/search-url.markdown</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Search items: [http://vimdoc.net/search?q=/\\][s]​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​...​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​[s]: http://vimdoc.net/search?q=/\\​</code>​</div>
</td>
</tr>
</table>
<p id="N1889B" class="calibre4">
      Suppose that we want to search for all instances of the URL <code class="cf">http://vimdoc.net/search?q=/\\</code>. Rather than typing it out in full, we’ll just yank it into a register so that we can paste it into our search field. We want to match this text exactly as is, so we’ll use the <code class="cf">\V</code> literal switch.
    </p>
<p id="N188A4" class="calibre4">
      With our cursor placed anywhere inside the brackets, we can yank the URL into register <code class="cf">u</code> with the command <span class="calibre17">"uyi[</span> (mnemonic: <span class="calibre5">u</span> stands for <span class="calibre5">URL</span>). We then type <code class="cf">/\V&lt;C-r&gt;u</code>
<span class="calibre17">&lt;CR&gt;</span> to populate the search field with the contents of that same register. Our search prompt looks like this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/\Vhttp://vimdoc.net/search?q=/\\</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N188D8" class="calibre4">
      When we execute the search, we get this result:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Search items: [<span class="shade-fg-black">http:</span>//vimdoc.net/search?q=/\\][s]​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​...​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​[s]: <span class="shade-fg-black">http:</span>//vimdoc.net/search?q=/\\​</code>​</div>
</td>
</tr>
</table>
<p id="N188F6" class="calibre4">
      What’s going on here? When we pasted the full URL into the search field, Vim interpreted the first <code class="cf">/</code> character as a search field terminator (see <a xmlns:str="http://exslt.org/strings" href="#sidebar.terminators">​<em class="calibre5">Search Field Terminators</em>​</a>). Everything after that first forward slash was ignored, so our search string became merely <code class="cf">http:</code>.
    </p>
<p id="N18903" class="calibre4">
      When searching forward, we have to escape <code class="cf">/</code> characters. This is required whether we are doing a <code class="cf">very magic</code> search (with the <code class="cf">\v</code> pattern switch) or a <code class="cf">very nomagic</code> search (with the <code class="cf">\V</code> literal switch). Let’s amend the previous search, prefixing each <code class="cf">/</code> character with a backslash:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/\Vhttp:\/\/vimdoc.net\/search?q=\/\\</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N18925" class="calibre4">
      This time, the result is closer to what we would expect:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Search items: [<span class="shade-fg-black">http://vimdoc.net/search?q=/\</span>\][s]​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​...​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​[s]: <span class="shade-fg-black">http://vimdoc.net/search?q=/\</span>\​</code>​</div>
</td>
</tr>
</table>
<p id="N18943" class="calibre4">
      It’s still not perfect. The match stops short of the final backslash. We’ll find out why soon, but first, let’s consider searching backward.
    </p>
<h3 class="calibre22">Escape <code class="cf2">?</code> Characters When Searching Backward</h3>
<p id="N1894D" class="calibre4">
      When searching backward, the <code class="cf">?</code> symbol acts as the search field terminator. That means we don’t have to escape <code class="cf">/</code> characters, but instead we have to escape the <code class="cf">?</code> symbol. Watch what happens if we search backward for the URL that we yanked into register <code class="cf">u</code>:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">?http://vimdoc.net/search?q=/\\</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N18970" class="calibre4">
      Without escaping anything, Vim matches the string “http://vimdoc.net/search”:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Search items: [<span class="shade-fg-black">http://vimdoc.net/search</span>?q=/\\][s]​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​...​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​[s]: <span class="shade-fg-black">http://vimdoc.net/search</span>?q=/\\​</code>​</div>
</td>
</tr>
</table>
<p id="N18993" class="calibre4">
      That’s a better result than when we searched forward without escaping anything, but it still doesn’t match the full URL. We can do better if we prepend the <code class="cf">?</code> character with a backslash:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">?http://vimdoc.net/search\?q=/\\</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N189A6" class="calibre4">
      That matches the following:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Search items: [<span class="shade-fg-black">http://vimdoc.net/search?q=/\</span>\][s]​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​...​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​[s]: <span class="shade-fg-black">http://vimdoc.net/search?q=/\</span>\​</code>​</div>
</td>
</tr>
</table>
<h3 class="calibre22">Escape <code class="cf2">\</code> Characters Every Time</h3>
<p id="N189CB" class="calibre4">
      There’s one more character that we have to escape in the search field: the backslash. Normally, a <code class="cf">\</code> indicates that the next character is to be given some special treatment. If we double it up as <code class="cf">\\</code>, the first backslash cancels out the special meaning of the second one. In effect, we’re telling Vim to search for a single backslash character.
    </p>
<p id="N189E3" class="calibre4">
      In our example text, we’re searching for a URL that includes two consecutive backslashes. We have to include two backslashes in the search field for each of them. Searching forward, we end up with this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/\Vhttp:\/\/vimdoc.net\/search?q=\/\\\\</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N189F3" class="calibre4">
      At last! Our search query matches the entire URL:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Search items: [<span class="shade-fg-black">http://vimdoc.net/search?q=/\\</span>][s]​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​...​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​[s]: <span class="shade-fg-black">http://vimdoc.net/search?q=/\\</span>​</code>​</div>
</td>
</tr>
</table>
<p id="N18A10" class="calibre4">
      The backslash character always needs to be escaped, whether we’re searching forward or backward.
    </p>
<h3 class="calibre22">Escape Characters Programmatically</h3>
<p id="N18A17" class="calibre4">
      Escaping characters by hand is laborious, error-prone work. Fortunately, Vim script includes a library function that can do the hard work for us: <code class="cf">escape({string}, {chars})</code> (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">escape()</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/eval.html#escape()">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>).
    </p>
<p id="N18A2D" class="calibre4">
      The <code class="cf">{chars}</code> argument specifies which characters must be escaped with a backslash. If we’re searching forward, we could call <code class="cf">escape(@u, ’/\’)</code>, which would prefix each <code class="cf">/</code> and <code class="cf">\</code> character with a backslash. If we were searching backward, we could instead call <code class="cf">escape(@u, ’?\’)</code>.
    </p>
<p id="N18A3F" class="calibre4">
      First, make sure that the URL we want to search for is still stored in the <code class="cf">u</code> register. Then we’ll bring up the search prompt by pressing <code class="cf">/</code> or <code class="cf">?</code>; either one will work just fine. Enter the <code class="cf">\V</code> literal switch and then type <span class="calibre17">&lt;C-r&gt;=</span>. That switches from the search prompt to the expression register prompt. Now we type this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">=escape(@u, getcmdtype().'\')</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N18A5E" class="calibre4">
      When we press <span class="calibre17">&lt;CR&gt;</span>, the <code class="cf">escape()</code> function is evaluated, and the returned value gets inserted into the search field. The <code class="cf">getcmdtype()</code> function simply returns a <code class="cf">/</code> symbol if we’re searching forward or a <code class="cf">?</code> symbol if we’re searching backward (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">getcmdtype()</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/eval.html#getcmdtype()">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). In Vim script, the <code class="cf">.</code> operator performs string concatenation, so <code class="cf">getcmdtype().’\’</code> produces “/\” if we’re searching forward and <code class="cf">?\</code> if we’re searching backward. The end result is that no matter which way we’re searching, this expression escapes the contents of the <code class="cf">u</code> register so that we can find it.
    </p>
<p id="N18A80" class="calibre4">
      Switching to the expression register and calling the <code class="cf">escape()</code> function by hand still involves a lot of typing. With just a little bit more Vim script, we could automate this, making it more convenient to use. Skip ahead to <a xmlns:str="http://exslt.org/strings" href="f_0120.html#sec.visual.star">Tip 86</a>, for an example.
	  </p>
<div class="sidebar" id="sidebar.terminators">
<div class="sidebar-title">Search Field Terminators</div>
<div class="calibre1">
<p id="N18A95" class="calibre4">
      You might be wondering why the search field has to treat any character as a terminator. Why not just accept that everything following the search prompt is to be included in the search match? The behavior of Vim’s search command can be tuned by appending certain flags after the search field terminator. For example, if we run the command <code class="cf1">/vim/e</code>
<span class="calibre17">&lt;CR&gt;</span>, then our cursor will be placed at the <span class="calibre5">end</span> of any matches rather than at the start. In <a xmlns:str="http://exslt.org/strings" href="f_0117.html#sec.search.offsets">Tip 83</a>, we’ll learn how to exploit this feature rather than let it exploit us.
    </p>
<p id="N18AA9" class="calibre4">
      There is one way of entering a pattern without having to worry about search field terminators, but it works only in GVim: use the <code class="cf1">:promptfind</code> command (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">:promptfind</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/change.html#:promptfind">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). This brings up a graphical dialog window with a field labeled “Find.” You can enter the <code class="cf1">/</code> and <code class="cf1">?</code> characters here without having to escape them. However, the <code class="cf1">\</code> and newline characters still cause problems.
    </p>
</div>
</div>

<div class="footnotes">
<h4 class="calibre20">Footnotes</h4>
<table cellspacing="3" class="table-of-contents">
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-20" href="f_0108.html#FNPTR-20">[20]</a>
</td>
<td class="calibre8">
<p id="N18553" class="calibre4">
<a href="http://matt.might.net/articles/shell-scripts-for-passive-voice-weasel-words-duplicates/">http://matt.might.net/articles/shell-scripts-for-passive-voice-weasel-words-duplicates/</a>
</p>
</td>
</tr>
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-21" href="f_0110.html#FNPTR-21">[21]</a>
</td>
<td class="calibre8">
<p id="N1877C" class="calibre4">
<a href="http://www.regular-expressions.info/lookaround.html">http://www.regular-expressions.info/lookaround.html</a>
</p>
</td>
</tr>
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-22" href="#FNPTR-22">[22]</a>
</td>
<td class="calibre8">
<p id="N18882" class="calibre4">
<a href="http://vimdoc.sourceforge.net/search.php?search=/\\&amp;docs=help">http://vimdoc.sourceforge.net/search.php?search=/\\&amp;docs=help</a>
</p>
</td>
</tr>
</table>
</div>
<div class="copyright">Copyright © 2012, The Pragmatic Bookshelf.</div>




<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

