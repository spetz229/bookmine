---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0135.html
next: f_0137.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.alphabetize.css">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 100</td>
<td class="arr-recipe-name">Alphabetize the Properties of Each Rule in a CSS File</td>
</tr>
</table>
<p id="N1A5CA" class="calibre4">
<span class="calibre5">
        When combining an Ex command with <code class="cf">:global</code>, we can also specify a range for our chosen <code class="cf">[cmd]</code>. Vim allows us to set the range dynamically using the <code class="cf">:g/{pattern}</code> as a reference point. Here we’ll see how we can exploit this fact to alphabetize the properties within each block of a CSS file.
    </span>
</p>
<p id="N1A5F7" class="calibre4">
      We’ll use this CSS file for demonstration purposes:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/global/unsorted.css">global/unsorted.css</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>Line 1 </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">html</strong> { ​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  margin: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  padding: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  border: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>5 </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  font-size: 100%;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  font: inherit;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  vertical-align: baseline;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">body</strong> { ​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>10 </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  line-height: 1.5;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  color: black;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  background: white;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>- </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
</table>
<p id="N1A640" class="calibre4">
      Suppose that we want to sort the properties of each rule into alphabetical order. We could do so using Vim’s built-in <code class="cf">:sort</code> command (<strong xmlns:str="http://exslt.org/strings" class="calibre10">:sort</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/change.html#:sort">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>).
    </p>
<h3 class="calibre22">Sort Properties for a Single Block of Rules</h3>
<p id="N1A653" class="calibre4">
        Let’s start by trying out the <code class="cf">:sort</code> command on a subset of the file. (See <a xmlns:str="http://exslt.org/strings" href="#table.sort-subset">Table 27, ​<em class="calibre5">Sort a Subset of a File</em>​</a>.)
      </p>
<hr class="calibre37"/>
<div class="figurecaption" id="table.sort-subset">Table 27. Sort a Subset of a File</div>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Keystrokes</th>
<th class="hlines">Buffer Contents</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<code class="cf">{start}</code>
</p>
</td>
<td class="calibre24">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​html <span class="shade-fg-white">{</span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​  margin: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​  padding: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​  border: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​  font-size: 100%;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​  font: inherit;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​  vertical-align: baseline;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">vi{</span>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​html {​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">  margin: 0; </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">  padding: 0; </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">  border: 0; </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">  font-size: 100%; </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">  font: inherit; </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">  vertical-align: baseline;<span class="shade-fg-white"> </span>
</span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:’&lt;,’&gt;sort</code>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​html {​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​  <span class="shade-fg-white">b</span>order: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​  font-size: 100%;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​  font: inherit;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​  margin: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​  padding: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​  vertical-align: baseline;​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<hr class="calibre37"/>
<p id="N1A6FD" class="calibre4">
        We can easily select the lines inside a <code class="cf">{}</code> block using the <span class="calibre17">vi{</span> text object. Running <code class="cf">:’&lt;,’&gt;sort</code> then rearranges the lines into alphabetical order. This technique works great if we just have to sort one block of rules at a time, but suppose that we had a style sheet containing hundreds of rules. Wouldn’t it be better if we could automate the process somehow?
      </p>
<h3 class="calibre22">Sort Properties for Every Block of Rules</h3>
<p id="N1A712" class="calibre4">
        We can sort the properties for every block of rules in the file with a single <code class="cf">:global</code> command. Say we run this command on our style sheet:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:g/{/ .+1,/}/-1 sort</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A725" class="calibre4">
        We should end up with this result:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">html</strong> {​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  border: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  font-size: 100%;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  font: inherit;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  margin: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  padding: 0;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  vertical-align: baseline;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">body</strong> {​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  background: white;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  color: black;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  line-height: 1.5;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
</table>
<p id="N1A75E" class="calibre4">
        The sort command has been executed inside the <code class="cf">{}</code> block for each rule. Our sample style sheet only contains a dozen lines, but this technique would work just as well for a longer CSS file.
      </p>
<p id="N1A764" class="calibre4">
        This command is complex, but understanding how it works will help us to appreciate just how powerful the <code class="cf">:global</code> command can be. The standard form looks like this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​:g/{pattern}/[cmd]​</code>​</div>
</td>
</tr>
</table>
<p id="N1A775" class="calibre4">
        Remember: Ex commands can usually accept a range themselves (as discussed in <a xmlns:str="http://exslt.org/strings" href="f_0050.html#sec.ex.address">Tip 28</a>). This is still true for the <code class="cf">[cmd]</code> in the context of a <code class="cf">:global</code> command. So we could expand the template as follows:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​:g/{pattern}/[range][cmd]​</code>​</div>
</td>
</tr>
</table>
<p id="N1A78D" class="calibre4">
        The <code class="cf">[range]</code> for our <code class="cf">[cmd]</code> can be set dynamically using the match from <code class="cf">:g/{pattern}</code> as a reference point. Normally the <code class="cf">.</code> address stands for the line that the cursor is positioned on. But in the context of a <code class="cf">:global</code> command, it stands for each line in turn that matches the specified <code class="cf">{pattern}</code>.
      </p>
<p id="N1A7A2" class="calibre4">
        We can break our command into two separate Ex commands. Let’s work our way backward from the end. This is a valid Ex command:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:.+1,/}/-1 sort</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A7B2" class="calibre4">
        If we strip out the offsets from our range, it becomes simply <code class="cf">.,/}/</code>. We can interpret this as “from the current line up until the next line that matches the <code class="cf">/}/</code> pattern.” The <code class="cf">+1</code> and <code class="cf">-1</code> offsets simply narrow the range to focus on the contents of the <code class="cf">{}</code> block. If we place our cursor on either line 1 or line 9 of our original unsorted CSS file, then this Ex command would alphabetize the rules inside the corresponding <code class="cf">{}</code> block.
      </p>
<p id="N1A7CD" class="calibre4">
        We just need to position our cursor at the start of each <code class="cf">{}</code> block and then run the <code class="cf">:.,/}/sort</code> command to alphabetize the rules inside that block. Got that? Now try executing a search using the <code class="cf">{pattern}</code> from our <code class="cf">:global</code> command:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/{/</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A7E9" class="calibre4">
        That places our cursor at the top of a <code class="cf">{}</code> block, right where we need it. Now let’s put our <code class="cf">:global</code> and <code class="cf">[cmd]</code> Ex commands back together:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:g/{/ .+1,/}/-1 sort</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A802" class="calibre4">
        The <code class="cf">{</code> pattern matches the first line of each <code class="cf">{}</code> block. For every line that matches, the <code class="cf">:sort</code> command is executed on a <code class="cf">[range]</code> that terminates at the end of the <code class="cf">{}</code> block. The end result is that all CSS properties are alphabetized within each block of rules.
      </p>
<h3 class="calibre22">Discussion</h3>
<p id="N1A818" class="calibre4">
        A generalized form of this <code class="cf">:global</code> command goes like this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​:g/{start}/ .,{finish} [cmd]​</code>​</div>
</td>
</tr>
</table>
<p id="N1A829" class="calibre4">
        We can read this as “For each range of lines beginning with <code class="cf">{start}</code> and ending with <code class="cf">{finish}</code>, run the specified <code class="cf">[cmd]</code>.”
      </p>
<p id="N1A835" class="calibre4">
        We could use the same formula for a <code class="cf">:global</code> command in combination with any Ex command. For example, suppose that we wanted to indent the specified ranges. We could do so with the <code class="cf">:&gt;</code> Ex command (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">:&gt;</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/change.html#:%3E">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>):
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:g/{/ .+1,/}/-1 &gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​6 lines &gt;ed 1 time​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​3 lines &gt;ed 1 time​</code>​</div>
</td>
</tr>
</table>
<p id="N1A85D" class="calibre4">
        Note that the <code class="cf">:&gt;</code> command echoes a message each time it is invoked, whereas <code class="cf">:sort</code> doesn’t. We can mute these messages by prefixing our <code class="cf">[cmd]</code> with <code class="cf">:silent</code> (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">:sil</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/various.html#:sil">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>):
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:g/{/sil .+1,/}/-1 &gt;</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A88B" class="calibre4">
        This technique is especially useful in cases where the <code class="cf">:g/{pattern}</code> matches a large number of lines.
		</p>

<div class="copyright">Copyright © 2012, The Pragmatic Bookshelf.</div>




<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

