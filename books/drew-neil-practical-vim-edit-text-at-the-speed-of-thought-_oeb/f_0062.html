---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0061.html
next: f_0063.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.hide">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 38</td>
<td class="arr-recipe-name">Manage Hidden Files</td>
</tr>
</table>
<p id="N13D79" class="calibre4">
<span class="calibre5">
        When a buffer has been modified, Vim gives it special treatment to ensure that we don’t accidentally quit the editor without saving our changes. Find out how to hide a modified buffer and how to handle hidden buffers when quitting Vim.
    </span>
</p>
<p id="N13D89" class="calibre4">
      Run these commands in the shell to launch Vim:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ cd code/files</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ ls</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​a.txt     b.txt​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ vim *.txt</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​2 files to edit​</code>​</div>
</td>
</tr>
</table>
<p id="N13DAB" class="calibre4">
      Let’s make a change to <code class="cf">a.txt</code>: we’ll just press <span class="calibre17">Go</span> to append a blank line at the end of the buffer. Without saving the changes, let’s examine the buffer list:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:ls</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​1 %a + "a.txt"                        line 1​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​2      "b.txt"                        line 0​</code>​</div>
</td>
</tr>
</table>
<p id="N13DC8" class="calibre4">
      The buffer representing <code class="cf">a.txt</code> is annotated with a <code class="cf">+</code> sign, which indicates that it has been modified. If we were to save the file now, the contents of the buffer would be written to disk and the <code class="cf">+</code> annotation would go away. But let’s not save the buffer just yet. Instead, we’ll try to switch to the next buffer:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:bnext</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​E37: No write since last change (add ! to override)​</code>​</div>
</td>
</tr>
</table>
<p id="N13DE5" class="calibre4">
	Vim raises an error message, reporting that the current buffer contains unsaved changes. Let’s try following the advice in parentheses and add a trailing bang symbol:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:bnext!</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:ls</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​1 #h + "a.txt"                        line 1​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​2 %a   "b.txt"                        line 1​</code>​</div>
</td>
</tr>
</table>
<p id="N13E0B" class="calibre4">
	The bang symbol forces Vim to switch buffers, even if our current buffer has unsaved changes. When we run the <code class="cf">:ls</code> command now, <code class="cf">b.txt</code> is marked with the letter <code class="cf">a</code> for <span class="calibre5">active</span>, while <code class="cf">a.txt</code> is marked with the letter <code class="cf">h</code> for <span class="calibre5">hidden</span>.
    </p>
<h3 class="calibre22">Handle Hidden Buffers on Quit</h3>
<p id="N13E2D" class="calibre4">
        When a buffer is hidden, Vim lets us go about our business as usual. We can open other buffers, change them, save them, and so on, all without consequences—that is, right up until we attempt to close our editing session. That’s when Vim reminds us that we have unsaved changes in one of our buffers:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:quit</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​E37: No write since last change (add ! to override)​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​E162: No write since last change for buffer "a.txt"​</code>​</div>
</td>
</tr>
</table>
<p id="N13E53" class="calibre4">
      Vim loads the first hidden buffer with modifications into the current window so that we can decide what to do with it. If we want to keep the changes, we can run <code class="cf">:write</code> to save the buffer to a file. Or if we want to discard the changes, we can instead run <code class="cf">:edit!</code>, which rereads the file from disk, overwriting the contents of the buffer. Having reconciled the contents of the buffer with the file on disk, we can try the <code class="cf">:quit</code> command again.
    </p>
<p id="N13E73" class="calibre4">
      If we have more than one hidden buffer with modifications, then Vim activates the next unsaved buffer each time we enter the <code class="cf">:quit</code> command. Again, we could <code class="cf">:write</code> or <code class="cf">:edit!</code> to keep or discard the changes. This cycle continues until we make a decision for each of the hidden buffers with modifications. When there are no more windows and no more hidden modified buffers, the <code class="cf">:q</code> command closes Vim.
    </p>
<p id="N13E82" class="calibre4">
      If we want to quit Vim without reviewing our unsaved changes, we can issue the <code class="cf">:qall!</code> command. Or, if we want to write all modified buffers without reviewing them one by one, we can use the <code class="cf">:wall</code> command. <a xmlns:str="http://exslt.org/strings" href="#table.hidden-buffers-on-quit">Table 11, ​<em class="calibre5">Options for Hidden Buffers on Quit</em>​</a> summarizes our options.
    </p>
<hr class="calibre37"/>
<div class="figurecaption" id="table.hidden-buffers-on-quit">Table 11. Options for Hidden Buffers on Quit</div>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Command</th>
<th class="hlines">Effect</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<code class="cf">:w[rite]</code>
</p>
</td>
<td class="calibre24">
<p class="last-para-in-cell">Write the contents of the buffer to disk</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:e[dit]!</code>
</p>
</td>
<td class="calibre26">
<p class="last-para-in-cell">Read the file from disk back into the buffer (that is, revert changes)</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:qa[ll]!</code>
</p>
</td>
<td class="calibre26">
<p class="last-para-in-cell">Close all windows, discarding changes without warning</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:wa[ll]</code>
</p>
</td>
<td class="calibre26">
<p class="last-para-in-cell">Write all modified buffers to disk</p>
</td>
</tr>
</tbody>
</table>
<hr class="calibre37"/>
<h3 id="sec.hidden" class="calibre22">Enable the ‘hidden’ Setting Before Running ‘:argdo’ or ‘:bufdo’</h3>
<p id="N13ED0" class="calibre4">
        By default, Vim prevents us from abandoning a modified buffer. Whether we use the <code class="cf">:next!</code>, <code class="cf">:bnext!</code>, <code class="cf">:cnext!</code>, or any similar command, if we omit the trailing bang symbol, Vim will nag us with the “No write since last change” error message. In most cases, this message is a useful reminder. But in one scenario it becomes a nuisance.
      </p>
<p id="N13EF0" class="calibre4">
        Consider the <code class="cf">:argdo</code> and <code class="cf">:bufdo</code> commands. The <code class="cf">:argdo {cmd}</code> command works like this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:first</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:{cmd}</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:next</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:{cmd}</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​etc.​</code>​</div>
</td>
</tr>
</table>
<p id="N13F1C" class="calibre4">
        If our chosen <code class="cf">{cmd}</code> modifies the first buffer, the <code class="cf">:next</code> command will fail. Vim won’t permit us to advance to the second item in the argument list until we save the changes to the first item in the list. That’s not much use!
      </p>
<p id="N13F25" class="calibre4">
        If we enable the <code class="cf">‘hidden’</code> setting (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">'hidden'</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/options.html#'hidden'">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>), then we can use the <code class="cf">:next</code>, <code class="cf">:bnext</code>, <code class="cf">:cnext</code> (and so on) commands without a trailing bang. If the active buffer is modified, Vim will automatically hide it when we navigate away from it. The <code class="cf">‘hidden’</code> setting makes it possible to use <code class="cf">:argdo</code> and <code class="cf">:bufdo</code> to change a collection of buffers with a single command.
      </p>
<p id="N13F41" class="calibre4">
        After running <code class="cf">:argdo {cmd}</code>, we’ll want to save the changes that were made to each item in the argument list. We could do it one at a time by running <code class="cf">:first</code> and then <code class="cf">:wn</code>, which would give us the opportunity to eyeball each file. Or if we’re confident that everything is in order, we could run <code class="cf">:argdo write</code> (or <code class="cf">:wall</code>) to save all buffers.
      </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

