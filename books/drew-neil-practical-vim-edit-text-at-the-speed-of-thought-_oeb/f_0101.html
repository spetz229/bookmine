---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0100.html
next: f_0102.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.macro.increment">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 70</td>
<td class="arr-recipe-name">Evaluate an Iterator to Number Items in a List</td>
</tr>
</table>
<p id="N17BFE" class="calibre4">
<span class="calibre5">
        Being able to insert a value that changes for each execution of a macro can be useful. In this tip, we’ll learn a technique for incrementing a number as we record a macro so that we can insert the numbers 1 to 5 on consecutive lines.
    </span>
</p>
<p id="N17C1A" class="calibre4">
      Suppose that we want to create a numbered list from a series of items on adjacent lines. To demonstrate, we’ll start with this text:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/macros/incremental.txt">macros/incremental.txt</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​partridge in a pear tree​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​turtle doves​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​French hens​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​calling birds​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​golden rings​</code>​</div>
</td>
</tr>
</table>
<p id="N17C36" class="calibre4">
      We’ll transform it to look like this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​1) partridge in a pear tree​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​2) turtle doves​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​3) French hens​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​4) calling birds​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​5) golden rings​</code>​</div>
</td>
</tr>
</table>
<p id="N17C50" class="calibre4">
      We’ve already learned a couple of ways to make Vim perform simple arithmetic. We can either use the <span class="calibre17">&lt;C-a&gt;</span> and <span class="calibre17">&lt;C-x&gt;</span> commands with a count (see <a xmlns:str="http://exslt.org/strings" href="f_0029.html#sec.count.arithmetic">Tip 10</a>), or we can use the expression register (see <a xmlns:str="http://exslt.org/strings" href="f_0036.html#sec.insert.expression">Tip 16</a>). For this solution, we’ll use the expression register with a touch of Vim script.
    </p>
<h3 class="calibre22">Rudimentary Vim Script</h3>
<p id="N17C65" class="calibre4">
        Let’s begin by stepping through a few simple command-line invocations. Using the <code class="cf">let</code> keyword, we can create a variable called <code class="cf">i</code> and assign it a value of 0. The <code class="cf">:echo</code> command allows us to inspect the current value assigned to a variable.
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:let i=0</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:echo i</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​0​</code>​</div>
</td>
</tr>
</table>
<p id="N17C97" class="calibre4">
        We can increment the value of <code class="cf">i</code>:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:let i += 1</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:echo i</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​1​</code>​</div>
</td>
</tr>
</table>
<p id="N17CB3" class="calibre4">
        The <code class="cf">:echo</code> command is fine for revealing the value that is assigned to a variable, but ideally we want to insert that value into the document. We can do that using the expression register. In <a xmlns:str="http://exslt.org/strings" href="f_0036.html#sec.insert.expression">Tip 16</a>, we saw that the expression register can be used to do simple sums and to insert the result into the document. We can insert the value stored in variable <code class="cf">i</code> just by running <span class="calibre17">&lt;C-r&gt;=i&lt;CR&gt;</span> in Insert mode.
      </p>
<h3 class="calibre22">Record the Macro</h3>
<p id="N17CC7" class="calibre4">
        Now let’s put all of this together:
      </p>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Keystrokes</th>
<th class="hlines">Buffer Contents</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<code class="cf">:let i=1</code>
</p>
</td>
<td class="calibre24">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-white">p</span>artridge in a pear tree​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">qa</span>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-white">p</span>artridge in a pear tree​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">I&lt;C-r&gt;=</span>
<code class="cf">i</code>
<span class="calibre17">&lt;CR&gt;</span>
<code class="cf">) &lt;Esc&gt;</code>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​1)<span class="shade-fg-white"> </span>partridge in a pear tree​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:let i += 1</code>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​1)<span class="shade-fg-white"> </span>partridge in a pear tree​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">q</span>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​1)<span class="shade-fg-white"> </span>partridge in a pear tree​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<p id="N17D53" class="calibre4">
        Before we begin recording the macro, we set the variable <code class="cf">i</code> to 1. Inside the macro, we use the expression register to insert the value stored in <code class="cf">i</code>. Then, before we finish recording the macro, we increment the value stored in the variable, which should now contain the value 2.
      </p>
<h3 class="calibre22">Execute the Macro</h3>
<p id="N17D6E" class="calibre4">
        We can then play it back for the remaining lines, as shown in <a xmlns:str="http://exslt.org/strings" href="#table.execute-macro">Table 19, ​<em class="calibre5">Executing the Macro for the Remaining Lines</em>​</a>.
      </p>
<hr class="calibre37"/>
<div class="figurecaption" id="table.execute-macro">Table 19. Executing the Macro for the Remaining Lines</div>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Keystrokes</th>
<th class="hlines">Buffer Contents</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<code class="cf">{start}</code>
</p>
</td>
<td class="calibre24">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​1)<span class="shade-fg-white"> </span>partridge in a pear tree​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​turtle doves​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​French hens​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​calling birds​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​golden rings​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">jVG</span>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​1) partridge in a pear tree​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">turtle doves </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">French hens </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">calling birds </span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">
<span class="shade-fg-white">g</span>olden rings </span>​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:’&lt;,’&gt;normal @a</code>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​1) partridge in a pear tree​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​2) turtle doves​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​3) French hens​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​4) calling birds​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​5)<span class="shade-fg-white"> </span>golden rings​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<hr class="calibre37"/>
<p id="N17DF7" class="calibre4">
        The <code class="cf">:normal @a</code> command tells Vim to execute the macro on each of the selected lines (see <a xmlns:str="http://exslt.org/strings" href="f_0098.html#sec.macro.lines.parallel">​<em class="calibre5">Execute Macro in Parallel</em>​</a>). The value of <code class="cf">i</code> is 2 to begin with, but it gets incremented each time the macro executes. The end result is that each line is prefixed with consecutive digits.
		</p>
<p id="N17E0C" class="calibre4">
      We could also use the yank, put, and <span class="calibre17">&lt;C-a&gt;</span> commands to accomplish this same task. Try it yourself for exercise!
    </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

