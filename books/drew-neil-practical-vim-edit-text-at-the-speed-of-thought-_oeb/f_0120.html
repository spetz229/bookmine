---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0119.html
next: f_0121.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.visual.star">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 86</td>
<td class="arr-recipe-name">Search for the Current Visual Selection</td>
</tr>
</table>
<p id="N193C1" class="calibre4">
<span class="calibre5">
        In Normal mode, the <span class="calibre17">*</span> command lets us search for the word under the cursor. Using a small amount of Vim script, we can redefine the <span class="calibre17">*</span> command in Visual mode so that, instead of searching for the current word, it searches for the current selection.
    </span>
</p>
<h3 class="calibre22">Search for the Current Word in Visual Mode</h3>
<p id="N193E0" class="calibre4">
        In Visual mode, the <span class="calibre17">*</span> command searches for the word under the cursor. Observe:
      </p>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Keystrokes</th>
<th class="hlines">Buffer Contents</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<code class="cf">{start}</code>
</p>
</td>
<td class="calibre24">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">She sells se<span class="shade-fg-white">a</span>
</span> shells by the sea shore.​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">*</span>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-black">She sells sea shells by the <span class="shade-fg-white">s</span>
</span>ea shore.​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<p id="N19432" class="calibre4">
        We start off in Visual mode with the first three words selected and our cursor placed on the word “sea.” When we invoke the <span class="calibre17">*</span> command, it searches forward for the next occurrence of the word “sea,” extending the range of the visual selection. Although this behavior is consistent with the Normal mode <span class="calibre17">*</span> command, I rarely find it useful.
      </p>
<p id="N1943B" class="calibre4">
        Before I became hooked on Vim, I used another text editor, which included a “Use selection for find” command. I had the keyboard shortcut for this burned into my fingers and used it all the time. When I switched to Vim, I was surprised to find that it didn’t have such a feature. It always felt to me that triggering the <span class="calibre17">*</span> command from Visual mode should search for the current selection, not the current word.
        With a small amount of Vim script, we can add this feature to Vim.
      </p>
<h3 class="calibre22">Search for the Current Selection (Prior Art)</h3>
<p id="N19445" class="calibre4">
        If you look up <strong xmlns:str="http://exslt.org/strings" class="calibre10">visual-search</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/visual.html#visual-search">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>, you’ll find this suggestion:
      </p>
<blockquote class="pg-partintro">
<p id="N19457" class="calibre4">
          Here is an idea for a mapping that makes it possible to do a search for the selected text:
        </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​:vmap X y/&lt;C-R&gt;"&lt;CR&gt;​</code>​</div>
</td>
</tr>
</table>
<p id="N19465" class="calibre4">
          Note that special characters (like “.” and “*”) will cause problems.
        </p>
</blockquote>
<p id="N19468" class="calibre4">
        The <span class="calibre17">y</span> command yanks the current visual selection, and 
        <code class="cf">/&lt;C-r&gt;"</code>
<span class="calibre17">&lt;CR&gt;</span>
        brings up the search prompt, pastes the contents of the default register, and then executes the search. That solution is simple, but as the cautionary note in Vim’s documentation says, it has limitations.
      </p>
<p id="N19473" class="calibre4">
        In <a xmlns:str="http://exslt.org/strings" href="f_0111.html#sec.problem.chars">Tip 78</a>, we learned how to overcome these limitations. Now let’s put that theory into practice and create a mapping that searches for the current selection without being derailed by special characters.
      </p>
<h3 class="calibre22">Search for the Current Selection (Redux)</h3>
<p id="N1947E" class="calibre4">
        This snippet of Vim script does the trick:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/patterns/visual-star.vim">patterns/visual-star.vim</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">xnoremap</strong> * :<em class="string">&lt;C-u&gt;</em>
<strong class="prompt">call</strong> <em class="string">&lt;SID&gt;</em>VSetSearch()<em class="string">&lt;CR&gt;</em>/<em class="string">&lt;C-R&gt;</em>=@/<em class="string">&lt;CR&gt;&lt;CR&gt;</em>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">xnoremap</strong> # :<em class="string">&lt;C-u&gt;</em>
<strong class="prompt">call</strong> <em class="string">&lt;SID&gt;</em>VSetSearch()<em class="string">&lt;CR&gt;</em>?<em class="string">&lt;C-R&gt;</em>=@/<em class="string">&lt;CR&gt;&lt;CR&gt;</em>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">function</strong>! s:VSetSearch()​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">let</strong> temp = @s​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  norm! gv"sy​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">let</strong> @/ = <em class="string">'\V'</em> . substitute(escape(@s, <em class="string">'/\'</em>), <em class="string">'\n'</em>, <em class="string">'\\n'</em>, <em class="string">'g'</em>)​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">let</strong> @s = temp​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">endfunction</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N194E4" class="calibre4">
        You can either paste this into your <code class="cf">vimrc</code> file directly or install the visual star search plugin.<a id="FNPTR-24" href="#FOOTNOTE-24">[24]</a>
</p>
<p id="N194EF" class="calibre4">
        As well as overriding the <span class="calibre17">*</span> command, we’ve customized the <span class="calibre17">#</span> command, which searches backward for selected text. The <code class="cf">xnoremap</code> keyword specifies that the mappings should apply to Visual mode but not to Select mode (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">mapmode-x</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/map.html#mapmode-x">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>).
		</p>

<div class="footnotes">
<h4 class="calibre20">Footnotes</h4>
<table cellspacing="3" class="table-of-contents">
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-23" href="f_0118.html#FNPTR-23">[23]</a>
</td>
<td class="calibre8">
<p id="N19144" class="calibre4">
<a href="http://github.com/kana/vim-textobj-lastpat">http://github.com/kana/vim-textobj-lastpat</a>
</p>
</td>
</tr>
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-24" href="#FNPTR-24">[24]</a>
</td>
<td class="calibre8">
<p id="N194EB" class="calibre4">
<a href="https://github.com/nelstrom/vim-visual-star-search">https://github.com/nelstrom/vim-visual-star-search</a>
</p>
</td>
</tr>
</table>
</div>
<div class="copyright">Copyright © 2012, The Pragmatic Bookshelf.</div>




<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

