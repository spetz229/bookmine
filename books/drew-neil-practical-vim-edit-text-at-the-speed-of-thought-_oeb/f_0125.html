---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0124.html
next: f_0126.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.substitute.lastpat">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 90</td>
<td class="arr-recipe-name">Reuse the Last Search Pattern</td>
</tr>
</table>
<p id="N198CB" class="calibre4">
<span class="calibre5">
        Leaving the search field of the substitute command blank instructs Vim to reuse the most recent search pattern. We can exploit this fact to streamline our workflow.
    </span>
</p>
<p id="N198DD" class="calibre4">
      Let’s face it: to execute a substitute command, we have to do a lot of typing. First we specify the range, then we fill out the pattern and replacement fields, and finally we append any necessary flags. That’s a lot to think about, and making a mistake in any of these fields could change the outcome.
    </p>
<p id="N198E0" class="calibre4">
      Here’s the good news: leaving the search field blank tells Vim to use the current pattern.
    </p>
<p id="N198E3" class="calibre4">
      Take this monolithic substitute command (from <a xmlns:str="http://exslt.org/strings" href="f_0119.html#sec.search.iterate">Tip 85</a>):
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:%s/\v'(([^']|'\w)+)'/“\1”/g</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N198F7" class="calibre4">
      It’s equivalent to these two separate commands:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/\v'(([^']|'\w)+)'</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:%s//“\1”/g</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1990C" class="calibre4">
      So what? One way or another, we’ll still have to type out the full pattern, right? That’s not the point. The substitute command involves two steps: composing a pattern and devising a suitable replacement string. This technique allows us to decouple those two tasks.
    </p>
<p id="N1990F" class="calibre4">
      When composing a nontrivial regular expression, it usually takes a few attempts to get it right. If we were to test our pattern by executing a substitute command, we would change the document each time we tried it out. That’s messy. When we execute a search command, the document is not changed, so we can make as many mistakes as we like. In <a xmlns:str="http://exslt.org/strings" href="f_0119.html#sec.search.iterate">Tip 85</a>, we see an effective workflow for building regular expressions. Separating the two tasks allows for a cleaner workflow. We can measure twice and cut once.
    </p>
<p id="N1991B" class="calibre4">
      Besides, who says we have to type out the pattern? In <a xmlns:str="http://exslt.org/strings" href="f_0120.html#sec.visual.star">Tip 86</a>, we used a smidgen of Vim script to add a Visual mode equivalent of the <span class="calibre17">*</span> command. This mapping allows us to select any text in our document and then hit the <span class="calibre17">*</span> key to search for the selection. We could then run the substitute command with an empty search field to replace our selection (and any similar matches) with something else. Talk about being lazy!
    </p>
<h3 class="calibre22">It’s Not Always Appropriate</h3>
<p id="N1992C" class="calibre4">
        I’m not saying that you should never fill out the search field of the substitute command. Here, for example, we have a substitute command that joins every line of a file by replacing newlines with commas:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:%s/\n/,</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1993C" class="calibre4">
        It’s such a simple command that you won’t gain anything by splitting it in two. In fact, doing so would probably add work.
      </p>
<h3 class="calibre22">Implications for Command History</h3>
<p id="N19943" class="calibre4">
        Another point to consider is that leaving the search field blank creates an incomplete record in our command history. Patterns are saved in Vim’s search history, while substitute commands are saved in the history of Ex commands (<strong xmlns:str="http://exslt.org/strings" class="calibre10">cmdline-history</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html#cmdline-history">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). Decoupling the search and replacement tasks causes the two pieces of information to be placed in separate silos, which could cause difficulty if you want to reuse an old substitute command later.
      </p>
<p id="N1994F" class="calibre4">
        If you think that you’ll want to recall a substitute command in its complete form from history, you can always fill out the search field explicitly. Pressing <span class="calibre17">&lt;C-r&gt;/</span> at the command line pastes the contents of the last search register in place. Typing out the following would create a complete entry in our command history:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:%s/&lt;C-r&gt;//“\1”/g</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N19962" class="calibre4">
        Sometimes leaving the search field of the substitute command blank is convenient. Other times it’s not. Try both ways, and you’ll develop an intuition for whether or not to use it. As always, use your judgment.
      </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

