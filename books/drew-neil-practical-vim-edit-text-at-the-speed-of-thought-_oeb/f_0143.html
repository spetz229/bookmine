---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0142.html
next: f_0144.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="N1AEC4">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 104</td>
<td class="arr-recipe-name">Compile Code Without Leaving Vim</td>
</tr>
</table>
<p id="N1AECB" class="calibre4">
<span class="calibre5">
        Calling an external compiler from Vim saves us from having to leave our editor—and if the compiler reports any errors, Vim provides the means for us to jump between them quickly.
    </span>
</p>
<h3 class="calibre22">Preparation</h3>
<p id="N1AEE5" class="calibre4">
        We’ll use a small C program to demonstrate. The source files are distributed with this book (for more details, refer to <a xmlns:str="http://exslt.org/strings" href="f_0013.html#sec.download.source">​<em class="calibre5">Downloading the Examples</em>​</a>). In the shell, change to the <code class="cf">code/quickfix/wakeup</code> directory:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ cd code/quickfix/wakeup</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1AEFC" class="calibre4">
        You’ll need <code class="cf">gcc</code> to build this program, but don’t feel that you need to install a compiler just to follow this tip. The workflow here demonstrates the task for which the quickfix list was originally conceived (and from which it takes its name). As we’ll soon see, this feature has many other uses.
      </p>
<h3 class="calibre22">Compile the Project in the Shell</h3>
<p id="N1AF06" class="calibre4">
        The <code class="cf">wakeup</code> program provided consists of three files: <code class="cf">Makefile</code>, <code class="cf">wakeup.c</code>, and <code class="cf">wakeup.h</code>. From the shell, we could compile it by running <code class="cf">make</code>:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ make</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​gcc    -c -o wakeup.o wakeup.c​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​wakeup.c:68: error: conflicting types for ‘generatePacket’​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​wakeup.h:3: error: previous declaration of ‘generatePacket’ was here​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​make: *** [wakeup.o] Error 1​</code>​</div>
</td>
</tr>
</table>
<p id="N1AF3D" class="calibre4">
        The compiler helpfully reports a couple of errors. It’s all very well having this information printed in the terminal, but now we need to navigate to each of the errors so that we can fix them in Vim.
      </p>
<h3 class="calibre22">Compile the Project from Inside Vim</h3>
<p id="N1AF44" class="calibre4">
        Instead of running <code class="cf">make</code> in the shell, let’s try building the project from inside Vim. 
        Make sure that you’re in the <code class="cf">code/quickfix/wakeup</code> directory and that it includes a <code class="cf">Makefile</code> file, and then launch Vim like this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​$ pwd; ls​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​~/code/quickfix/wakeup​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Makefile wakeup.c wakeup.h ​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ vim -u NONE -N wakeup.c</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1AF67" class="calibre4">
        From inside Vim, we can now run the <code class="cf">:make</code> command:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:make</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​gcc    -c -o wakeup.o wakeup.c​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​wakeup.c:68: error: conflicting types for ‘generatePacket’​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​wakeup.h:3: error: previous declaration of ‘generatePacket’ was here​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​make: *** [wakeup.o] Error 1​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Press ENTER or type command to continue​</code>​</div>
</td>
</tr>
</table>
<p id="N1AF92" class="calibre4">
        We get the same result as when we ran <code class="cf">make</code> in the shell—except that Vim does something smart with the output. Instead of just echoing the output from <code class="cf">make</code>, Vim parses each line, extracting the filename, line number, and error message. For each warning, Vim creates a record in the quickfix list. We can navigate backward and forward through these records, and Vim jumps to the exact line corresponding to the error message. As Vim’s documentation on quickfix says (<strong xmlns:str="http://exslt.org/strings" class="calibre10">quickfix</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/quickfix.html#quickfix">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>), it allows us to “speed up the edit-compile-edit cycle.”
      </p>
<p id="N1AF9F" class="calibre4">
        Vim jumps to the first record in the quickfix list when we run <code class="cf">:make</code>. In our case, we should find ourselves in the file <code class="cf">wakeup.c</code> at the top of this function:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">void</strong> generatePacket(uint8_t *mac, uint8_t *packet)​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​{​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">int</strong> i, j, k;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  k = 6;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">for</strong> (i = 0; i &lt;= 15; i++)​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  {​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">for</strong> (j = 0; j &lt;= 5; j++, k++)​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    {​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​      packet[k] = mac[j];​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    }​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  }​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​}​</code>​</div>
</td>
</tr>
</table>
<p id="N1AFE0" class="calibre4">
        The error message reports “<code class="cf">conflicting types for ‘generatePacket’</code>.” We can skip to the next location in the quickfix list by running the command <code class="cf">:cnext</code>. In this case, we jump to the file <code class="cf">wakeup.h</code> and find ourselves on this line:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">void</strong> generatePacket(<strong class="prompt">char</strong> *, <strong class="prompt">char</strong> *);​</code>​</div>
</td>
</tr>
</table>
<p id="N1B000" class="calibre4">
        That explains why the compiler was complaining: the signature for this function in the header file doesn’t match the one used in the implementation. Let’s change the line in the header file to use the <code class="cf">uint8_t</code> type. Make it so:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">void</strong> generatePacket(uint8_t *, uint8_t *);​</code>​</div>
</td>
</tr>
</table>
<p id="N1B014" class="calibre4">
        Save the changes to the file, and then we’ll call <code class="cf">:make</code> again:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:write</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:make</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​gcc    -c -o wakeup.o wakeup.c​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​gcc -o wakeup wakeup.o​</code>​</div>
</td>
</tr>
</table>
<p id="N1B036" class="calibre4">
        This time the program compiles successfully. Our quickfix list is updated to use the output from the latest invocation of <code class="cf">make</code>. No errors are reported, so our cursor stays put.
		</p>
<div class="sidebar">
<div class="sidebar-title">Don't Lose the Place</div>
<div class="calibre1">
<p id="N1B049" class="calibre4">
      When we run the <code class="cf1">:make</code> command, Vim automatically jumps to the first error (unless there are none). If we prefer that our cursor remain where it is, we can instead run this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix4" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline4" valign="top">
<div class="calibre38">
​<code class="calibre39">​<strong class="prompt">$ make!</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1B06B" class="calibre4">
      The trailing <code class="cf1">!</code> character tells Vim to update the quickfix list without jumping to the first item. Now suppose that we run <code class="cf1">:make</code> and immediately realize that we should have used the bang version. How can we get back to where we were before we ran <code class="cf1">:make</code>? Simple: use the <span class="calibre17">&lt;C-o&gt;</span> command to jump back to the previous position in the jump list. See <a xmlns:str="http://exslt.org/strings" href="f_0083.html#sec.jump.list">Tip 55</a>, for more details.
    </p>
</div>
</div>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

