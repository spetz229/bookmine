---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0133.html
next: f_0135.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.global.delete">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 98</td>
<td class="arr-recipe-name">Delete Lines Containing a Pattern</td>
</tr>
</table>
<p id="N1A2DD" class="calibre4">
<span class="calibre5">
        Combining the <code class="cf">:global</code> and <code class="cf">:delete</code> commands allows us to cut down the size of a file rapidly. We can either keep or discard all lines that match a <code class="cf">{pattern}</code>.
	</span>
</p>
<p id="N1A2FE" class="calibre4">
      This file contains links to the first few episodes from the Vimcasts.org archive:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/global/episodes.html">global/episodes.html</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;ol&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">&lt;li&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">&lt;a</strong> href=<em class="string">"/episodes/show-invisibles/"</em>
<strong class="prompt">&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​      Show invisibles​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">&lt;/a&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">&lt;/li&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">&lt;li&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">&lt;a</strong> href=<em class="string">"/episodes/tabs-and-spaces/"</em>
<strong class="prompt">&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​      Tabs and Spaces​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">&lt;/a&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">&lt;/li&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">&lt;li&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">&lt;a</strong> href=<em class="string">"/episodes/whitespace-preferences-and-filetypes/"</em>
<strong class="prompt">&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​      Whitespace preferences and filetypes​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​    <strong class="prompt">&lt;/a&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​  <strong class="prompt">&lt;/li&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;/ol&gt;</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A367" class="calibre4">
      Each list item contains two pieces of data: the title of an episode and its URL. We’ll use a <code class="cf">:global</code> command to expose each of these.
    </p>
<h3 class="calibre22">Delete Matching Lines with ‘:g/re/d’</h3>
<p id="N1A371" class="calibre4">
        What if we wanted to throw away everything except for the contents of each <code class="cf">&lt;a&gt;</code> tag? In this file, the contents of each link appear on a line of their own, while every other line of the file contains either an opening or a closing tag. So if we can devise a pattern that matches HTML tags, we could use it with the <code class="cf">:global</code> command to reject any lines that match the pattern.
		</p>
<p id="N1A38A" class="calibre4">
        These commands would do the trick:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/\v\&lt;\/?\w+&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:g//d</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A39F" class="calibre4">
        If we run these two commands on the Vimcasts.org archive file, we’re left with this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Show invisibles​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Tabs and Spaces​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​Whitespace preferences and filetypes​</code>​</div>
</td>
</tr>
</table>
<p id="N1A3B3" class="calibre4">
        Just like with the <code class="cf">:substitute</code> command, we can leave the search field of the <code class="cf">:global</code> command blank, and Vim will reuse the last search pattern (see <a xmlns:str="http://exslt.org/strings" href="f_0125.html#sec.substitute.lastpat">Tip 90</a>). That means that we can build our regular expression by starting with a broad match and then narrowing it, as demonstrated in <a xmlns:str="http://exslt.org/strings" href="f_0119.html#sec.search.iterate">Tip 85</a>.
      </p>
<p id="N1A3C4" class="calibre4">
        The regular expression uses <code class="cf">very magic</code> mode (covered in <a xmlns:str="http://exslt.org/strings" href="f_0106.html#sec.pattern.search">Tip 73</a>). It matches an opening angle bracket (<code class="cf">\&lt;</code>), followed by an optional forward slash (<code class="cf">\/?</code>), and then one or more word characters (<code class="cf">\w+</code>) followed by an end-of-word delimiter (<code class="cf">&gt;</code>). This is not an all-purpose tag-matching regex, but it’s good enough for this particular case.
      </p>
<h3 class="calibre22">Keep Only Matching Lines with ‘:v/re/d’</h3>
<p id="N1A3DE" class="calibre4">
        This time we’ll switch things around. The <code class="cf">:vglobal</code> command, or <code class="cf">:v</code> for short, does the opposite of the <code class="cf">:g</code> command. That is, it executes a command on each line that does not match the specified pattern.
      </p>
<p id="N1A3EF" class="calibre4">
        The lines containing the URLs are easy to identify: they all contain the <code class="cf">href</code> attribute. We can select only those lines by running this command:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:v/href/d</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1A402" class="calibre4">
        This can be read as “Delete each line that <span class="calibre5">doesn’t</span> contain <code class="cf">href</code>.” The result looks like this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​&lt;a <span class="shade-fg-black">href</span>="/episodes/show-invisibles/"&gt;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​&lt;a <span class="shade-fg-black">href</span>="/episodes/tabs-and-spaces/"&gt;​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​&lt;a <span class="shade-fg-black">href</span>="/episodes/whitespace-preferences-and-filetypes/"&gt;​</code>​</div>
</td>
</tr>
</table>
<p id="N1A42B" class="calibre4">
        With a single command, we’ve condensed the file to the lines that interest us.
		</p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

