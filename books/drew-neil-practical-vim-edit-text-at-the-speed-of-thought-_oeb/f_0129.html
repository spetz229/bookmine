---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0128.html
next: f_0130.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.substitute.arithmetic">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 94</td>
<td class="arr-recipe-name">Perform Arithmetic on the Replacement</td>
</tr>
</table>
<p id="N19DC8" class="calibre4">
<span class="calibre5">
        The replacement field needn’t be a simple string. We can evaluate a Vim script expression and then use the result as the replacement string. Thus with a single command, we can promote every HTML header tag in a document.
    </span>
</p>
<p id="N19DDA" class="calibre4">
      Suppose that we have an HTML document like this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/substitution/headings.html">substitution/headings.html</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;h2&gt;</strong>Heading number 1<strong class="prompt">&lt;/h2&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;h3&gt;</strong>Number 2 heading<strong class="prompt">&lt;/h3&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;h4&gt;</strong>Another heading<strong class="prompt">&lt;/h4&gt;</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N19DFC" class="calibre4">
      We want to promote each heading, turning <code class="cf">&lt;h2&gt;</code> into <code class="cf">&lt;h1&gt;</code>, <code class="cf">&lt;h3&gt;</code> into <code class="cf">&lt;h2&gt;</code>, and so on. To put it another way, we want to subtract one from the numeral part of all HTML header tags.
    </p>
<p id="N19E0B" class="calibre4">
      We’ll harness the substitute command to do it. Here’s the general idea: we write a pattern that matches the numeral portion of HTML header tags. Then we write a substitute command that uses a Vim script expression to subtract one from the number that was captured. When we run the substitute command globally across the entire file, all HTML header tags will be changed with that single command.
    </p>
<h3 class="calibre22">The Search Pattern</h3>
<p id="N19E12" class="calibre4">
        The only thing that we want to change is the numeral part of the header tags, so ideally we want to create a pattern that matches that and nothing else. We don’t want to match all digits. We only want to match the ones that immediately follow <code class="cf">&lt;h</code> or <code class="cf">&lt;/h</code>. This pattern should do the trick:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">/\v\&lt;\/?h\zs\d</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N19E28" class="calibre4">
        The <code class="cf">\zs</code> item allows us to zoom in on part of the match. To simplify our example, we could say that a pattern of <code class="cf">h\zs\d</code> would match the letter “h” followed by any digit (“h1,” “h2,” and so on). The placement of <code class="cf">\zs</code> indicates that the “h” itself would be excluded from the match, even though it is an integral part of the broader pattern (we met the <code class="cf">\zs</code> item in <a xmlns:str="http://exslt.org/strings" href="f_0110.html#sec.pattern.zs">Tip 77</a>, where we compared it to Perl’s positive lookbehind assertion). Our pattern looks slightly more complex, because we don’t just match “h1” and “h2,” but “&lt;h1,” “&lt;/h1,” “&lt;h2,” “&lt;/h2,” and so on.
      </p>
<p id="N19E40" class="calibre4">
        Try executing this search for yourself. You should see that the numeral part of each header tag is highlighted, while the freestanding digits are not.
      </p>
<h3 class="calibre22">The Substitute Command</h3>
<p id="N19E47" class="calibre4">
        We want to perform arithmetic inside the replacement field of our substitute command. To do this, we’ll have to evaluate a Vim script expression. We can fetch the current match by calling the <code class="cf">submatch(0)</code> function. Since our search pattern matched a digit and nothing else, we can expect that <code class="cf">submatch(0)</code> will return a number. From this, we subtract one and return the result to be substituted in place of the match.
      </p>
<p id="N19E66" class="calibre4">
        This substitute command should work:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:%s//\=submatch(0)-1/g</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N19E76" class="calibre4">
        When we execute the search followed by this substitute command on our fragment of HTML, it produces this result:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;h1&gt;</strong>Heading number 1<strong class="prompt">&lt;/h1&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;h2&gt;</strong>Number 2 heading<strong class="prompt">&lt;/h2&gt;</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">&lt;h3&gt;</strong>Another heading<strong class="prompt">&lt;/h3&gt;</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N19E97" class="calibre4">
        All HTML header tags have been changed, but the freestanding numerals have been left untouched.
		</p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

