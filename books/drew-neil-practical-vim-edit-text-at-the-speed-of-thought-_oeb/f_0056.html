---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0055.html
next: f_0057.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.command.history">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 34</td>
<td class="arr-recipe-name">Recall Commands from History</td>
</tr>
</table>
<p id="N13418" class="calibre4">
<span class="calibre5">
        Vim records the commands that we enter in Command-Line mode and provides two ways of recalling them: scrolling through past command-lines with the cursor keys or dialing up the command-line window.
    </span>
</p>
<p id="N13434" class="calibre4">
      Vim keeps a history of our activity in Command-Line mode. We can easily recall previous commands, so there’s no need to type out a long Ex command at the prompt more than once.
    </p>
<p id="N13437" class="calibre4">
      To begin with, let’s switch to Command-Line mode by pressing the <span class="calibre17">:</span> key. Leave the prompt empty; then press the <span class="calibre17">&lt;Up&gt;</span> arrow key. The command line should be populated with the most recent Ex command that we executed. We can use the <span class="calibre17">&lt;Up&gt;</span> key again to go further back through our Ex command history or use the <span class="calibre17">&lt;Down&gt;</span> key to go in the opposite direction.
    </p>
<p id="N1344D" class="calibre4">
      Now try typing <code class="cf">:help</code>, followed by the <span class="calibre17">&lt;Up&gt;</span> key. Again, this should scroll through previous Ex commands, but instead of showing everything, the list will be filtered to only include Ex commands that started with the word “help.”
    </p>
<p id="N1345B" class="calibre4">
      By default, Vim records the last twenty commands. With memory becoming ever cheaper in today’s computers, we can probably afford to up this limit by changing the <code class="cf">‘history’</code> option. Try adding this line to your <code class="cf">vimrc</code>:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​set history=200​</code>​</div>
</td>
</tr>
</table>
<p id="N13474" class="calibre4">
      Note that history is not recorded just for the current editing session. It persists even when we quit and relaunch Vim (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">viminfo</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/starting.html#viminfo">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). Increasing the number of items recorded in history can be really useful.
    </p>
<p id="N1347B" class="calibre4">
      As well as recording a history of Ex commands, Vim keeps a separate record of our search history. If we press <span class="calibre17">/</span> to bring up the search prompt, we can also scroll backward and forward through previous searches with the <span class="calibre17">&lt;Up&gt;</span> and <span class="calibre17">&lt;Down&gt;</span> keys. The search prompt is, after all, just another form of Command-Line mode.
    </p>
<div class="sidebar">
<div class="sidebar-title">Avoid the Cursor Keys When Recalling Commands from History</div>
<div class="calibre1">
<p id="N1349C" class="calibre4">
        In addition to the <span class="calibre17">&lt;Up&gt;</span> and <span class="calibre17">&lt;Down&gt;</span> keys, we can also use the <span class="calibre17">&lt;C-p&gt;</span> and <span class="calibre17">&lt;C-n&gt;</span> chords to go backward and forward through our command history. The advantage of using these mappings is that we don’t need to move our hands from the home row to use them. But there’s a disadvantage to the <span class="calibre17">&lt;C-p&gt;</span> and <span class="calibre17">&lt;C-n&gt;</span> commands: unlike <span class="calibre17">&lt;Up&gt;</span> and <span class="calibre17">&lt;Down&gt;</span>, they don’t filter the command history.
      </p>
<p id="N134C7" class="calibre4">
        We can get the best of both by creating the following custom mappings:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre40">
<a href="http://media.pragprog.com/titles/dnvim/code/ex_mode/history-scrollers.vim">ex_mode/history-scrollers.vim</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix4" valign="top">
<span> </span>
</td>
<td class="codeline4" valign="top">
<div class="calibre38">
​<code class="calibre39">​<strong class="prompt">cnoremap</strong> <em class="string">&lt;C-p&gt;</em> <em class="string">&lt;Up&gt;</em>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix4" valign="top">
<span> </span>
</td>
<td class="codeline4" valign="top">
<div class="calibre38">
​<code class="calibre39">​<strong class="prompt">cnoremap</strong> <em class="string">&lt;C-n&gt;</em> <em class="string">&lt;Down&gt;</em>​</code>​</div>
</td>
</tr>
</table>
</div>
</div>
<h3 id="sec.commandline.window" class="calibre22">Meet the Command-Line Window</h3>
<p id="N134ED" class="calibre4">
        Like Insert mode, Command-Line mode is fine for composing something from scratch, but it’s not a comfortable place to edit text.
      </p>
<p id="N134F4" class="calibre4">
        Suppose that we’re working on a simple Ruby script. Each time we make a change, we find ourselves running the following two commands:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:write</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:!ruby %</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N13509" class="calibre4">
        After running these two commands in quick succession a couple of times, we realize that we could streamline our workflow by folding them into a single command line. This way we can dial up one complete command from our history and replay it:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:write | !ruby %</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N13519" class="calibre4">
        Each of these commands is already in our history, so we shouldn’t have to type the entire command line from scratch. But how can we merge two records from our history into one? Press <span class="calibre17">q:</span> and meet the command-line window (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">cmdwin</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html#cmdwin">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>).
      </p>
<p id="N1352A" class="calibre4">
        The command-line window is like a regular Vim buffer, where each line contains an item from our history. With the <span class="calibre17">k</span> and <span class="calibre17">j</span> keys, we can move backward and forward through our history. Or we can use Vim’s search feature to find the line that we’re looking for. When we press the <span class="calibre17">&lt;CR&gt;</span> key, the contents of the current line are executed as an Ex command.
      </p>
<p id="N13536" class="calibre4">
        The beauty of the command-line window is that it allows us to change historical commands using the full modal editing power of Vim. We can navigate with any of the motions we’re accustomed to using in Normal mode. We can operate on visual selections or switch to Insert mode. We can even run Ex commands on the contents of the command-line window!
      </p>
<p id="N13539" class="calibre4">
        Having summoned the command-line window by pressing <span class="calibre17">q:</span>, we could solve our problem as follows:
      </p>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Keystrokes</th>
<th class="hlines">Buffer Contents</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<code class="cf">{start}</code>
</p>
</td>
<td class="calibre24">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-white">w</span>rite​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix1" valign="top">
<span> </span>
</td>
<td class="codeline1" valign="top">
<div class="calibre32">
​<code class="calibre30">​!ruby %​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">A</span>
<code class="cf">
<img xmlns:str="http://exslt.org/strings" alt="info" src="images/open_box.png" class="calibre21"/>|&lt;Esc&gt;</code>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​write <span class="shade-fg-white">|</span>​</code>​</div>
</td>
</tr>
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​!ruby %​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">J</span>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​write |<span class="shade-fg-white"> </span>!ruby %​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<code class="cf">:s/write/update</code>
</p>
</td>
<td class="calibre26">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix2" valign="top">
<span> </span>
</td>
<td class="codeline2" valign="top">
<div class="calibre32">
​<code class="calibre30">​<span class="shade-fg-white">u</span>pdate |<span class="shade-fg-white"> </span>!ruby %​</code>​</div>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<p id="N135B0" class="calibre4">
        Pressing <span class="calibre17">&lt;CR&gt;</span> would then execute the <code class="cf">:update | !ruby %</code> command as though we had typed it into the command line.
      </p>
<p id="N135B9" class="calibre4">
        When the command-line window is open, it always gets the focus. That means we can’t switch to other windows except by dismissing the command-line window. We can close the command-line window by running the <code class="cf">:q</code> command (just like any ordinary Vim window) or by pressing <span class="calibre17">&lt;CR&gt;</span>.
      </p>
<p id="N135C7" class="calibre4">
        Note that when we press <span class="calibre17">&lt;CR&gt;</span> in the command-line window, the command is executed in the context of the active window: that is, the window that was active before the command-line window was summoned. Vim doesn’t indicate which is the active window when the command-line window is open, so pay attention if you’re using split windows!
      </p>
<p id="N135CD" class="calibre4">
        What if halfway through composing an Ex command at the prompt, we realize that we need more editing power? In Command-Line mode, we can use the <span class="calibre17">&lt;C-f&gt;</span> mapping to switch to the command-line window, preserving a copy of the command that was typed at the prompt. This table summarizes a few of the methods for summoning the command-line window:
      </p>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Command</th>
<th class="hlines">Action</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<span class="calibre17">q/</span>
</p>
</td>
<td class="calibre24">
<p class="last-para-in-cell">Open the command-line window with history of searches</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">q:</span>
</p>
</td>
<td class="calibre26">
<p class="last-para-in-cell">Open the command-line window with history of Ex commands</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">ctrl-f</span>
</p>
</td>
<td class="calibre26">
<p class="last-para-in-cell">
		  Switch from Command-Line mode to the command-line window</p>
</td>
</tr>
</tbody>
</table>
<p id="N13601" class="calibre4">
        It’s easy to mix up the <span class="calibre17">q:</span> and <code class="cf">:q</code> commands. I’m sure that we’ve all opened the command-line window by accident when we actually meant to quit Vim! It’s a shame, because this feature is really useful, but many people are frustrated by their first (accidental) encounter with it. Skip ahead to <a xmlns:str="http://exslt.org/strings" href="f_0119.html#sec.search.iterate">Tip 85</a>, for another example of the command-line window in action.
		</p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

