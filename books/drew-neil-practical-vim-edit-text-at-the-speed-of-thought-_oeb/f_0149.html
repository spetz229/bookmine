---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0148.html
next: f_0150.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="N1B624">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 109</td>
<td class="arr-recipe-name">Customize the grep Program</td>
</tr>
</table>
<p id="N1B62B" class="calibre4">
<span class="calibre5">
        Vim’s <code class="cf">:grep</code> command is a wrapper for the external <code class="cf">grep</code> program. We can customize the way that Vim delegates this task by manipulating two settings: <code class="cf">‘grepprg’</code> and <code class="cf">‘grepformat’</code>. First we’ll examine the defaults, and then we’ll see how tweaking them allows us to outsource the search task to any other suitable program.
    </span>
</p>
<h3 class="calibre22">Vim’s Default grep Settings</h3>
<p id="N1B646" class="calibre4">
        The <code class="cf">‘grepprg’</code> setting specifies what to run in the shell when Vim’s <code class="cf">:grep</code> command is executed (<strong xmlns:str="http://exslt.org/strings" class="calibre10">'grepprg'</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/options.html#'grepprg'">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). The <code class="cf">‘grepformat’</code> setting tells Vim how to parse the output returned by the <code class="cf">:grep</code> command (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">'grepformat'</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/options.html#'grepformat'">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). On Unix systems, the defaults are these:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">grepprg</strong>="<strong class="prompt">grep</strong> -n $* /dev/null"​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">grepformat</strong>="%f:%l:%m,%f:%l%m,%f  %l%m"​</code>​</div>
</td>
</tr>
</table>
<p id="N1B687" class="calibre4">
        The <code class="cf">$*</code> symbol used in the <code class="cf">‘grepprg’</code> setting is a placeholder, which is replaced with any arguments supplied to the <code class="cf">:grep</code> command.
      </p>
<p id="N1B693" class="calibre4">
        The <code class="cf">‘grepformat’</code> setting is a string containing tokens that describe the output returned by <code class="cf">:grep</code>. The special tokens used in the <code class="cf">‘grepformat’</code> string are the same as those used by <code class="cf">‘errorformat’</code>, which we met in <a xmlns:str="http://exslt.org/strings" href="f_0146.html#sec.errorformat">​<em class="calibre5">Populate the Quickfix List Using Nodelint’s Output</em>​</a>. For the complete list, look up <strong xmlns:str="http://exslt.org/strings" class="calibre10">errorformat</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/quickfix.html#errorformat">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>.
      </p>
<p id="N1B6AA" class="calibre4">
        Let’s see how the default <code class="cf">%f:%l %m</code> format stacks up against this output from <code class="cf">grep</code>:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​department-store.txt:1:Waldo is beside the boot counter.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt:6:Waldo is studying his clipboard.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt:9:The penny farthing is 10 paces ahead of Waldo.​</code>​</div>
</td>
</tr>
</table>
<p id="N1B6C4" class="calibre4">
        For each record, <code class="cf">%f</code> matches the filename (<code class="cf">department-store.txt</code> or <code class="cf">goldrush.txt</code>), <code class="cf">%l</code> matches the line number, and <code class="cf">%m</code> matches the text on that line.
      </p>
<p id="N1B6D6" class="calibre4">
        The <code class="cf">‘grepformat’</code> string can contain multiple formats separated by commas. The default matches either <code class="cf">%f:%l %m</code> or <code class="cf">%f  %l%m</code>. Vim will use the first format that matches the output from <code class="cf">:grep</code>.
		</p>
<h3 class="calibre22">Make ‘:grep’ Call ack</h3>
<p id="N1B6EC" class="calibre4">
<code class="cf">ack</code> is a <code class="cf">grep</code> alternative that is targeted specifically at programmers. 
        If you’re wondering how it compares to <code class="cf">grep</code>, visit the home page (and be sure to read the URL, <a href="http://betterthangrep.com">http://betterthangrep.com</a>).
      </p>
<p id="N1B70C" class="calibre4">
        First, we need to install <code class="cf">ack</code>. On Ubuntu, we can do so as follows:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ sudo apt-get install ack-grep</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ sudo ln -s /usr/bin/ack-grep /usr/local/bin/ack</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1B724" class="calibre4">
        The first of these commands installs the program, allowing us to call it as <code class="cf">ack-grep</code>. The second command creates a symlink so that we can call it simply as <code class="cf">ack</code>.
      </p>
<p id="N1B72D" class="calibre4">
        On OS X, we can install <code class="cf">ack</code> using Homebrew:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ brew install ack</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1B74D" class="calibre4">
        Let’s see how we could customize the <code class="cf">‘grepprg’</code> and <code class="cf">‘grepformat’</code> settings so that <code class="cf">:grep</code> calls <code class="cf">ack</code> instead. By default, <code class="cf">ack</code> lists the filename on a line of its own, followed by the line number and contents of each matched line, like this:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ ack Waldo *</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​department-store.txt​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​1:Waldo is beside the boot counter.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​6:Waldo is studying his clipboard.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​9:The penny farthing is 10 paces ahead of Waldo.​</code>​</div>
</td>
</tr>
</table>
<p id="N1B77E" class="calibre4">
        We can easily massage this output so that it resembles that of <code class="cf">grep -n</code> by running <code class="cf">ack</code> with the <code class="cf">--nogroup</code> switch:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ ack --nogroup Waldo *</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​department-store.txt:1:Waldo is beside the boot counter.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt:6:Waldo is studying his clipboard.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt:9:The penny farthing is 10 paces ahead of Waldo.​</code>​</div>
</td>
</tr>
</table>
<p id="N1B7A1" class="calibre4">
        This output matches the format of <code class="cf">grep -n</code>, and since Vim’s default <code class="cf">‘grepformat’</code> string knows how to parse this, we don’t need to change it. So the simplest thing we could do to use <code class="cf">ack</code> instead of <code class="cf">grep</code> would be to set <code class="cf">‘grepprg’</code> as follows:
		</p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:set grepprg=ack\ --nogroup\ $*</strong>​</code>​</div>
</td>
</tr>
</table>
<div class="sidebar">
<div class="sidebar-title">Alternative grep Plugins</div>
<div class="calibre1">
<p id="N1B7CA" class="calibre4">
        Outsourcing a multiple-file search to an external program is easy with Vim. We have only to change the <code class="cf1">‘grepprg’</code> and <code class="cf1">‘grepformat’</code> settings and then execute <code class="cf1">:grep</code>. And just like that, our results are in the quickfix list. No matter which program is actually called, the interface is nearly identical.
      </p>
<p id="N1B7DD" class="calibre4">
        But there are some important differences. <code class="cf1">grep</code> uses POSIX regular expressions, whereas <code class="cf1">ack</code> uses Perl regular expressions. If the <code class="cf1">:grep</code> command calls <code class="cf1">ack</code> in the background, a layer of misdirection is added. Wouldn’t you rather create a custom command called <code class="cf1">:Ack</code> that does what it says on the label?
      </p>
<p id="N1B7F9" class="calibre4">
        The Ack.vim plugin follows this strategy and so does fugitive.vim,<a id="FNPTR-34" href="f_0150.html#FOOTNOTE-34">[34]</a> which adds a custom <code class="cf1">:Ggrep</code> command that executes <code class="cf1">git-grep</code>. We can install several plugins like this, and since each one creates a custom command rather than overriding the <code class="cf1">:grep</code> command, they can all coexist without conflict. We needn’t stick to one <code class="cf1">grep</code>-like program. We can use whichever is best for the task at hand.
      </p>
</div>
</div>
<h3 class="calibre22">Make ack Jump to Line and Column</h3>
<p id="N1B81C" class="calibre4">
        But <code class="cf">ack</code> has another trick up its sleeve. When run with the <code class="cf">--column</code> option, <code class="cf">ack</code> will output the line <span class="calibre5">and column number</span> of each match. Observe:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">$ ack --nogroup --column Waldo *</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>&lt;= </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​department-store.txt:1:1:Waldo is beside the boot counter.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt:6:1:Waldo is studying his clipboard.​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​goldrush.txt:9:41:The penny farthing is 10 paces ahead of Waldo.​</code>​</div>
</td>
</tr>
</table>
<p id="N1B845" class="calibre4">
        If we could tweak the <code class="cf">‘grepformat’</code> to extract this extra information, then we could navigate search results by jumping to the precise position of each match rather than just to the right line. It’s easily done using these settings:
      </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:set grepprg=ack\ --nogroup\ --column\ $*</strong>​</code>​</div>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span>=&gt; </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">:set grepformat=%f:%l:%c:%m</strong>​</code>​</div>
</td>
</tr>
</table>
<p id="N1B85D" class="calibre4">
        The <code class="cf">%c</code> item matches the column number.
		</p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

