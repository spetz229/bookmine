---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0030.html
next: f_0032.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.operator">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 12</td>
<td class="arr-recipe-name">Combine and Conquer</td>
</tr>
</table>
<p id="N1165B" class="calibre4">
<span class="calibre5">
        Much of Vim’s power stems from the way that operators and motions can be combined. In this tip, we’ll look at how this works and consider the implications.
    </span>
</p>
<h3 class="calibre22">Operator + Motion = Action</h3>
<p id="N11675" class="calibre4">
		The <span class="calibre17">d{motion}</span> command can operate on a single character (<span class="calibre17">dl</span>), a complete word (<span class="calibre17">daw</span>), or an entire paragraph (<span class="calibre17">dap</span>). Its reach is defined by the motion. The same goes for <span class="calibre17">c{motion}</span>, <span class="calibre17">y{motion}</span>, and a handful of others. Collectively, these commands are called <span class="calibre5">operators</span>. You can find the complete list by looking up <strong xmlns:str="http://exslt.org/strings" class="calibre10">operator</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/motion.html#operator">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>, while <a xmlns:str="http://exslt.org/strings" href="#table.operators">Table 2, ​<em class="calibre5">Vim’s Operator Commands</em>​</a>, summarizes some of the more common ones.
      </p>
<hr class="calibre37"/>
<div class="figurecaption" id="table.operators">Table 2. Vim’s Operator Commands</div>
<table class="simpletable">
<thead class="calibre23">
<tr class="calibre7">
<th class="hlines">Trigger</th>
<th class="hlines">Effect</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre24">
<p class="last-para-in-cell">
<span class="calibre17">c</span>
</p>
</td>
<td class="calibre24">Change</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">d</span>
</p>
</td>
<td class="calibre26">Delete</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">y</span>
</p>
</td>
<td class="calibre26">Yank into register</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">g~</span>
</p>
</td>
<td class="calibre26">Swap case</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">gu</span>
</p>
</td>
<td class="calibre26">Make lowercase</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">gU</span>
</p>
</td>
<td class="calibre26">Make uppercase</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">&gt;</span>
</p>
</td>
<td class="calibre26">Shift right</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">&lt;</span>
</p>
</td>
<td class="calibre26">Shift left</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">=</span>
</p>
</td>
<td class="calibre26">Autoindent</td>
</tr>
<tr class="calibre7">
<td class="calibre26">
<p class="last-para-in-cell">
<span class="calibre17">!</span>
</p>
</td>
<td class="calibre26">Filter {motion} lines through an external program</td>
</tr>
</tbody>
</table>
<hr class="calibre37"/>
<p id="N11718" class="calibre4">
        The <span class="calibre17">g~</span>, <span class="calibre17">gu</span>, and <span class="calibre17">gU</span> commands are invoked by two keystrokes. In each case, we can consider the <span class="calibre17">g</span> to be a prefix that modifies the behavior of the subsequent keystroke. See <a xmlns:str="http://exslt.org/strings" href="#sidebar.operator.pending.mode">​<em class="calibre5">Meet Operator-Pending Mode</em>​</a>, for further discussion.
      </p>
<p id="N1172B" class="calibre4">
        The combination of operators with motions forms a kind of grammar. The first rule is simple: an action is composed from an operator followed by a motion. Learning new motions and operators is like learning the vocabulary of Vim. If we follow the simple grammar rules, we can express more ideas as our vocabulary grows.
      </p>
<p id="N1172E" class="calibre4">
		Suppose that we already know how to delete a word using <span class="calibre17">daw</span>, and then we learn about the <span class="calibre17">gU</span> command (see <strong xmlns:str="http://exslt.org/strings" class="calibre10">gU</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/change.html#gU">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>). It’s an operator too, so we can invoke <span class="calibre17">gUaw</span> to convert the current word to SHOUTY case. If we then expand our vocabulary to include the <span class="calibre17">ap</span> motion, which acts upon a paragraph, then we find two new operations at our disposal: <span class="calibre17">dap</span> to delete, or <span class="calibre17">gUap</span> to make the whole paragraph shout.
      </p>
<p id="N11751" class="calibre4">
        Vim’s grammar has just one more rule: when an operator command is invoked in duplicate, it acts upon the current line. So <span class="calibre17">dd</span> deletes the current line, while <span class="calibre17">&gt;&gt;</span> indents it. The <span class="calibre17">gU</span> command is a special case. We can make it act upon the current line by running either <span class="calibre17">gUgU</span> or the shorthand <span class="calibre17">gUU</span>.
      </p>
<h3 class="calibre22">Extending Vim’s Combinatorial Powers</h3>
<p id="N11768" class="calibre4">
        The number of actions that we can perform using Vim’s default set of operators and motions is vast. But we can expand these even further by rolling our own custom motions and operators. Let’s consider the implications.
      </p>
<h4 class="calibre20">Custom Operators Work with Existing Motions</h4>
<p id="N1176F" class="calibre4">
		  The standard set of operators that ships with Vim is relatively small, but it is possible to define new ones. Tim Pope’s commentary.vim plugin provides a good example.<a id="FNPTR-4" href="#FOOTNOTE-4">[4]</a> This adds a command for commenting and uncommenting lines of code in all languages supported by Vim.
        </p>
<p id="N11785" class="calibre4">
          The commentary command is triggered by <span class="calibre17">\\{motion}</span>, which toggles commenting for the specified lines. It’s an operator command, so we can combine it with all of the usual motions. <span class="calibre17">\\ap</span> will toggle commenting for the current paragraph. <span class="calibre17">\\G</span> comments from the current line to the end of the file. <span class="calibre17">\\\</span> comments the current line.
        </p>
<p id="N1179C" class="calibre4">
          If you’re curious about how to create your own custom operators, start by reading <strong xmlns:str="http://exslt.org/strings" class="calibre10">:map-operator</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/map.html#:map-operator">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>.
        </p>
<h4 class="calibre20">Custom Motions Work with Existing Operators</h4>
<p id="N117A7" class="calibre4">
          Vim’s standard set of motions is fairly comprehensive, but we can augment it further by defining new motions and text objects. </p>
<p id="N117BA" class="calibre4">      Kana Natsuno’s textobj-entire plugin is a good example.<a id="FNPTR-5" href="#FOOTNOTE-5">[5]</a>  
          It adds two new text objects to Vim: <span class="calibre17">ie</span> and <span class="calibre17">ae</span>, which act upon the entire file.
  </p>
<p id="N117C9" class="calibre4">
          If we wanted to autoindent the entire file using the <span class="calibre17">=</span> command, we could run <span class="calibre17">gg=G</span> (that is, <span class="calibre17">gg</span> to jump to the top of the file and then <span class="calibre17">=G</span> to autoindent everything from the cursor position to the end of the file). But if we had the textobj-entire plugin installed, we could simply run <span class="calibre17">=ae</span>. It wouldn’t matter where our cursor was when we ran this command; it would always act upon the entire file.
        </p>
<p id="N117DB" class="calibre4">
          Note that if we had both the commentary and textobj-entire plugins installed, we could use them together. Running <span class="calibre17">\\ae</span> would toggle commenting throughout the current file.
        </p>
<p id="N117E1" class="calibre4">
          If you’re curious about how to create your own custom motions, start by reading <strong xmlns:str="http://exslt.org/strings" class="calibre10">omap-info</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/map.html#omap-info">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>.
        </p>
<div class="sidebar" id="sidebar.operator.pending.mode">
<div class="sidebar-title">Meet Operator-Pending Mode</div>
<div class="calibre1">
<p id="N117ED" class="calibre4">
        Normal, Insert, and Visual modes are readily identified, but Vim has other modes that are easy to overlook. Operator-Pending mode is a case in point. We use it dozens of times daily, but it usually lasts for just a fraction of a second. For example, we invoke it when we run the command <span class="calibre17">dw</span>. It lasts during the brief interval between pressing <span class="calibre17">d</span> and <span class="calibre17">w</span> keys. Blink and you’ll miss it!
      </p>
<p id="N117FC" class="calibre4">
        If we think of Vim as a finite-state machine, then Operator-Pending mode is a state that accepts only motion commands. It is activated when we invoke an operator command, and then nothing happens until we provide a motion, which completes the operation. While Operator-Pending mode is active, we can return to Normal mode in the usual manner by pressing escape, which aborts the operation.
      </p>
<p id="N117FF" class="calibre4">
        Many commands are invoked by two or more keystrokes (for examples, look up <strong xmlns:str="http://exslt.org/strings" class="calibre10">g</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/vimindex.html#g">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>, <strong xmlns:str="http://exslt.org/strings" class="calibre10">z</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/vimindex.html#z">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>, <strong xmlns:str="http://exslt.org/strings" class="calibre10">ctrl-w</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/vimindex.html#ctrl-w">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>, or <strong xmlns:str="http://exslt.org/strings" class="calibre10">[</strong>
<a xmlns:str="http://exslt.org/strings" href="http://vimdoc.sourceforge.net/htmldoc/vimindex.html#[">
<img alt="info" src="images/information.png" class="calibre21"/>​</a>), but in most cases, the first keystroke merely acts as a prefix for the second. These commands don’t initiate Operator-Pending mode. Instead, we can think of them as namespaces that expand the number of available command mappings. Only the operator commands initiate Operator-Pending mode.
      </p>
<p id="N11812" class="calibre4">
        Why, you might be wondering, is an entire mode dedicated to those brief moments between invoking operator and motion commands, whereas the namespaced commands are merely an extension of Normal mode? Good question! Because we can create custom mappings that initiate or target Operator-Pending mode. In other words, it allows us to create custom operators and motions, which in turn allows us to expand Vim’s vocabulary.
		</p>
</div>
</div>

<div class="footnotes">
<h4 class="calibre20">Footnotes</h4>
<table cellspacing="3" class="table-of-contents">
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-3" href="f_0028.html#FNPTR-3">[3]</a>
</td>
<td class="calibre8">
<p id="N11213" class="calibre4">
<a href="http://vimgolf.com/">http://vimgolf.com/</a>
</p>
</td>
</tr>
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-4" href="#FNPTR-4">[4]</a>
</td>
<td class="calibre8">
<p id="N11780" class="calibre4">
<a href="https://github.com/tpope/vim-commentary">https://github.com/tpope/vim-commentary</a>
</p>
</td>
</tr>
<tr valign="top" class="calibre14">
<td class="footnote-number">
<a id="FOOTNOTE-5" href="#FNPTR-5">[5]</a>
</td>
<td class="calibre8">
<p id="N117BE" class="calibre4">
<a href="https://github.com/kana/vim-textobj-entire">https://github.com/kana/vim-textobj-entire</a>
</p>
</td>
</tr>
</table>
</div>
<div class="copyright">Copyright © 2012, The Pragmatic Bookshelf.</div>




<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

