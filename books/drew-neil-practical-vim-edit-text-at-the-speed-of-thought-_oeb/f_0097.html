---
layout: page
title: "Practical Vim (for Kathryn Amaral)"
prev: f_0096.html
next: f_0098.html
book_path: books/drew-neil-practical-vim-edit-text-at-the-speed-of-thought-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<table class="arr-recipe" id="sec.macro.count">
<tr class="calibre14">
<td class="arr-recipe-number">Tip 66</td>
<td class="arr-recipe-name">Play Back with a Count</td>
</tr>
</table>
<p id="N172B3" class="calibre4">
<span class="calibre5">
        The Dot Formula can be an efficient editing strategy for a small number of repeats, but it can’t be executed with a count. Overcome this limitation by recording a cheap one-off macro and playing it back with a count.
    </span>
</p>
<p id="N172C8" class="calibre4">
      In <a xmlns:str="http://exslt.org/strings" href="f_0020.html#sec.pad.with.spaces">Tip 3</a>, we used the Dot Formula to transform this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td colspan="2" class="calibre33">
<a href="http://media.pragprog.com/titles/dnvim/code/the_vim_way/3_concat.js">the_vim_way/3_concat.js</a>
</td>
</tr>
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">var</strong> foo = <em class="string">"method("</em>+argument1+<em class="string">","</em>+argument2+<em class="string">")"</em>;​</code>​</div>
</td>
</tr>
</table>
<p id="N172E7" class="calibre4">
     What we want is for it to look like this:
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​<strong class="prompt">var</strong> foo = <em class="string">"method("</em> + argument1 + <em class="string">","</em> + argument2 + <em class="string">")"</em>;​</code>​</div>
</td>
</tr>
</table>
<p id="N17301" class="calibre4">
      The Dot Formula meant that we could complete the task simply by repeating <span class="calibre17">;.</span> a few times. What if we faced the same problem but on a larger scale?
    </p>
<table class="processedcode">
<tr class="calibre28">
<td class="codeprefix" valign="top">
<span> </span>
</td>
<td class="codeline" valign="top">
<div class="calibre29">
​<code class="calibre30">​x = <em class="string">"("</em>+a+<em class="string">","</em>+b+<em class="string">","</em>+c+<em class="string">","</em>+d+<em class="string">","</em>+e+<em class="string">")"</em>;​</code>​</div>
</td>
</tr>
</table>
<p id="N17325" class="calibre4">
      We can approach this in exactly the same way. But when we have to invoke the two commands <span class="calibre17">;.</span> so many times to complete the job, it starts to feel like a lot of work. Isn’t there some way that we could apply a count?
    </p>
<p id="N1732B" class="calibre4">
      It’s tempting to think that running <span class="calibre17">11;.</span> would do the trick, but it’s no use. This instructs Vim to run the <span class="calibre17">;</span> command eleven times, and then the <span class="calibre17">.</span> command once. The equivalent mistake is more obvious if we run <span class="calibre17">;11.</span>, which tells Vim to invoke <span class="calibre17">;</span> once and then  <span class="calibre17">.</span> eleven times. We really want to run <span class="calibre17">;.</span> eleven times.
    </p>
<p id="N17343" class="calibre4">
      We can simulate this by recording one of the simplest possible macros: <span class="calibre17">qq;.q</span>. Here, <span class="calibre17">qq</span> tells Vim to record the following keystrokes and save them to the <code class="cf">q</code> register. Then we type our commands <span class="calibre17">;.</span> and finish recording the macro by pressing <span class="calibre17">q</span> one final time. Now we can execute the macro with a count: <span class="calibre17">11@q</span>. This executes <span class="calibre17">;.</span> eleven times.
    </p>
<p id="N1735B" class="calibre4">
      Let’s put all of that together. (See <a xmlns:str="http://exslt.org/strings" href="#table.macro-with-count">Table 16, ​<em class="calibre5">Recording and Playing a Macro with a Count</em>​</a>.)
    </p>
<hr class="calibre37"/>
<div class="figurecaption" id="table.macro-with-count">Table 16. Recording and Playing a Macro with a Count</div>
<dl class="calibre34">
<dt class="calibre1">
<b class="calibre10">Keystrokes</b>
</dt>
<dd class="calibre35">
<b class="calibre10">Buffer Contents</b>
</dd>
<dt class="calibre1">
<code class="cf">{start}</code>
</dt>
<dd class="calibre35">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix3" valign="top">
<span> </span>
</td>
<td class="codeline3" valign="top">
<div class="calibre36">
​<code class="calibre30">​<span class="shade-fg-white">x</span> = "("+a+","+b+","+c+","+d+","+e+")";​</code>​</div>
</td>
</tr>
</table>
</dd>
<dt class="calibre1">
<span class="calibre17">f+</span>
</dt>
<dd class="calibre35">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix3" valign="top">
<span> </span>
</td>
<td class="codeline3" valign="top">
<div class="calibre36">
​<code class="calibre30">​x = "("<span class="shade-fg-white">+</span>a+","+b+","+c+","+d+","+e+")";​</code>​</div>
</td>
</tr>
</table>
</dd>
<dt class="calibre1">
<span class="calibre17">s</span>
<code class="cf"> + &lt;Esc&gt;</code>
</dt>
<dd class="calibre35">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix3" valign="top">
<span> </span>
</td>
<td class="codeline3" valign="top">
<div class="calibre36">
​<code class="calibre30">​x = "(" +<span class="shade-fg-white"> </span>a+","+b+","+c+","+d+","+e+")";​</code>​</div>
</td>
</tr>
</table>
</dd>
<dt class="calibre1">
<span class="calibre17">qq;.q</span>
</dt>
<dd class="calibre35">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix3" valign="top">
<span> </span>
</td>
<td class="codeline3" valign="top">
<div class="calibre36">
​<code class="calibre30">​x = "(" + a +<span class="shade-fg-white"> </span>","+b+","+c+","+d+","+e+")";​</code>​</div>
</td>
</tr>
</table>
</dd>
<dt class="calibre1">
<span class="calibre17">22@q</span>
</dt>
<dd class="calibre35">
<table class="processedcode1">
<tr class="calibre31">
<td class="codeprefix3" valign="top">
<span> </span>
</td>
<td class="codeline3" valign="top">
<div class="calibre36">
​<code class="calibre30">​x = "(" + a + "," + b + "," + c + "," + d + "," + e +<span class="shade-fg-white"> </span>")";​</code>​</div>
</td>
</tr>
</table>
</dd>
</dl>
<hr class="calibre37"/>
<p id="N173E4" class="calibre4">
      The <span class="calibre17">;</span> command repeats the <span class="calibre17">f+</span> search. When our cursor is positioned <span class="calibre5">after</span> the last <code class="cf">+</code> character on the line, the <span class="calibre17">;</span> motion fails and the macro aborts.
    </p>
<p id="N173F6" class="calibre4">
      In our case, we want to execute the macro ten times. But if we were to play it back eleven times, the final execution would abort. In other words, we can complete the task so long as we invoke the macro with a count of ten or more.
    </p>
<p id="N173F9" class="calibre4">
      Who wants to sit there and count the exact number of times that a macro should be executed? Not me. I’d rather provide a count that I reckon to be high enough to get the job done. I often use <code class="cf">22</code>, because I’m lazy and it’s easy to type. On my keyboard, the <code class="cf">@</code> and <code class="cf">2</code> characters are entered with the same button.
    </p>
<p id="N17405" class="calibre4">
      Note that it won’t always be possible to make approximations when providing a count to a macro. It works in this case because the macro has a built-in safety catch: the <span class="calibre17">;</span> motion will fail if no more <code class="cf">+</code> symbols are left on the current line. See <a xmlns:str="http://exslt.org/strings" href="f_0096.html#sec.macro.abort">​<em class="calibre5">Abort When a Motion Fails</em>​</a>, for more details.
	  </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

