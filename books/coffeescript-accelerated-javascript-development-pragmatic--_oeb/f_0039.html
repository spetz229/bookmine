---
layout: page
title: "CoffeeScript (for jay muratore)"
prev: f_0038.html
next: f_0040.html
book_path: books/coffeescript-accelerated-javascript-development-pragmatic--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

<h2 id="sec.prototypes" class="calibre13">4.2 The Power of Prototypes</h2>
<p id="N12944" class="calibre5">
      Before we move on to classes, it’s important to understand how prototypes work. If you’re fluent in JavaScript, this section will just be a refresher.
    </p>
<p id="N1294D" class="calibre5">
      A prototype is an object whose properties are shared by all objects that have that prototype. An object’s prototype can usually be accessed using the aptly-named <code class="cf">prototype</code> property, though there are exceptions.<a id="FNPTR-33" href="f_0044.html#FOOTNOTE-33">[33]</a>
</p>
<p id="N12958" class="calibre5">
      However, you can’t just go and write <code class="cf">A.prototype = B</code>. Instead, you need to use the <code class="cf">new</code> keyword, which takes a function called a constructor and creates an object that “inherits” the constructor’s prototype. Here’s a quick example:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">Boy = <strong class="prompt">-&gt;</strong>
<em class="comment">     # by convention, constructor names are capitalized</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">Boy::sing = <strong class="prompt">-&gt;</strong> console.log <em class="string">"It ain't easy being a boy named Sue"</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">sue = <strong class="prompt">new</strong> Boy()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">sue.sing()</code>
</td>
</tr>
</table>
<p id="N12989" class="calibre5">
      Here, <code class="cf">Boy::sing</code> is shorthand for <code class="cf">Boy.prototype.sing</code>. The <code class="cf">::</code> symbol is to <code class="cf">prototype</code> as <code class="cf">@</code> is to <code class="cf">this</code>.
    </p>
<p id="N1299E" class="calibre5">
      The output looks like this:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">It ain't easy being a boy named Sue</code>
</td>
</tr>
</table>
<p id="N129AC" class="calibre5">
      This is the result because <code class="cf">sue</code> inherits the properties of <code class="cf">Boy.prototype</code>. Pretty cool! But how does it work?
    </p>
<div class="sidebar" id="sb.prototypePrecedence">
<div class="sidebar-title">Prototypes, Precedence, and 'hasOwnProperty'</div>
<div class="calibre1">
<p id="N129B9" class="calibre5">
        When an object inherits properties from a prototype, changes to the prototype will change the inherited properties as well:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td colspan="2" class="calibre27">
<a href="http://media.pragprog.com/titles/tbcoffee/code/Classes/Raven.coffee" class="calibre23">Classes/Raven.coffee</a>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">Raven = <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">Raven::quoth = <strong class="prompt">-&gt;</strong> console.log <em class="string">'Nevermore'</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven1 = <strong class="prompt">new</strong> Raven()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven1.quoth()<em class="comment">    # Nevermore</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16"></code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">Raven::quoth = <strong class="prompt">-&gt;</strong> console.log <em class="string">"I'm hungry"</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven1.quoth()<em class="comment">    # I'm hungry</em>
</code>
</td>
</tr>
</table>
<p id="N129F1" class="calibre5">
        Properties attached directly to objects take precedence over prototype properties. So we can remove that ambiguity by writing this:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td colspan="2" class="calibre27">
<a href="http://media.pragprog.com/titles/tbcoffee/code/Classes/Raven.coffee" class="calibre23">Classes/Raven.coffee</a>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven2 = <strong class="prompt">new</strong> Raven()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven2.quoth = <strong class="prompt">-&gt;</strong> console.log <em class="string">"I'm my own kind of raven"</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven1.quoth()<em class="comment">    # I'm hungry</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">raven2.quoth()<em class="comment">    # I'm my own kind of raven</em>
</code>
</td>
</tr>
</table>
<p id="N12A15" class="calibre5">
        To check whether a property is attached to an object directly or inherited from a prototype, use the <code class="cf1">hasOwnProperty</code> function:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td colspan="2" class="calibre27">
<a href="http://media.pragprog.com/titles/tbcoffee/code/Classes/Raven.coffee" class="calibre23">Classes/Raven.coffee</a>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">console.log raven1.hasOwnProperty(<em class="string">'quoth'</em>)<em class="comment">  # false</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">console.log raven2.hasOwnProperty(<em class="string">'quoth'</em>)<em class="comment">  # true</em>
</code>
</td>
</tr>
</table>
</div>
</div>
<p id="N12A39" class="calibre5">
      When we use <code class="cf">new</code>, several things happen: a new object is created, that object is given the prototype from the constructor, and the constructor is executed (in the new object’s context). So let’s say we want every new object to store its name and announce the existing number of gifts:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">Gift = (@name) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  Gift.count++</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  @day = Gift.count</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  @announce()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16"></code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">Gift.count = 0</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">Gift::announce = <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  console.log <em class="string">"On day </em>#{@day}<em class="string"> of Christmas I received </em>#{@name}<em class="string">"</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16"></code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">gift1 = <strong class="prompt">new</strong> Gift(<em class="string">'a partridge in a pear tree'</em>)</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">gift2 = <strong class="prompt">new</strong> Gift(<em class="string">'two turtle doves'</em>)</code>
</td>
</tr>
</table>
<p id="N12A80" class="calibre5">
      Here’s the output:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">On day 1 of Christmas I received a partridge in a pear tree</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">On day 2 of Christmas I received two turtle doves</code>
</td>
</tr>
</table>
<p id="N12A91" class="calibre5">
      Each time the <code class="cf">Gift</code> constructor runs, it does four things: assigns the given name to <code class="cf">@name</code> (using the argument shorthand), increments the <code class="cf">count</code> property on the <code class="cf">Gift</code> constructor, copies that value to <code class="cf">@day</code>, and runs the <code class="cf">@announce</code> function inherited from the prototype. The important thing to notice here is that all of the functions on the new object run in the context of the object.
    </p>
<p id="N12AA6" class="calibre5">
      This is all well and good, but it’s a bit messy, isn’t it? Shouldn’t there be a clearer way of distinguishing constructor properties (like <code class="cf">Gift.count</code>) from prototype properties (like <code class="cf">Gift::announce</code>)? And of distinguishing constructors from ordinary functions? Well, as a matter of fact, there is.
      </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

