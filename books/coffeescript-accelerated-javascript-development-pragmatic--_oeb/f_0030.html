---
layout: page
title: "CoffeeScript (for jay muratore)"
prev: f_0029.html
next: f_0031.html
book_path: books/coffeescript-accelerated-javascript-development-pragmatic--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

<h2 id="sec.collectionIteration" class="calibre13">3.3 Iterating over Collections</h2>
<p id="N11CE2" class="calibre5">
      There are two built-in syntaxes for iterating over collections in CoffeeScript: one for objects and another for arrays (and other enumerable objects, but usually arrays). The two look similar, but they behave very differently:
    </p>
<p id="N11CEB" class="calibre5">
      To iterate over an object’s properties, use this syntax:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<strong class="prompt">for</strong> key, value <strong class="prompt">of</strong> object<em class="comment"></em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<em class="comment">  # do things with key and value</em>
</code>
</td>
</tr>
</table>
<div class="sidebar" id="sb.forAll">
<div class="sidebar-title">'hasOwnProperty' and 'for own'</div>
<div class="calibre1">
<p id="N11D0D" class="calibre5">
        JavaScript makes a distinction between properties “owned” by an object and properties inherited from its prototype. You can check whether a particular property is an object’s own by using <code class="cf1">object.hasOwnProperty(key)</code>.
        </p>
<p id="N11D18" class="calibre5">
        Because it’s common to want to loop through an object’s own properties, not those it shares with all its siblings, CoffeeScript lets you write <code class="cf1">for own</code> to automatically perform this check and skip the properties that fail it. Here’s an example:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">for</strong> own sword <strong class="prompt">of</strong> Kahless</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  ...</code>
</td>
</tr>
</table>
<p id="N11D35" class="calibre5">
        This is shorthand for the following:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">for</strong> sword <strong class="prompt">of</strong> Kahless</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  <strong class="prompt">continue</strong> <strong class="prompt">unless</strong> Kahless.hasOwnProperty(sword)</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  ...</code>
</td>
</tr>
</table>
<p id="N11D54" class="calibre5">
        Whenever a <code class="cf1">for...of</code> loop is giving you properties you didn’t expect, try using <code class="cf1">for own...of</code> instead.
      </p>
</div>
</div>
<p id="N11D5D" class="calibre5">
      This loop will go through all the keys of the object and assign them to the first variable named after the <code class="cf">for</code>. The second variable, named <code class="cf">value</code> above, is optional; as you might expect, it’s set to the value corresponding to the key. So, <code class="cf">value = object[key]</code>.
    </p>
<p id="N11D69" class="calibre5">
      For an array, the syntax is a little different:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<strong class="prompt">for</strong> value <strong class="prompt">in</strong> array<em class="comment"></em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<em class="comment">  # do things with the value</em>
</code>
</td>
</tr>
</table>
<p id="N11D8C" class="calibre5">
      Why have a separate syntax? Why not just use <code class="cf">for key, value of array</code>? Because there’s nothing stopping an array from having extra methods or data. If you want the whole shebang, then sure, use <code class="cf">of</code>. But if you just want to treat the array as an array, use <code class="cf">in</code>—you’ll only get <code class="cf">array[0]</code>, <code class="cf">array[1]</code>, etc., up to <code class="cf">array[array.length - 1]</code>, in that order.
    </p>
<div class="sidebar" id="sb.for.scope">
<div class="sidebar-title">No Scope for 'for'</div>
<div class="calibre1">
<p id="N11DA5" class="calibre5">
        When you write <code class="cf1">for x of obj</code> or <code class="cf1">for x in arr</code>, you’re making assignments to a variable named <code class="cf1">x</code> in the current scope. You can take advantage of this by using those variables after the loop. Here’s one example:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">for</strong> name, occupation <strong class="prompt">of</strong> murderMysteryCharacters</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  <strong class="prompt">break</strong> <strong class="prompt">if</strong> occupation is <em class="string">'butler'</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">console.log <em class="string">"</em>#{name}<em class="string"> did it!"</em>
</code>
</td>
</tr>
</table>
<p id="N11DD7" class="calibre5">
        Here’s another:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">countdown = [10..0]</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">for</strong> num <strong class="prompt">in</strong> countdown</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  <strong class="prompt">break</strong> <strong class="prompt">if</strong> abortLaunch()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">if</strong> num is 0</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  console.log <em class="string">'We have liftoff!'</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">else</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  console.log <em class="string">"Launch aborted with </em>#{num}<em class="string"> seconds left"</em>
</code>
</td>
</tr>
</table>
<p id="N11E0C" class="calibre5">
        But this lack of scope can also surprise you, especially if you define a function within the <code class="cf1">for</code> loop. So when in doubt, use <code class="cf1">do</code> to capture the loop variable on each iteration:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">
<strong class="prompt">for</strong> x <strong class="prompt">in</strong> arr</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">  <strong class="prompt">do</strong> (x) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">    setTimeout (<strong class="prompt">-&gt;</strong> console.log x), 0</code>
</td>
</tr>
</table>
<p id="N11E3B" class="calibre5">
        We’ll review this issue in the Section 3.9, <a href="f_0036.html#sec.collectionsExercises">​<em class="emph">Exercises</em>​</a>.
      </p>
</div>
</div>
<p id="N11E41" class="calibre5">
      Both styles of <code class="cf">for</code> loops can be followed by a <code class="cf">when</code> clause that skips over loop iterations when the given condition fails. For instance, this code will run each function on <code class="cf">obj</code>, ignoring nonfunction properties:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<strong class="prompt">for</strong> key, func <strong class="prompt">of</strong> obj <strong class="prompt">when</strong> <strong class="prompt">typeof</strong> func is <em class="string">'function'</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  func()</code>
</td>
</tr>
</table>
<p id="N11E68" class="calibre5">
     And this code only sets <code class="cf">highestBid</code> to <code class="cf">bid</code> when <code class="cf">bid</code> is greater.
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">highestBid = 0</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<strong class="prompt">for</strong> bid <strong class="prompt">of</strong> entries <strong class="prompt">when</strong> bid &gt; highestBid</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  highestBid = bid</code>
</td>
</tr>
</table>
<p id="N11E8D" class="calibre5"></p>
<p id="N11E8F" class="calibre5">
      Of course, we could write <code class="cf">continue unless <span class="emph">condition</span>
</code> at the top of these loops instead; but <code class="cf">when</code> is a useful syntactic sugar, especially for one-liners. It’s also the only way to prevent any value from being added to the list returned by the loop, as we’ll see in Section 3.5, <a href="f_0032.html#sec.comprehensions">​<em class="emph">Comprehensions</em>​</a>.
      </p>
<p id="N11EA3" class="calibre5">
<code class="cf">for...in</code> supports an additional modifier not shared by its cousin <code class="cf">for...of</code>: <code class="cf">by</code>. Rather than stepping through an array one value at a time (the default), <code class="cf">by</code> lets you set an arbitrary step value:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">decimate = (army) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  execute(soldier) <strong class="prompt">for</strong> soldier <strong class="prompt">in</strong> army <strong class="prompt">by</strong> 10</code>
</td>
</tr>
</table>
<p id="N11ECA" class="calibre5">
      Nor does the step value need to be an integer. Fractional values work great in conjunction with ranges:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">animate = (startTime, endTime, framesPerSecond) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  <strong class="prompt">for</strong> pos <strong class="prompt">in</strong> [startTime..endTime] <strong class="prompt">by</strong> 1 / framesPerSecond</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    addFrame pos</code>
</td>
</tr>
</table>
<p id="N11EE9" class="calibre5">
      And you can use negative steps to iterate backward through a range:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">countdown = (max) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  console.log x <strong class="prompt">for</strong> x <strong class="prompt">in</strong> [max..0] <strong class="prompt">by</strong> -1</code>
</td>
</tr>
</table>
<p id="N11F05" class="calibre5">
      Note, however, that negative steps are not supported for arrays. When you write <code class="cf">for...in [start..end]</code>, <code class="cf">start</code> is the first loop value (and <code class="cf">end</code> is the last), so <code class="cf">by step</code> with a negative value works fine as long as <code class="cf">start &gt; end</code>. But when you write <code class="cf">for...in arr</code>, the first loop index is always <code class="cf">0</code>, and the last loop index is <code class="cf">arr.length - 1</code>. So if <code class="cf">arr.length</code> is positive, <code class="cf">by step</code> with a negative value will result in an infinite loop—the last loop index is never reached!
    </p>
<p id="N11F29" class="calibre5">
      That’s all you need to know about <code class="cf">for...of</code> and <code class="cf">for...in</code> loops. The most important thing to remember is that CoffeeScript’s <code class="cf">of</code> is equivalent to JavaScript’s <code class="cf">in</code>. Think of it this way: values live <span class="emph">in</span> an array, while you have keys <span class="emph">of</span> an array.
      </p>
<p id="N11F41" class="calibre5">
<code class="cf">of</code> and <code class="cf">in</code> lead double lives as operators: <code class="cf">key of obj</code> checks whether <code class="cf">obj[key]</code> is set, and <code class="cf">x in arr</code> checks whether any of <code class="cf">arr</code>’s values equals <code class="cf">x</code>. As with <code class="cf">for...in</code> loops, the <code class="cf">in</code> operator should only be used with arrays (and other enumerable entities, like <code class="cf">arguments</code> and jQuery objects). Here’s an example:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">fruits = [<em class="string">'apple'</em>, <em class="string">'cherry'</em>, <em class="string">'tomato'</em>]</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<em class="string">'tomato'</em> <strong class="prompt">in</strong> fruits<em class="comment">       # true</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">germanToEnglish: {ja: <em class="string">'yes'</em>, nein: <em class="string">'no'</em>}</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<em class="string">'ja'</em> <strong class="prompt">of</strong> germanToEnglish<em class="comment">  #true</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">germanToEnglish[ja]?</code>
</td>
</tr>
</table>
<p id="N11F95" class="calibre5">
      What if you want to check whether a nonenumerable object contains a particular value? Let’s save that for an exercise.
    </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

