---
layout: page
title: "Learning GNU Emacs, 3rd Edition"
prev: OEBPS/ch06.html
next: OEBPS/ch06s03.html
book_path: books/learning-gnu-emacs--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h1 class="title"><a id="gnu3-CHP-6-SECT-2" class="calibre1"></a>Tips for Creating Good Macros</h1></div></div></div><p class="copyright">It's easy to learn how to record and
<a id="gnu3-CHP-6-ITERM-2266" class="calibre2"></a>
            <a id="gnu3-CHP-6-ITERM-2267" class="calibre2"></a>reuse your keystrokes. However, when
you're starting out, you make a few mistakes: you
create a macro, use it, and then find out that it
doesn't do exactly what you thought. With a little
care, it's easy to make your macros more useful and
less vulnerable to mistakes.</p><p class="copyright">Good macros work in all situations. Therefore, within a macro, you
should use commands that are absolute rather than relative. For
example, if you write a macro that puts a formatting string around
the word the cursor is on, you want the macro to work no matter how
long the word is. Therefore, you would use an absolute command such
as <span><strong class="calibre5">M-f</strong></span> (for <span><strong class="calibre5">forward-word</strong></span>) rather than a few <span><strong class="calibre5">C-f</strong></span>s to move forward one character at a time.
Similarly, commands such as <span><strong class="calibre5">C-e</strong></span> and
<span><strong class="calibre5">C-a</strong></span> are good for finding the
beginning or end of a line rather than moving the cursor forward or
backward.</p><p class="copyright">Often, macros start with a search command that brings you to the
place in the file you want the macro to start. It's
a good idea to type the search argument (as in <span><strong class="calibre5">C-s</strong></span> 
            <em class="calibre7"><code class="calibre21">searchstring</code></em>)
rather than using the command to repeat the last search (<span><strong class="calibre5">C-s C-s</strong></span>). You may have changed the search
string between the time you define the macro and the time you execute
it, and <span><strong class="calibre5">C-s C-s</strong></span> remembers only what
the last search string was.</p><p class="copyright">It is often a good idea to add extra commands (typically <span><strong class="calibre5">C-a</strong></span> and <span><strong class="calibre5">C-e</strong></span>)
that aren't strictly necessary, just to make sure
that you're positioned correctly on the line. The
fewer assumptions that a macro makes, the better it works. So, if a
sequence of commands works correctly only if you start at the end of
the line, start the macro with <span><strong class="calibre5">C-e</strong></span>,
even if you already "know" that you
want to give the command only when you're at the end
of the line.</p><p class="copyright">Finally, while we're reciting rules and cautions,
here's one more: keep in mind that you probably want
to execute macros repeatedly. With a little foresight,
you'll be able to create macros that can be executed
in long chains without problems.</p><p class="copyright">In general, good macros have three parts:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="copyright">They find the place you want the macro to start working (often using
search).</p></li><li class="listitem"><p class="copyright">They do the work that needs to be done on the text.</p></li><li class="listitem"><p class="copyright">They prepare themselves to repeat.</p></li></ul></div><p class="copyright">How can a macro prepare itself to repeat? For example, assume that
you're writing a macro to delete the third column of
a table. After deleting the column, the macro should position itself
at the beginning of the next line (or wherever it needs to be) so you
don't have to reposition the cursor before reusing
it.</p><p class="copyright">Here's a slightly more complex example. If you start
a macro with a search, you have to make sure that the end of the
macro moves the cursor past the last spot you searched for. If you
don't, the macro will keep finding the same place in
the file and never go on to the next occurrence of what
you're searching for. As a general rule, if your
macro operates on a line of text, it should end by moving to the
beginning of the next line. Remember that your goal is to create a
sequence of keystrokes that can be executed many times in a row, with
no interruption.</p></div></div>

{% endraw %}

