---
layout: page
title: "Learning GNU Emacs, 3rd Edition"
prev: OEBPS/ch10s03.html
next: OEBPS/ch10s05.html
book_path: books/learning-gnu-emacs--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h1 class="title"><a id="gnu3-CHP-10-SECT-4" class="calibre1"></a>Customizing Your Key Bindings</h1></div></div></div><p class="copyright">Perhaps the most common things
<a id="gnu3-CHP-10-ITERM-2716" class="calibre2"></a>
            <a id="gnu3-CHP-10-ITERM-2717" class="calibre2"></a>that
Emacs users want to customize are the keystrokes that cause commands
to run. Keystrokes are associated with commands via <span><em class="calibre7">key
bindings</em></span>.</p><p class="copyright">Actually, every keystroke runs a command in Emacs. Printable
character keys (letters, numerals, punctuation, and spaces) run the
<span><strong class="calibre5">self-insert-command</strong></span>, which merely
causes the key just pressed to be inserted at the cursor in the
current buffer. (You could play a nasty April Fool's
joke on a naïve Emacs user by changing the bindings of
their printable characters.)</p><p class="copyright">The default set of key bindings is adequate for most purposes, of
course, but there are various cases in which you may want to add or
change key bindings. Emacs contains literally hundreds of commands,
only some of which have key bindings. As you know, you can access
those that don't have bindings by typing <span><strong class="calibre5">M-x</strong></span> 
            <span><em class="calibre7">command-name</em></span>
            <span><strong class="calibre5">Enter</strong></span>.</p><p class="copyright">If, however, you intend to use an unbound command often, you may want
to bind it to a keystroke sequence for convenience. You may want to
set special keys, such as arrow, numeric keypad, or function keys, to
perform commands you use often.</p><p class="copyright">The other important concept you need to know now is that of a
<span><em class="calibre7">keymap</em></span>, which is a collection of key bindings.
The most basic default key bindings in Emacs are kept in a keymap
called <span><strong class="calibre5">global-map</strong></span>. There is also the
concept of a <span><em class="calibre7">local</em></span> keymap, which is specific to
a single buffer. Local keymaps are used to implement commands in
modes (like C mode, text mode, shell mode, etc.), and each such mode
has its own keymap it installs as the local map when invoked. When
you type a key, Emacs first looks it up in the current
buffer's local map (if any). If it
doesn't find an entry there, it looks in <span><strong class="calibre5">global-map</strong></span>. If an entry for the key is found,
its associated command is run.</p><p class="copyright">What happens with commands that are bound to multiple keystrokes, as
in <span><strong class="calibre5">C-x k</strong></span> for <span><strong class="calibre5">kill-buffer</strong></span>? The answer is that the keys
<span><strong class="calibre5">C-x</strong></span>, <span><strong class="calibre5">Esc</strong></span>, and <span><strong class="calibre5">C-c</strong></span>
are actually bound to special internal functions that cause Emacs to
wait for another key to be pressed and then to look up that
key's binding in another map; they also cause
messages like <span><strong class="calibre5">C-x-</strong></span> to appear in the
minibuffer if more than a second passes before the next key is
pressed. The additional keymaps for <span><strong class="calibre5">C-x</strong></span> and <span><strong class="calibre5">Esc</strong></span>
are called <span><strong class="calibre5">ctl-x-map</strong></span> and
<span><strong class="calibre5">esc-map</strong></span>,<sup class="calibre6">[<a id="gnu3-CHP-10-FNOTE-1" href="#ftn.gnu3-CHP-10-FNOTE-1" class="calibre2">1</a>]</sup>
respectively; <span><strong class="calibre5">C-c</strong></span> is reserved for
local keymaps associated with modes like C mode and shell mode.</p><p class="copyright">For example, when you type <span><strong class="calibre5">Esc d</strong></span> or
<span><strong class="calibre5">M-d</strong></span>, Emacs looks it up in the
buffer's local keymap. We will assume it
doesn't find an entry there. Then Emacs searches
<span><strong class="calibre5">global-map</strong></span>; there it finds an entry
for <span><strong class="calibre5">Esc</strong></span> with a special function
(called <span><strong class="calibre5">ESC-prefix</strong></span>) that waits for
the next keystroke and uses <span><strong class="calibre5">esc-map</strong></span>
to determine which command to execute. When you type <span><strong class="calibre5">d</strong></span>, <span><strong class="calibre5">ESC-prefix</strong></span>
looks up the entry for <span><strong class="calibre5">d</strong></span> in
<span><strong class="calibre5">esc-map</strong></span>, finds <span><strong class="calibre5">kill-word</strong></span>, and runs it.</p><p class="copyright">You can create your own key bindings by adding entries in keymaps (or
overriding existing ones). Three functions are available for doing
this: <span><strong class="calibre5">define-key</strong></span>, <span><strong class="calibre5">global-set-key</strong></span>, and <span><strong class="calibre5">local-set-key</strong></span>. Their forms are:</p><a id="I_10_tt549" class="calibre2"></a><pre class="programlisting">(define-key <em class="calibre7"><code class="calibre32">keymap</code></em> "<em class="calibre7"><code class="calibre32">keystroke</code></em>" '<em class="calibre7"><code class="calibre32">command-name</code></em>
            <span><strong class="calibre5">)</strong></span>
(global-set-key "<em class="calibre7"><code class="calibre32">keystroke</code></em>" '<em class="calibre7"><code class="calibre32">command-name</code></em>)
(local-set-key "<span><em class="calibre7">keystroke</em></span>" '<span><em class="calibre7">command-name</em></span>)</pre><p class="copyright">Notice the double quotes around <span><em class="calibre7">keystroke</em></span> and
the single quote preceding <span><em class="calibre7">command-name</em></span>. This is
Lisp syntax; for more details, see <a class="calibre2" href="ch11.html" title="Chapter 11. Emacs Lisp Programming">Chapter 11</a>.
The <span><em class="calibre7">keystroke</em></span> is one or more characters, either
printable <a id="gnu3-CHP-10-ITERM-2718" class="calibre2"></a>or
special characters. For the latter, use the conventions in <a class="calibre2" href="ch10s04.html#gnu3-CHP-10-TABLE-2" title="Table 10-2. Special character conventions">Table 10-2</a>.</p><div class="book"><a id="gnu3-CHP-10-TABLE-2" class="calibre2"></a><p class="title2"><b class="calibre25">Table 10-2. Special character conventions</b></p><div class="table-contents"><table summary="Special character conventions" class="calibre8"><colgroup class="calibre9"><col class="calibre10"/><col class="calibre10"/></colgroup><thead class="calibre11"><tr class="calibre12"><th class="calibre26">
                        <p class="copyright">Special character</p>
                     </th><th class="calibre27">
                        <p class="copyright">Definition</p>
                     </th></tr></thead><tbody class="calibre15"><tr class="calibre12"><td class="calibre28">
                        <p class="copyright">
                           <span><strong class="calibre5">\C-x</strong></span>
                        </p>
                     </td><td class="calibre29">
                        <p class="copyright">
                           <span><strong class="calibre5">C-x</strong></span> (where x is any letter)</p>
                     </td></tr><tr class="calibre12"><td class="calibre28">
                        <p class="copyright">
                           <span><strong class="calibre5">\C-[ or \e</strong></span>
                        </p>
                     </td><td class="calibre29">
                        <p class="copyright">
                           <span><strong class="calibre5">Esc</strong></span>
                        </p>
                     </td></tr><tr class="calibre12"><td class="calibre28">
                        <p class="copyright">
                           <span><strong class="calibre5">\M</strong></span>
                        </p>
                     </td><td class="calibre29">
                        <p class="copyright">
                           <span><strong class="calibre5">Meta</strong></span>
                        </p>
                     </td></tr><tr class="calibre12"><td class="calibre28">
                        <p class="copyright">
                           <span><strong class="calibre5">\C-j or \n</strong></span>
                        </p>
                     </td><td class="calibre29">
                        <p class="copyright">
                           <span><strong class="calibre5">Newline</strong></span>
                        </p>
                     </td></tr><tr class="calibre12"><td class="calibre28">
                        <p class="copyright">
                           <span><strong class="calibre5">\C-m or \r</strong></span>
                        </p>
                     </td><td class="calibre29">
                        <p class="copyright">
                           <span><strong class="calibre5">Enter</strong></span>
                        </p>
                     </td></tr><tr class="calibre12"><td class="calibre30">
                        <p class="copyright">
                           <span><strong class="calibre5">\C-i or \t</strong></span>
                        </p>
                     </td><td class="calibre31">
                        <p class="copyright">
                           <span><strong class="calibre5">Tab</strong></span>
                        </p>
                     </td></tr></tbody></table></div></div><br class="book"/><p class="copyright">Thus, the string <span><strong class="calibre5">abc\C-a\ndef</strong></span> is
equal to <span><strong class="calibre5">abc</strong></span>, <span><strong class="calibre5">C-a</strong></span>, <span><strong class="calibre5">newline</strong></span>,
and <span><strong class="calibre5">def</strong></span>, all concatenated into one
string. Note that control characters are case-insensitive—that
is, <span><strong class="calibre5">\C-A</strong></span> is the same thing as
<span><strong class="calibre5">\C-a</strong></span>. However, the characters that
follow control characters may be case-sensitive; <span><strong class="calibre5">\C-ae</strong></span> could be different from <span><strong class="calibre5">\C-aE</strong></span>, for example.</p><p class="copyright">The function <span><strong class="calibre5">define-key</strong></span> is the most
general because it can be used to bind keys in any keymap. <span><strong class="calibre5">global-set-key</strong></span> binds keys in the global map
only; since there is only one <span><strong class="calibre5">global-map</strong></span>, <span><strong class="calibre5">(global-set-key ...)</strong></span> is the same as <span><strong class="calibre5">(define-key global-map ...)</strong></span>. The function
<span><strong class="calibre5">local-set-key</strong></span> binds keys in the
local map of the current buffer; it is useful only for specifying
temporary key bindings during an Emacs session.</p><p class="copyright">Here is an example of a simple keyboard customization.
Let's say you are writing code in a programming
language. You compile it and get error messages that contain the line
number of the error, and you want to go to that line in the source
file to correct the error.<sup class="calibre6">[<a id="gnu3-CHP-10-FNOTE-2" href="#ftn.gnu3-CHP-10-FNOTE-2" class="calibre2">2</a>]</sup> You would want to use the <span><strong class="calibre5">goto-line</strong></span> command, which is not bound by
default to any keystroke. Say you want to bind it to <span><strong class="calibre5">C-x l</strong></span>. The command to put into your
<span><em class="calibre7">.emacs</em></span> file is</p><a id="I_10_tt550" class="calibre2"></a><pre class="programlisting">(global-set-key "\C-xl" 'goto-line)</pre><p class="copyright">This binds the <span><strong class="calibre5">l</strong></span> slot in <span><strong class="calibre5">ctl-x-map</strong></span> to the function <span><strong class="calibre5">goto-line</strong></span> globally—that is, in all
modes. Alternatively, you can use either of the following:</p><a id="I_10_tt551" class="calibre2"></a><pre class="programlisting">(define-key global-map "\C-xl" 'goto-line)
(define-key ctl-x-map "l" 'goto-line)</pre><p class="copyright">These commands have the same effect but aren't
really any more efficient or better. And really, you
shouldn't have to know that the keymap for <span><strong class="calibre5">C-x</strong></span> is called <span><strong class="calibre5">ctl-x-map</strong></span>. We'll stick to
showing the <span><strong class="calibre5">global-set-key</strong></span> approach
for the remaining examples, but remember that you have <span><strong class="calibre5">define-key</strong></span> available for situations where
setting the global key is not appropriate, such as when adding a
mode-specific keystroke.</p><p class="copyright">Other examples of key rebindings include binding <span><strong class="calibre5">C-x ?</strong></span> to <span><strong class="calibre5">help-command</strong></span> and <span><strong class="calibre5">C-h</strong></span> to <span><strong class="calibre5">backward-char</strong></span>. These key rebindings are shown
below:</p><a id="I_10_tt552" class="calibre2"></a><pre class="programlisting">(global-set-key "\C-x?" 'help-command)
(global-set-key "\C-h" 'backward-char)</pre><p class="copyright">Notice that these could also be done as</p><a id="I_10_tt553" class="calibre2"></a><pre class="programlisting">(define-key ctl-x-map "?" 'help-command)
(define-key global-map "\C-h" 'backward-char)</pre><p class="copyright">After you put a key binding (or any other code) in your
<span><em class="calibre7">.emacs</em></span> file, you need to
"run" (or evaluate) the file for
the change to take effect. The command for this is <span><strong class="calibre5">M-x eval-current-buffer Enter</strong></span>. Even better,
you could press <span><strong class="calibre5">C-x C-e</strong></span>, which (as
we will see in the next chapter) causes only the single line of Lisp
code that your cursor is on to run. If you don't do
either of these, the changes won't take effect until
the next time you invoke Emacs.</p><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-10-SECT-4.1" class="calibre1"></a>Special Keys</h2></div></div></div><p class="copyright">A more complicated keyboard
<a id="gnu3-CHP-10-ITERM-2719" class="calibre2"></a>
               <a id="gnu3-CHP-10-ITERM-2720" class="calibre2"></a>customization task is binding
commands to special keys, such as arrow, numeric keypad, or function
keys, on your keyboard. This level of customization takes some work,
but if you like using special keys, it is well worth the effort.</p><p class="copyright">Most of the special keys have reasonable names, but using them with
the set key functions discussed above requires using a slightly
different syntax. The name of the key appears inside square brackets
rather than inside double quotes. For example, you could bind the
<span><strong class="calibre5">goto-line</strong></span> command to the function
key F5 like this:</p><a id="I_10_tt554" class="calibre2"></a><pre class="programlisting"> (global-set-key [f5] 'goto-line)</pre><p class="copyright">And you can certainly use modifiers with your special keys.
Control-Alt-F5 can be bound like this:</p><a id="I_10_tt555" class="calibre2"></a><pre class="programlisting"> (global-set-key [C-A-f5] 'goto-line)</pre><p class="copyright">
               <a class="calibre2" href="ch10s04.html#gnu3-CHP-10-TABLE-3" title="Table 10-3. Special key ELisp names">Table 10-3</a> lists the names of some common special
keys.</p><div class="book"><a id="gnu3-CHP-10-TABLE-3" class="calibre2"></a><p class="title2"><b class="calibre25">Table 10-3. Special key ELisp names</b></p><div class="table-contents"><table summary="Special key ELisp names" class="calibre8"><colgroup class="calibre9"><col class="calibre10"/><col class="calibre10"/><col class="calibre10"/><col class="calibre10"/><col class="calibre10"/></colgroup><thead class="calibre11"><tr class="calibre12"><th class="calibre26">
                           <p class="copyright">ELisp Name</p>
                        </th><th class="calibre26">
                           <p class="copyright">Key</p>
                        </th><th class="calibre26">
</th><th class="calibre26">
                           <p class="copyright">ELisp Name</p>
                        </th><th class="calibre27">
                           <p class="copyright">Key</p>
                        </th></tr></thead><tbody class="calibre15"><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">DEL or backspace</p>
                        </td><td class="calibre28">
                           <p class="copyright">Backspace</p>
                        </td><td class="calibre28">
</td><td class="calibre28">
                           <p class="copyright">kp-0 .. kp-9</p>
                        </td><td class="calibre29">
                           <p class="copyright">Keypad numbers 0 through 9</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">delete</p>
                        </td><td class="calibre28">
                           <p class="copyright">Delete key</p>
                        </td><td class="calibre28">
</td><td class="calibre28">
                           <p class="copyright">kp-enter</p>
                        </td><td class="calibre29">
                           <p class="copyright">Enter key on the number pad</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">down</p>
                        </td><td class="calibre28">
                           <p class="copyright">Down arrow key</p>
                        </td><td class="calibre28">
</td><td class="calibre28">
                           <p class="copyright">left</p>
                        </td><td class="calibre29">
                           <p class="copyright">Left arrow key</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">end</p>
                        </td><td class="calibre28">
                           <p class="copyright">End key</p>
                        </td><td class="calibre28">
</td><td class="calibre28">
                           <p class="copyright">next</p>
                        </td><td class="calibre29">
                           <p class="copyright">Page Down</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">f1 .. f35</p>
                        </td><td class="calibre28">
                           <p class="copyright">Function keys F1 through F35</p>
                        </td><td class="calibre28">
</td><td class="calibre28">
                           <p class="copyright">prior</p>
                        </td><td class="calibre29">
                           <p class="copyright">Page Up</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">home</p>
                        </td><td class="calibre28">
                           <p class="copyright">Home key</p>
                        </td><td class="calibre28">
</td><td class="calibre28">
                           <p class="copyright">right</p>
                        </td><td class="calibre29">
                           <p class="copyright">Right arrow key</p>
                        </td></tr><tr class="calibre12"><td class="calibre30">
                           <p class="copyright">help</p>
                        </td><td class="calibre30">
                           <p class="copyright">Help key</p>
                        </td><td class="calibre30">
</td><td class="calibre30">
                           <p class="copyright">up</p>
                        </td><td class="calibre31">
                           <p class="copyright">Up arrow key</p>
                        </td></tr></tbody></table></div></div><br class="book"/></div><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-10-SECT-4.2" class="calibre1"></a>Unsetting Key Bindings</h2></div></div></div><p class="copyright">You can also remove a <a id="gnu3-CHP-10-ITERM-2721" class="calibre2"></a>particular
key binding with the <span><strong class="calibre5">global-unset-key</strong></span> and <span><strong class="calibre5">define-key</strong></span> commands. For example, the
following lines will both remove the <span><strong class="calibre5">goto-line</strong></span> command bindings from our previous
examples:</p><a id="I_10_tt556" class="calibre2"></a><pre class="programlisting">(global-unset-key [f5])
(define-key ctl-x-map "l" nil)</pre><p class="copyright">Of course, you don't need to unset any bindings if
you plan to replace them with something else. But this can be useful
if you have a common "typo" key
that you don't want firing off when you type it by
mistake.</p></div><div class="book"><br class="book"/><hr class="calibre4"/><div class="book"><p class="copyright"><sup class="calibre6">[<a id="ftn.gnu3-CHP-10-FNOTE-1" href="#gnu3-CHP-10-FNOTE-1" class="calibre2">1</a>] </sup>You can use
<span><strong class="calibre5">Meta</strong></span> in place of <span><strong class="calibre5">Esc</strong></span>, but the bindings are still stored in the
<span><strong class="calibre5">esc-map</strong></span>.</p></div><div class="book"><p class="copyright"><sup class="calibre6">[<a id="ftn.gnu3-CHP-10-FNOTE-2" href="#gnu3-CHP-10-FNOTE-2" class="calibre2">2</a>] </sup>There is a better way of
dealing with this situation, which we will cover in the next
chapter.</p></div></div></div></div>

{% endraw %}

