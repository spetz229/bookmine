---
layout: page
title: "Learning GNU Emacs, 3rd Edition"
prev: OEBPS/ch02s05.html
next: OEBPS/ch02s07.html
book_path: books/learning-gnu-emacs--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h1 class="title"><a id="gnu3-CHP-2-SECT-6" class="calibre1"></a>Canceling Commands and Undoing Changes</h1></div></div></div><p class="copyright">Sometimes you start a command by accident or change your mind about
it. Don't worry: with Emacs, you can quit in the
middle or undo it.</p><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-2-SECT-6.1" class="calibre1"></a>Canceling Commands</h2></div></div></div><p class="copyright">When you want to cancel any
<a id="gnu3-CHP-2-ITERM-1788" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1789" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1790" class="calibre2"></a>command
that's in progress, press <span><strong class="calibre5">C-g</strong></span>. The word <span><strong class="calibre5">Quit</strong></span> appears in the command area. This command
is helpful when you are stuck in the minibuffer and
didn't really mean to go there. Depending on what
you were doing, you may have to press <span><strong class="calibre5">C-g</strong></span> a few times.</p></div><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-2-SECT-6.2" class="calibre1"></a>Undoing Changes</h2></div></div></div><p class="copyright">What happens if you make a
<a id="gnu3-CHP-2-ITERM-1791" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1792" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1793" class="calibre2"></a>mistake
while you're editing? You can undo your changes by
pressing <span><strong class="calibre5">C-_</strong></span> or <span><strong class="calibre5">C-x u</strong></span> (for <span><strong class="calibre5">undo</strong></span>; conveniently, the toolbar also has an
undo icon, a curved left arrow). By typing <span><strong class="calibre5">undo</strong></span> repeatedly, you can gradually work your
way back to a point before your mistake.<sup class="calibre6">[<a id="gnu3-CHP-2-FNOTE-7" href="#ftn.gnu3-CHP-2-FNOTE-7" class="calibre2">7</a>]</sup> Although the <span><strong class="calibre5">undo</strong></span>
command is very powerful, saving your file frequently, if not
compulsively, is nevertheless a good idea. We usually save a file
whenever we stop typing—even if only for a few seconds. Train
your fingers to press <span><strong class="calibre5">C-x C-s</strong></span>
whenever you pause; it's a good habit to form.</p><p class="copyright">If you're used to typing <span><strong class="calibre5">C-z</strong></span> to undo, you can easily change
Emacs's behavior to match your habits. See
"Making Emacs Work the Way You
Want" at the end of this chapter for information on
CUA mode.</p><p class="copyright">What if you'd like to redo a command after you type
<span><strong class="calibre5">undo</strong></span>? There is no formal
<span><em class="calibre7">redo</em></span> command, but you can use <span><strong class="calibre5">undo</strong></span> in the following way. Just move the
cursor in any direction, and
<a id="gnu3-CHP-2-ITERM-1794" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1795" class="calibre2"></a>type <span><strong class="calibre5">C-_</strong></span> or <span><strong class="calibre5">C-x u</strong></span>
again. Emacs redoes the last command you undid. You can repeat it to
redo previous <span><strong class="calibre5">undo</strong></span>s.</p><p class="copyright">Although <span><strong class="calibre5">undo</strong></span> is an important
command, it can be slow if you want to undo a large number of
changes. <a class="calibre2" href="ch02s06.html#gnu3-CHP-2-TABLE-11" title="Table 2-11. Methods for undoing changes">Table 2-11</a> summarizes three methods for
undoing changes and circumstances in which you might want to use
them.</p><div class="book"><a id="gnu3-CHP-2-TABLE-11" class="calibre2"></a><p class="title2"><b class="calibre25">Table 2-11. Methods for undoing changes</b></p><div class="table-contents"><table summary="Methods for undoing changes" class="calibre8"><colgroup class="calibre9"><col class="calibre10"/><col class="calibre10"/></colgroup><thead class="calibre11"><tr class="calibre12"><th class="calibre26">
                           <p class="copyright">
                              <span><strong class="calibre5">If you</strong></span>:</p>
                        </th><th class="calibre27">
                           <p class="copyright">
                              <span><strong class="calibre5">Use this command</strong></span>:</p>
                        </th></tr></thead><tbody class="calibre15"><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">Don't like the recent changes
you've made and want to undo them one by one</p>
                        </td><td class="calibre29">
                           <p class="copyright">
                              <span><strong class="calibre5">C-_</strong></span> 
                              <span><em class="calibre7">or</em></span> 
                              <span><strong class="calibre5">C-x u</strong></span> (<span><strong class="calibre5">undo</strong></span>)</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">Want to undo all changes made since you last saved the file</p>
                        </td><td class="calibre29">
                           <p class="copyright">
                              <span><strong class="calibre5">M-x revert-buffer Enter</strong></span>
                           </p>
                        </td></tr><tr class="calibre12"><td class="calibre30">
                           <p class="copyright">Want to go back to an earlier version of the file (the file as it was
when you started this editing session)</p>
                        </td><td class="calibre31">
                           <p class="copyright">
                              <span><strong class="calibre5">C-x C-f</strong></span>
                              <span><em class="calibre7">filename</em></span>
                              <span><strong class="calibre5">~ Enter
C-x C-w</strong></span> 
                              <span><em class="calibre7">filename</em></span> 
                              <span><strong class="calibre5">Enter</strong></span>
                           </p>
                        </td></tr></tbody></table></div></div><br class="book"/><p class="copyright">We've already talked about undoing changes with
<span><strong class="calibre5">undo</strong></span>; next we describe how to revert
a buffer from a file and how to go back to an earlier version.</p></div><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-2-SECT-6.3" class="calibre1"></a>Reverting a Buffer from a File</h2></div></div></div><p class="copyright">If the <span><strong class="calibre5">undo</strong></span> command
isn't
<a id="gnu3-CHP-2-ITERM-1796" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1797" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1798" class="calibre2"></a>useful,
there's another way to restore a file to an earlier
state. If you want to get the file back to the state that is stored
on disk, type <span><strong class="calibre5">M-x revert-buffer
Enter</strong></span>. Emacs asks the following question:</p><a id="I_2_tt68" class="calibre2"></a><pre class="programlisting">Revert buffer from file <em class="calibre7"><code class="calibre32">filename</code></em>? (yes or no)</pre><p class="copyright">The filename is the name of your original file. Type <span><strong class="calibre5">yes</strong></span> if you want to restore the file, or
<span><strong class="calibre5">no</strong></span> if you've
changed your mind. Emacs copies the file stored on disk into the
buffer, conveniently forgetting everything that happened since the
last time you saved the file. Although this command is called
<span><strong class="calibre5">revert-buffer</strong></span>, note that it can
revert only buffers associated with files.</p></div><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-2-SECT-6.4" class="calibre1"></a>Going Back to a Previous Version: Backup Files</h2></div></div></div><p class="copyright">The first time you save a file during
<a id="gnu3-CHP-2-ITERM-1799" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1800" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1801" class="calibre2"></a>an editing session, Emacs creates a
backup file. If something disastrous happens, and the other
techniques for undoing changes won't help you, you
can always return to the backup file. The <a id="gnu3-CHP-2-ITERM-1802" class="calibre2"></a>name of the backup file is the same as the
name of the file you're editing, with a tilde
(<span><strong class="calibre5">~</strong></span>) added. For example, if you are
editing the file <span><em class="calibre7">text</em></span>, the backup file is
<span><em class="calibre7">text~</em></span>.</p><p class="copyright">Emacs doesn't provide any special commands for
restoring a buffer from the backup copy. The easiest way to do this
is to edit the backup copy and then save it as the real file. For
example, if you were working with a file called
<span><em class="calibre7">text</em></span>, you could: exit Emacs by typing <span><strong class="calibre5">C-x C-c</strong></span>, then start Emacs again by typing
<span><strong class="calibre5">emacs</strong></span> 
               <span><em class="calibre7">text~</em></span>.
After the backup file is displayed, save it as the real file by
typing <span><strong class="calibre5">C-x C-w</strong></span>
               <span><em class="calibre7">text</em></span>
               <span><strong class="calibre5">Enter</strong></span>. As a safeguard, Emacs asks you before it writes
over the original file:</p><a id="I_2_tt69" class="calibre2"></a><pre class="programlisting">File <em class="calibre7"><code class="calibre32">text</code></em> exists; overwrite? (y or n)</pre><p class="copyright">Type <span><strong class="calibre5">y</strong></span> to overwrite the original
<a id="gnu3-CHP-2-ITERM-1803" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1804" class="calibre2"></a>file with the backup file.</p><p class="copyright">GNU Emacs also has a
<a id="gnu3-CHP-2-ITERM-1805" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1806" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1807" class="calibre2"></a>numbered backup facility. If you turn
on numbered backups, Emacs creates a backup file (with the suffix
<span><em class="calibre7">~n~</em></span>) every time you save your file.
<span><em class="calibre7">n</em></span> increments with each successive save. If you
are nervous about deleting older versions, it might be worth using:
you can keep all of your old versions forever, if you want to.
However, numbered backups can also waste disk space; a happy medium
may be to tell Emacs to keep the last <span><em class="calibre7">n</em></span>
versions, where <span><em class="calibre7">n</em></span> is the number of versions you
want to keep. The variables that control numbered backups are
described in Appendix A. If you are interested in full-blown version
control, check out VC mode, discussed in <a class="calibre2" href="ch12.html" title="Chapter 12. Version Control">Chapter 12</a>. <a class="calibre2" href="ch02s06.html#gnu3-CHP-2-TABLE-12" title="Table 2-12. Stopping and undoing commands">Table 2-12</a>
               <a id="gnu3-CHP-2-ITERM-1808" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1809" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1810" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1811" class="calibre2"></a>summarizes the commands for
stopping commands and undoing changes.</p><div class="book"><a id="gnu3-CHP-2-TABLE-12" class="calibre2"></a><p class="title2"><b class="calibre25">Table 2-12. Stopping and undoing commands</b></p><div class="table-contents"><table summary="Stopping and undoing commands" class="calibre8"><colgroup class="calibre9"><col class="calibre10"/><col class="calibre10"/><col class="calibre10"/></colgroup><thead class="calibre11"><tr class="calibre12"><th class="calibre26">
                           <p class="copyright">
                              <span><strong class="calibre5">Keystrokes</strong></span>
                           </p>
                        </th><th class="calibre26">
                           <p class="copyright">
                              <span><strong class="calibre5">Command name</strong></span>
                           </p>
                        </th><th class="calibre27">
                           <p class="copyright">
                              <span><strong class="calibre5">Action</strong></span>
                           </p>
                        </th></tr></thead><tbody class="calibre15"><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">
                              <span><strong class="calibre5">C-g</strong></span>
                           </p>
                        </td><td class="calibre28">
                           <p class="copyright">
                              <span><strong class="calibre5">keyboard-quit</strong></span>
                           </p>
                        </td><td class="calibre29">
                           <p class="copyright">Abort current command.</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">
                              <span><strong class="calibre5">C-x u</strong></span>
                           </p>
                        </td><td class="calibre28">
                           <p class="copyright">
                              <span><strong class="calibre5">advertised-undo<sup class="calibre6">[<a id="gnu3-CHP-2-FNOTE-8" href="#ftn.gnu3-CHP-2-FNOTE-8" class="calibre2">8</a>]</sup>
                              </strong></span>
                           </p>
                        </td><td class="calibre29">
                           <p class="copyright">Undo last edit (can be done repeatedly).</p>
                        </td></tr><tr class="calibre12"><td class="calibre28">
                           <p class="copyright">
                              <span><strong class="calibre5">C-_</strong></span> 
                              <span><em class="calibre7">Edit</em></span>
                              <span>→</span> 
                              <span><em class="calibre7">Undo</em></span>
                           </p>
                        </td><td class="calibre28">
                           <p class="copyright">
                              <span><strong class="calibre5">undo</strong></span>
                           </p>
                        </td><td class="calibre29">
                           <p class="copyright">Undo last edit (can be done repeatedly).</p>
                        </td></tr><tr class="calibre12"><td class="calibre30">
                           <p class="copyright">(<span><em class="calibre7">none</em></span>)</p>
                        </td><td class="calibre30">
                           <p class="copyright">
                              <span><strong class="calibre5">revert-buffer</strong></span>
                           </p>
                        </td><td class="calibre31">
                           <p class="copyright">Restore buffer to the state it was in when the file was last saved
(or auto-saved).</p>
                        </td></tr></tbody><tbody class="calibre15"><tr class="calibre12"><td colspan="3" class="calibre31"><div class="book"><p class="copyright"><sup class="calibre6">[<a id="ftn.gnu3-CHP-2-FNOTE-8" href="#gnu3-CHP-2-FNOTE-8" class="calibre2">8</a>] </sup>There is no
real difference between <span><strong class="calibre5">undo</strong></span> and
<span><strong class="calibre5">advertised-undo</strong></span>. They work the same
way.</p></div></td></tr></tbody></table></div></div><br class="book"/></div><div class="book" xml:lang="en"><div class="book"><div class="book"><div class="book"><h2 class="title1"><a id="gnu3-CHP-2-SECT-6.5" class="calibre1"></a>Recovering Lost Changes</h2></div></div></div><p class="copyright">We've just discussed how to
<a id="gnu3-CHP-2-ITERM-1812" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1813" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1814" class="calibre2"></a>eliminate
changes you don't want to keep; getting back changes
you've lost is a different kind of problem. You
might lose changes if the power goes out momentarily or if the
computer you're working on suddenly freezes or is
turned off accidentally. You might also lose changes if you exit
Emacs abnormally. Luckily, Emacs, being the watchful editor that it
is, saves your file for you every so often in <span><em class="calibre7">auto-save
files</em></span>. If you watch carefully, you'll see
the message <span><strong class="calibre5">Auto saving</strong></span> in the
minibuffer from time to time. Using auto-save files, you can get back
most, if not all, of your changes. The name of an auto-save file is
the same as the name of the file you are editing, with a sharp
(<span><strong class="calibre5">#</strong></span>) added to the beginning and the
end. For example, if you are editing the file
<span><em class="calibre7">text</em></span>, its auto-save file is
<span><em class="calibre7">#text#</em></span>.</p><p class="copyright">To recover text from an <a id="gnu3-CHP-2-ITERM-1815" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1816" class="calibre2"></a>auto-save file, type <span><strong class="calibre5">M-x recover-file Enter</strong></span>. Emacs opens a window
that lists both the file and its associated auto-save file so that
you can compare the time at which they were created, their size, and
so forth. Emacs asks you the following question:</p><a id="I_2_tt70" class="calibre2"></a><pre class="programlisting">Recover auto-save file <em class="calibre7"><code class="calibre32">#text#</code></em>? (yes or no)</pre><p class="copyright">Type <span><strong class="calibre5">yes</strong></span> to confirm that you want to
copy the contents of the auto-save file into the current file or
<span><strong class="calibre5">no</strong></span> if you change your mind. (If you
are unsure, you might want to use <span><strong class="calibre5">C-x
C-f</strong></span> to read the auto-save file <span><em class="calibre7">#text#</em></span>
into a buffer first and look it over carefully before using the
<span><strong class="calibre5">recover-file</strong></span> command. If you really
want to compare the differences between the two versions, see
"Comparing Files Between Windows"
in <a class="calibre2" href="ch04.html" title="Chapter 4. Using Buffers, Windows, and Frames">Chapter 4</a>.)</p><p class="copyright">When does Emacs create <a id="gnu3-CHP-2-ITERM-1817" class="calibre2"></a>
               <a id="gnu3-CHP-2-ITERM-1818" class="calibre2"></a>auto-save
files? Emacs creates an auto-save file every few hundred keystrokes
or if Emacs is terminated abnormally.<sup class="calibre6">[<a id="gnu3-CHP-2-FNOTE-9" href="#ftn.gnu3-CHP-2-FNOTE-9" class="calibre2">9</a>]</sup>
You can change the frequency with which Emacs creates auto-save files
by changing the variable <span><strong class="calibre5">auto-save-interval</strong></span>. By default, Emacs creates
an auto-save file every 300 keystrokes. For more information on
changing variable values, see <a class="calibre2" href="ch10.html" title="Chapter 10. Customizing Emacs">Chapter 10</a>.</p><p class="copyright">There's one more important fact to know about Emacs
and auto-save files. If you delete a large portion of a file, Emacs
stops auto-saving the file and displays a message telling you so. To
make Emacs start auto-saving again, save the file with <span><strong class="calibre5">C-x C-s</strong></span> or type <span><strong class="calibre5">M-1 M-x
auto-save Enter</strong></span> (that's the number 1).</p><p class="copyright">Now you've learned enough commands for most of the
editing you'll do with Emacs. At this point, you may
want to learn how to make Emacs turn on certain features like
auto-fill mode automatically, so you don't have to
turn them on every time you enter Emacs. The next section provides a
brief introduction to customization; this topic is covered in much
greater detail in <a class="calibre2" href="ch10.html" title="Chapter 10. Customizing Emacs">Chapter 10</a>.</p></div><div class="book"><br class="book"/><hr class="calibre4"/><div class="book"><p class="copyright"><sup class="calibre6">[<a id="ftn.gnu3-CHP-2-FNOTE-7" href="#gnu3-CHP-2-FNOTE-7" class="calibre2">7</a>] </sup>If you find
that you repeat the undo command frequently, it's
worth getting fluent with <span><strong class="calibre5">C-_</strong></span>.
It's true that this requires holding down <span><strong class="calibre5">Ctrl</strong></span> and <span><strong class="calibre5">Shift</strong></span> at the same time, but once
you've got that down, pressing <span><strong class="calibre5">_</strong></span> repeatedly is much easier than typing
<span><strong class="calibre5">C-x u</strong></span> again and again.</p></div><div class="book"><p class="copyright"><sup class="calibre6">[<a id="ftn.gnu3-CHP-2-FNOTE-9" href="#gnu3-CHP-2-FNOTE-9" class="calibre2">9</a>] </sup>We should say
that Emacs <span><em class="calibre7">tries</em></span> to do this. In some cases,
Emacs can't, and there is really no guarantee. Power
surges and OS crashes are examples of times where things happen so
fast that Emacs may not be able to create an auto-save file. But we
are surprised at how often it manages to do so.</p></div></div></div></div>

{% endraw %}

