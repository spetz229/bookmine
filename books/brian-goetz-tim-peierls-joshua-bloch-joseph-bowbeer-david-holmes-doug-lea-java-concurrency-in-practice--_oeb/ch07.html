---
layout: page
title: "Java Concurrency in Practice"
prev: ch06lev1sec4.html
next: ch07lev1sec1.html
book_path: books/brian-goetz-tim-peierls-joshua-bloch-joseph-bowbeer-david-holmes-doug-lea-java-concurrency-in-practice--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<a name="ch07" class="calibre18" id="ch07"></a>
<div class="calibre32" id="calibre_pb_0"></div><div class="calibre32"></div><h2 id="title-IDAQAFIC" class="docPrefaceTitle">Chapter 7. Cancellation and Shutdown</h2>
<p class="docText1"><a name="iddle1043" class="calibre18" id="iddle1043"></a><a name="iddle1044" class="calibre18" id="iddle1044"></a><a name="iddle1296" class="calibre18" id="iddle1296"></a><a name="iddle1297" class="calibre18" id="iddle1297"></a><a name="iddle1298" class="calibre18" id="iddle1298"></a><a name="iddle1299" class="calibre18" id="iddle1299"></a><a name="iddle1314" class="calibre18" id="iddle1314"></a><a name="iddle1351" class="calibre18" id="iddle1351"></a><a name="iddle1354" class="calibre18" id="iddle1354"></a><a name="iddle1565" class="calibre18" id="iddle1565"></a><a name="iddle1643" class="calibre18" id="iddle1643"></a><a name="iddle2034" class="calibre18" id="iddle2034"></a><a name="iddle2309" class="calibre18" id="iddle2309"></a><a name="iddle2735" class="calibre18" id="iddle2735"></a><a name="iddle2796" class="calibre18" id="iddle2796"></a><a name="iddle2811" class="calibre18" id="iddle2811"></a><a name="iddle2812" class="calibre18" id="iddle2812"></a><a name="iddle2963" class="calibre18" id="iddle2963"></a><a name="iddle2964" class="calibre18" id="iddle2964"></a><a name="iddle2965" class="calibre18" id="iddle2965"></a><a name="iddle2966" class="calibre18" id="iddle2966"></a><a name="iddle2967" class="calibre18" id="iddle2967"></a><a name="iddle2968" class="calibre18" id="iddle2968"></a><a name="iddle2969" class="calibre18" id="iddle2969"></a><a name="iddle2970" class="calibre18" id="iddle2970"></a><a name="iddle2971" class="calibre18" id="iddle2971"></a><a name="iddle2975" class="calibre18" id="iddle2975"></a><a name="iddle3650" class="calibre18" id="iddle3650"></a><a name="iddle3651" class="calibre18" id="iddle3651"></a><a name="iddle3798" class="calibre18" id="iddle3798"></a><a name="iddle4246" class="calibre18" id="iddle4246"></a><a name="iddle4251" class="calibre18" id="iddle4251"></a><a name="iddle4467" class="calibre18" id="iddle4467"></a><a name="iddle4514" class="calibre18" id="iddle4514"></a><a name="iddle4609" class="calibre18" id="iddle4609"></a><a name="iddle4674" class="calibre18" id="iddle4674"></a><a name="iddle4675" class="calibre18" id="iddle4675"></a><a name="iddle4676" class="calibre18" id="iddle4676"></a><a name="iddle4684" class="calibre18" id="iddle4684"></a><a name="iddle4775" class="calibre18" id="iddle4775"></a><a name="iddle4776" class="calibre18" id="iddle4776"></a><a name="iddle4828" class="calibre18" id="iddle4828"></a><a name="iddle4841" class="calibre18" id="iddle4841"></a><a name="iddle4842" class="calibre18" id="iddle4842"></a><a name="iddle4843" class="calibre18" id="iddle4843"></a><a name="iddle4844" class="calibre18" id="iddle4844"></a><a name="iddle5014" class="calibre18" id="iddle5014"></a>It is easy to start tasks and threads. Most of the time we allow them to decide when to stop by letting them run to completion. Sometimes, however, we want to stop tasks or threads earlier than they would on their own, perhaps because the user cancelled an operation or the application needs to shut down quickly.</p>
<p class="docText1">Getting tasks and threads to stop safely, quickly, and reliably is not always easy. Java does not provide any mechanism for safely forcing a thread to stop what it is doing.<sup class="docFootnote"><a class="calibre2" href="#ch07fn01">[1]</a></sup> Instead, it provides <span class="docEmphasis">interruption</span>, a cooperative mechanism that lets one thread ask another to stop what it is doing.</p><blockquote class="calibre19"><p class="docFootnote1"><sup class="calibre27"><a name="ch07fn01" class="calibre18" id="ch07fn01">[1]</a></sup> The deprecated <tt class="calibre35">Thread.stop</tt> and <tt class="calibre35">suspend</tt> methods were an attempt to provide such a mechanism, but were quickly realized to be seriously flawed and should be avoided. See <tt class="calibre35"><a class="calibre2" target="_blank" href="http://java.sun.com/j2se/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html">http://java.sun.com/j2se/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html</a></tt> for an explanation of the problems with these methods.</p></blockquote>
<p class="docText1">The cooperative approach is required because we rarely want a task, thread, or service to stop <span class="docEmphasis">immediately</span>, since that could leave shared data structures in an inconsistent state. Instead, tasks and services can be coded so that, when requested, they clean up any work currently in progress and <span class="docEmphasis">then</span> terminate. This provides greater flexibility, since the task code itself is usually better able to assess the cleanup required than is the code requesting cancellation.</p>
<p class="docText1">End-of-lifecycle issues can complicate the design and implementation of tasks, services, and applications, and this important element of program design is too often ignored. Dealing well with failure, shutdown, and cancellation is one of the characteristics that distinguishes a well-behaved application from one that merely works. This chapter addresses mechanisms for cancellation and interruption, and how to code tasks and services to be responsive to cancellation requests.</p>

<p class="calibre1">Â </p>

</div>

{% endraw %}

