---
layout: page
title: "Developing Backbone.js Applications"
prev: OEBPS/ch04s10.html
next: OEBPS/ch04s12.html
book_path: books/developing-backbone-js-applications-addy-osmani--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Paginator.requestPager"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="paginator.requestpager" class="calibre1"></a>Paginator.requestPager</h1></div></div></div><p class="calibre6">
      In this section we’re going to walkthrough actually using the
      requestPager.
    </p><div class="book" title="1. Create a new Paginated collection"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="create-a-new-paginated-collection" class="calibre1"></a>1. Create a new Paginated collection</h2></div></div></div><p class="calibre6">
        First, we define a new Paginated collection using
        <code class="literal">Backbone.Paginator.requestPager()</code> as follows:
      </p><pre class="programlistingjavascript"><code class="kd">var</code> <code class="nx">PaginatedCollection</code> <code class="o">=</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">Paginator</code><code class="p">.</code><code class="nx">requestPager</code><code class="p">.</code><code class="nx">extend</code><code class="p">({</code>
      
</pre></div><div class="book" title="2: Set the model and base URL for the collection as normal"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="set-the-model-and-base-url-for-the-collection-as-normal" class="calibre1"></a>2: Set the model and base URL for the collection as
      normal</h2></div></div></div><p class="calibre6">
        Within our collection, we then (as normal) specify the model to
        be used with this collection followed by the URL (or base URL)
        for the service providing our data (e.g the Netflix API).
      </p><pre class="programlistingjavascript"><code class="nx">model</code><code class="o">:</code> <code class="nx">model</code><code class="p">,</code>
        <code class="nx">url</code><code class="o">:</code> <code class="s">'http://odata.netflix.com/v2/Catalog/Titles?&amp;'</code><code class="p">,</code>
</pre></div><div class="book" title="3. Map the attributes supported by your API (URL)"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="map-the-attributes-supported-by-your-api-url" class="calibre1"></a>3. Map the attributes supported by your API (URL)</h2></div></div></div><p class="calibre6">
        Next, we’re going to map the request (URL) parameters supported
        by your API or backend data service back to attributes that are
        internally used by Backbone.Paginator.
      </p><p class="calibre6">
        For example: the NetFlix API refers to it’s parameter for
        stating how many results to skip ahead by as
        <code class="literal">$skip</code> and it’s number of items to return per
        page as <code class="literal">$top</code> (amongst others). We determine
        these by looking at a sample URL pointing at the service:
      </p><pre class="programlistingjavascript"><code class="nx">http</code><code class="o">:</code><code class="c">//odata.netflix.com/v2/Catalog/Titles?&amp;callback=callback&amp;$top=30&amp;$skip=30&amp;orderBy=ReleaseYear&amp;$inlinecount=allpages&amp;$format=json&amp;$callback=callback&amp;$filter=substringof%28%27the%27,%20Name%29%20eq%20true&amp;_=1332702202090</code>
</pre><p class="calibre6">
        We then simply map these parameters to the relevant Paginator
        equivalents shown on the left hand side of the next snippets to
        get everything working:
      </p><pre class="programlistingjavascript">        <code class="c">// @param-name for the query field in the </code>
        <code class="c">// request (e.g query/keywords/search)</code>
        <code class="nx">queryAttribute</code><code class="o">:</code> <code class="s">'$filter'</code><code class="p">,</code>

        <code class="c">// @param-name for number of items to return per request/page</code>
        <code class="nx">perPageAttribute</code><code class="o">:</code> <code class="s">'$top'</code><code class="p">,</code>

        <code class="c">// @param-name for how many results the request should skip ahead to</code>
        <code class="nx">skipAttribute</code><code class="o">:</code> <code class="s">'$skip'</code><code class="p">,</code>

        <code class="c">// @param-name for the direction to sort in</code>
        <code class="nx">sortAttribute</code><code class="o">:</code> <code class="s">'$sort'</code><code class="p">,</code>

        <code class="c">// @param-name for field to sort by</code>
        <code class="nx">orderAttribute</code><code class="o">:</code> <code class="s">'$orderBy'</code><code class="p">,</code>

        <code class="c">// @param-name for the format of the request</code>
        <code class="nx">formatAttribute</code><code class="o">:</code> <code class="s">'$format'</code><code class="p">,</code>

        <code class="c">// @param-name for a custom attribute </code>
        <code class="nx">customAttribute1</code><code class="o">:</code> <code class="s">'$inlinecount'</code><code class="p">,</code>

        <code class="c">// @param-name for another custom attribute</code>
        <code class="nx">customAttribute2</code><code class="o">:</code> <code class="s">'$callback'</code><code class="p">,</code>
</pre><p class="calibre6">
        <span class="firstname"><strong class="calibre8">Note</strong></span>: you can define support
        for new custom attributes in Backbone.Paginator if needed (e.g
        customAttribute1) for those that may be unique to your service.
      </p></div><div class="book" title="4. Configure the default pagination, query and sort details for the paginator"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="configure-the-default-pagination-query-and-sort-details-for-the-paginator" class="calibre1"></a>4. Configure the default pagination, query and sort details
      for the paginator</h2></div></div></div><p class="calibre6">
        Now, let’s configure the default values in our collection for
        these parameters so that as a user navigates through the
        paginated UI, requests are able to continue querying with the
        correct field to sort on, the right number of items to return
        per request etc.
      </p><p class="calibre6">
        e.g: If we want to request the:
      </p><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="calibre6">
            1st page of results
          </p></li><li class="listitem"><p class="calibre6">
            for the search query <span class="firstname">“<span class="firstname">superman</span>”</span>
          </p></li><li class="listitem"><p class="calibre6">
            in JSON format
          </p></li><li class="listitem"><p class="calibre6">
            sorted by release year
          </p></li><li class="listitem"><p class="calibre6">
            in ascending order
          </p></li><li class="listitem"><p class="calibre6">
            where only 30 results are returned per request
          </p></li></ul></div><p class="calibre6">
        This would look as follows:
      </p><pre class="programlistingjavascript">        <code class="c">// current page to query from the service</code>
        <code class="nx">page</code><code class="o">:</code> <code class="mi">5</code><code class="p">,</code>

        <code class="c">// The lowest page index your API allows to be accessed</code>
        <code class="nx">firstPage</code><code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="c">//some begin with 1</code>

        <code class="c">// how many results to query from the service (i.e how many to return</code>
        <code class="c">// per request)</code>
        <code class="nx">perPage</code><code class="o">:</code> <code class="mi">30</code><code class="p">,</code>

        <code class="c">// maximum number of pages that can be queried from </code>
        <code class="c">// the server (only here as a default in case your </code>
        <code class="c">// service doesn't return the total pages available)</code>
        <code class="nx">totalPages</code><code class="o">:</code> <code class="mi">10</code><code class="p">,</code>

        <code class="c">// what field should the results be sorted on?</code>
        <code class="nx">sortField</code><code class="o">:</code> <code class="s">'ReleaseYear'</code><code class="p">,</code>

        <code class="c">// what direction should the results be sorted in?</code>
        <code class="nx">sortDirection</code><code class="o">:</code> <code class="s">'asc'</code><code class="p">,</code>

        <code class="c">// what would you like to query (search) from the service?</code>
        <code class="c">// as Netflix reqires additional parameters around the query</code>
        <code class="c">// we simply fill these around our search term</code>
        <code class="nx">query</code><code class="o">:</code> <code class="s">"substringof('"</code> <code class="o">+</code> <code class="nx">escape</code><code class="p">(</code><code class="s">'the'</code><code class="p">)</code> <code class="o">+</code> <code class="s">"',Name)"</code><code class="p">,</code>

        <code class="c">// what format would you like to request results in?</code>
        <code class="nx">format</code><code class="o">:</code> <code class="s">'json'</code><code class="p">,</code>

        <code class="c">// what other custom parameters for the request do </code>
        <code class="c">// you require</code>
        <code class="c">// for your application?</code>
        <code class="nx">customParam1</code><code class="o">:</code> <code class="s">'allpages'</code><code class="p">,</code>

        <code class="nx">customParam2</code><code class="o">:</code> <code class="s">'callback'</code><code class="p">,</code>
</pre><p class="calibre6">
        As the particular API we’re using requires
        <code class="literal">callback</code> and <code class="literal">allpages</code>
        parameters to also be passed, we simply define the values for
        these as custom parameters which can be mapped back to
        requestPager as needed.
      </p></div><div class="book" title="5. Finally, configure Collection.parse() and we’re done"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="finally-configure-collection.parse-and-were-done" class="calibre1"></a>5. Finally, configure Collection.parse() and we’re
      done</h2></div></div></div><p class="calibre6">
        The last thing we need to do is configure our collection’s
        <code class="literal">parse()</code> method. We want to ensure we’re
        returning the correct part of our JSON response containing the
        data our collection will be populated with, which below is
        <code class="literal">response.d.results</code> (for the Netflix API).
      </p><p class="calibre6">
        You might also notice that we’re setting
        <code class="literal">this.totalPages</code> to the total page count
        returned by the API. This allows us to define the maximum number
        of (result) pages available for the current/last request so that
        we can clearly display this in the UI. It also allows us to
        infuence whether clicking say, a <span class="firstname">“<span class="firstname">next</span>”</span> button
        should proceed with a request or not.
      </p><pre class="programlistingjavascript"><code class="nx">parse</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">response</code><code class="p">)</code> <code class="p">{</code>
            <code class="c">// Be sure to change this based on how your results</code>
            <code class="c">// are structured (e.g d.results is Netflix specific)</code>
            <code class="kd">var</code> <code class="nx">tags</code> <code class="o">=</code> <code class="nx">response</code><code class="p">.</code><code class="nx">d</code><code class="p">.</code><code class="nx">results</code><code class="p">;</code>
            <code class="c">//Normally this.totalPages would equal response.d.__count</code>
            <code class="c">//but as this particular NetFlix request only returns a</code>
            <code class="c">//total count of items for the search, we divide.</code>
            <code class="kd">this</code><code class="p">.</code><code class="nx">totalPages</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">d</code><code class="p">.</code><code class="nx">__count</code> <code class="o">/</code> <code class="kd">this</code><code class="p">.</code><code class="nx">perPage</code><code class="p">);</code>
            <code class="kd">return</code> <code class="nx">tags</code><code class="p">;</code>
        <code class="p">}</code>
    <code class="p">});</code>

<code class="p">});</code>
</pre></div><div class="book" title="Convenience methods:"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="convenience-methods" class="calibre1"></a>Convenience methods:</h2></div></div></div><p class="calibre6">
        For your convenience, the following methods are made available
        for use in your views to interact with the
        <code class="literal">requestPager</code>:
      </p><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="calibre6">
            <span class="firstname"><strong class="calibre8">Collection.goTo(n)</strong></span> - go
            to a specific page
          </p></li><li class="listitem"><p class="calibre6">
            <span class="firstname"><strong class="calibre8">Collection.requestNextPage()</strong></span>
            - go to the next page
          </p></li><li class="listitem"><p class="calibre6">
            <span class="firstname"><strong class="calibre8">Collection.requestPreviousPage()</strong></span>
            - go to the previous page
          </p></li><li class="listitem"><p class="calibre6">
            <span class="firstname"><strong class="calibre8">Collection.howManyPer(n)</strong></span>
            - set the number of items to display per page
          </p></li></ul></div></div></div></div>

{% endraw %}

