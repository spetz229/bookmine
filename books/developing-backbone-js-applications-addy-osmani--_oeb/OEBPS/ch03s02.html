---
layout: page
title: "Developing Backbone.js Applications"
prev: OEBPS/ch03.html
next: OEBPS/ch03s03.html
book_path: books/developing-backbone-js-applications-addy-osmani--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Stack 1: Building A Backbone App With Node.js, Express, Mongoose and MongoDB"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="stack-1-building-a-backbone-app-with-node.js-express-mongoose-and-mongodb" class="calibre1"></a>Stack 1: Building A Backbone App With Node.js,
  Express, Mongoose and MongoDB</h1></div></div></div><p class="calibre6">
    The first stack we’ll be looking at is:
  </p><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="calibre6">
        <a class="ulink" href="http://nodejs.org">Node.js</a>
      </p></li><li class="listitem"><p class="calibre6">
        <a class="ulink" href="http://expressjs.com/">Express</a>
      </p></li><li class="listitem"><p class="calibre6">
        <a class="ulink" href="http://mongoosejs.com/">Mongoose</a>
      </p></li><li class="listitem"><p class="calibre6">
        and <a class="ulink" href="http://www.mongodb.org/">MongoDB</a>
      </p></li></ul></div><p class="calibre6">
    with <a class="ulink" href="http://jade-lang.com/">Jade</a> used optionally
    as a view/templating engine.
  </p><div class="book" title="Reviewing the stack"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="reviewing-the-stack" class="calibre1"></a>Reviewing the stack</h2></div></div></div><p class="calibre6">
      As you may know, node.js is an event-driven platform (built on the
      <a class="ulink" href="http://code.google.com/apis/v8/design.html">V8</a>
      runtime), designed for writing fast, scalable network
      applications. It’s reasonably lightweight, efficient and great for
      real-time applications that are data-intensive.
    </p><p class="calibre6">
      Express is a small web-development framework written with node.js,
      based on <a class="ulink" href="http://www.sinatrarb.com/">Sinatra</a>.
      It supports a number of useful features such as intuitive views,
      robust routing and a focus on high performance.
    </p><p class="calibre6">
      Next on the list are MongoDB and Mongoose. MongoDB is an
      open-source, document-oriented database store designed with
      scalability and agility in mind. As a
      <a class="ulink" href="http://en.wikipedia.org/wiki/NoSQL">noSQL</a>
      database, rather than storing data in tables and rows (something
      we’re very used to doing with relational databases), with MongoDB
      we instead store JSON-like documents using dynamic schemas. One of
      the goals of Mongo is to try bridging the gap between key-value
      stores (speed, scalability) and
      <a class="ulink" href="http://en.wikipedia.org/wiki/Relational_database">relational</a>
      databases (rich functionality).
    </p><p class="calibre6">
      Mongoose is a JavaScript library that simplifies how we interact
      with Mongo. Like Express, it’s designed to work within the node.js
      environment and tries to solve some of the complexities with
      asynchronous data storage by offering a more user-friendly API. It
      also adds chaining features into the mix, allowing for a slightly
      more expressive way of dealing with our data.
    </p><p class="calibre6">
      Jade is a template engine influenced by Haml (which we’ll be
      looking at later). It’s implemented with JavaScript (and also runs
      under node). In addition to supporting Express out of the box, it
      boasts a number of useful features including support for mixins,
      includes, caching, template inheritance and much more. Whilst
      abstractions like Jade certainly aren’t for everyone, our
      practical will cover working both with and without it.
    </p></div><div class="book" title="Practical"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="practical" class="calibre1"></a>Practical</h2></div></div></div><p class="calibre6">
      For this practical, we’re going to once again look at extending
      the popular Backbone Todo application. Rather than relying on
      localStorage for data persistence, we’re going to switch to
      storing Todos in a MongoDB document-store instead. The code for
      this practical can be found in
      <code class="literal">practicals\stacks\option2</code>
    </p><p class="calibre6">
      <span class="firstname"><strong class="calibre8">app.js</strong></span>
    </p><p class="calibre6">
      (See
      <a class="ulink" href="https://github.com/addyosmani/backbone-boilerplates/blob/master/option2/app.js">here</a>
      for the source)
    </p><p class="calibre6">
      We must first include the node dependencies required by our
      application. These are Express, Mongoose and Path (a module
      containing utilities for dealing with file paths.
    </p><pre class="programlistingjavascript"><code class="kd">var</code> <code class="nx">application_root</code> <code class="o">=</code> <code class="nx">__dirname</code><code class="p">,</code>
  <code class="nx">express</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s">"express"</code><code class="p">),</code>
  <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s">"path"</code><code class="p">),</code>
  <code class="nx">mongoose</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s">'mongoose'</code><code class="p">);</code>
</pre><p class="calibre6">
      Next, create a new Express server.
      <code class="literal">express.createServer()</code> is a simple way of
      creating an instance of express.HTTPServer, which we’ll be using
      to pass in our routes.
    </p><pre class="programlistingjavascript"><code class="kd">var</code> <code class="nx">app</code> <code class="o">=</code> <code class="nx">express</code><code class="p">.</code><code class="nx">createServer</code><code class="p">();</code>
</pre><p class="calibre6">
      After this, connect Mongoose up to a database (in our case,
      localhost should suffice). Should you require the ability to pass
      in authentication information, here’s a sample containing all of
      the supported URL parameters:
      <code class="literal">mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</code>
    </p><pre class="programlistingjavascript"><code class="nx">mongoose</code><code class="p">.</code><code class="nx">connect</code><code class="p">(</code><code class="s">'mongodb://localhost/my_database'</code><code class="p">);</code>
</pre><p class="calibre6">
      A Mongoose model for any Todo item can now be easily defined by
      passing a schema instance to <code class="literal">mongoose.model</code>. In
      our case the schema covers a Todo item’s <code class="literal">text</code>
      content, its <code class="literal">done</code> state and
      <code class="literal">order</code> position in the overall Todo list.
    </p><pre class="programlistingjavascript"><code class="kd">var</code> <code class="nx">Todo</code> <code class="o">=</code> <code class="nx">mongoose</code><code class="p">.</code><code class="nx">model</code><code class="p">(</code><code class="s">'Todo'</code><code class="p">,</code> <code class="kd">new</code> <code class="nx">mongoose</code><code class="p">.</code><code class="nx">Schema</code><code class="p">({</code>
  <code class="nx">text</code><code class="o">:</code> <code class="nb">String</code><code class="p">,</code>
  <code class="nx">done</code><code class="o">:</code> <code class="nb">Boolean</code><code class="p">,</code>
  <code class="nx">order</code><code class="o">:</code> <code class="nb">Number</code>
<code class="p">}));</code>
</pre><p class="calibre6">
      The <code class="literal">configure()</code> methods allows us to setup what
      we need for the current environment with our Express server. Note
      that lower down in the configuration are two view/view related
      lines. The last one explicitly sets the viewing/templating engine
      to be used as Jade
      <code class="literal">app.set('view engine', 'jade')</code>. We can avoid
      these if we wish to use plain HTML/JS for our templates instead.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">configure</code><code class="p">(</code><code class="kd">function</code><code class="p">(){</code>
  <code class="c">// the bodyParser middleware parses JSON request bodies</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="nx">bodyParser</code><code class="p">());</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="nx">methodOverride</code><code class="p">());</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">app</code><code class="p">.</code><code class="nx">router</code><code class="p">);</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="kd">static</code><code class="p">(</code><code class="nx">path</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="nx">application_root</code><code class="p">,</code> <code class="s">"public"</code><code class="p">)));</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="nx">errorHandler</code><code class="p">({</code> <code class="nx">dumpExceptions</code><code class="o">:</code> <code class="kd">true</code><code class="p">,</code> <code class="nx">showStack</code><code class="o">:</code> <code class="kd">true</code> <code class="p">}));</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s">'views'</code><code class="p">,</code> <code class="nx">path</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="nx">application_root</code><code class="p">,</code> <code class="s">"views"</code><code class="p">));</code>
  <code class="nx">app</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s">'view engine'</code><code class="p">,</code> <code class="s">'jade'</code><code class="p">)</code>
<code class="p">});</code>
</pre><p class="calibre6">
      Should you prefer to switch out Jade for an alternative view
      engine, this can be done fairly trivially. See the section under
      <span class="firstname">“<span class="firstname">Templating</span>”</span> here:
      https://github.com/joyent/node/wiki/modules. For example, to
      switch to EJS, you would simply write
      <code class="literal">app.set('view engine', 'ejs')</code>
    </p><p class="calibre6">
      Express makes use of common HTTP verbs (get, put, post etc.) to
      provide easy to use, expressive routing API based on CRUD (Create,
      Read, Update and Delete). Below for example, we can define what
      happens when the browser requests the root <span class="firstname">“<span class="firstname">/</span>”</span>. As a
      trivial route in this application, it doesn’t do anything
      particularly exciting, however getters typically read or retrieve
      data.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'/'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s">'Hello World'</code><code class="p">);</code>
<code class="p">});</code>
</pre><p class="calibre6">
      Onto something a little more useful and in our next route,
      navigating to <span class="firstname">“<span class="firstname">/todo</span>”</span> will actually render our Jade
      view <span class="firstname">“<span class="firstname">todo.jade</span>”</span>, as seen in the callback. Additional
      configuration values can be passed as the second parameter, such
      as the custom title specified below.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'/todo'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s">'todo'</code><code class="p">,</code> <code class="p">{</code><code class="nx">title</code><code class="o">:</code> <code class="s">"Our sample application"</code><code class="p">});</code>
<code class="p">});</code>
</pre><p class="calibre6">
      Next, we can see the first of our <span class="firstname">“<span class="firstname">/api/</span>”</span> routes.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'/api/todos'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="kd">return</code> <code class="nx">Todo</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="nx">todos</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">todos</code><code class="p">);</code>
  <code class="p">});</code>
<code class="p">});</code>
</pre><p class="calibre6">
      The callback to our next route supports querying for todos based
      on a specific ID. The route string itself (once compiled) will be
      converted from <span class="firstname">“<span class="firstname">/api/todos/:id</span>”</span> to a regular
      expression. As you might have guessed, this is a hint that routes
      can also be regular expression literals if we wished to do
      something more complex.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'/api/todos/:id'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="kd">return</code> <code class="nx">Todo</code><code class="p">.</code><code class="nx">findById</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">id</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="nx">todo</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">todo</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">});</code>
<code class="p">});</code>
</pre><p class="calibre6">
      Similarly, we want to support updating todos based on a specific
      ID as well. The following allows us to query a todo by ID and then
      update the values of it’s three attributes (text, done, order)
      easily.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">put</code><code class="p">(</code><code class="s">'/api/todos/:id'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="kd">return</code> <code class="nx">Todo</code><code class="p">.</code><code class="nx">findById</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">id</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="nx">todo</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">todo</code><code class="p">.</code><code class="nx">text</code> <code class="o">=</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">text</code><code class="p">;</code>
    <code class="nx">todo</code><code class="p">.</code><code class="nx">done</code> <code class="o">=</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">done</code><code class="p">;</code>
    <code class="nx">todo</code><code class="p">.</code><code class="nx">order</code> <code class="o">=</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">order</code><code class="p">;</code>
    <code class="kd">return</code> <code class="nx">todo</code><code class="p">.</code><code class="nx">save</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">"updated"</code><code class="p">);</code>
      <code class="p">}</code>
      <code class="kd">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">todo</code><code class="p">);</code>
    <code class="p">});</code>
  <code class="p">});</code>
<code class="p">});</code>
</pre><p class="calibre6">
      We’ve so far covered requesting todos and updating them, but a
      core part of the application requires us to insert (or add) new
      todos to our data-store. Below we can create new <code class="literal">Todo</code>
      models and simply save them.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">post</code><code class="p">(</code><code class="s">'/api/todos'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="kd">var</code> <code class="nx">todo</code><code class="p">;</code>
  <code class="nx">todo</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Todo</code><code class="p">({</code>
    <code class="nx">text</code><code class="o">:</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">text</code><code class="p">,</code>
    <code class="nx">done</code><code class="o">:</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">done</code><code class="p">,</code>
    <code class="nx">order</code><code class="o">:</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">order</code>
  <code class="p">});</code>
  <code class="nx">todo</code><code class="p">.</code><code class="nx">save</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">"created"</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">});</code>
  <code class="kd">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">todo</code><code class="p">);</code>
<code class="p">});</code>
</pre><p class="calibre6">
      We of course also want to support deleting todos (e.g if a todo
      has been <span class="firstname">“<span class="firstname">cleared</span>”</span>, it should be deleted). This also
      works based on a specific todo ID.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="kd">delete</code><code class="p">(</code><code class="s">'/api/todos/:id'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">){</code>
  <code class="kd">return</code> <code class="nx">Todo</code><code class="p">.</code><code class="nx">findById</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">id</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="nx">todo</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">todo</code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">"removed"</code><code class="p">);</code>
        <code class="kd">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s">''</code><code class="p">)</code>
      <code class="p">}</code>
    <code class="p">});</code>
  <code class="p">});</code>
<code class="p">});</code>
</pre><p class="calibre6">
      Finally, this last line is to ensure we’re only listening on the
      port app.js is running.
    </p><pre class="programlistingjavascript"><code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="mi">3000</code><code class="p">);</code>
</pre><p class="calibre6">
      <span class="firstname"><strong class="calibre8">script.js - updating our Backbone.js
      app</strong></span>
    </p><p class="calibre6">
      In the <code class="literal">/public/js</code> folder of options 1 (HTML
      templates) and 2 (Jade) for the practical, you’ll find a version
      of the Backbone Todo app originally by Jerome Gravel-Niquet. Let’s
      pay attention to
      <a class="ulink" href="https://github.com/addyosmani/backbone-boilerplates/blob/master/option2/public/js/script.js">script.js</a>.
      In order to change the application to work with our new back-end,
      we’ll need to make some very minor changes to this.
    </p><p class="calibre6">
      Reviewing <code class="literal">window.TodoList</code> (a Backbone
      Collection), you’ll notice that it has a property called
      <code class="literal">localStorage</code>, which uses the Backbone
      <a class="ulink" href="https://github.com/jeromegn/Backbone.localStorage">localStorage</a>
      adapter in order to facilitate storing data using the browser’s
      localStorage features.
    </p><pre class="programlistingjavascript"><code class="nb">window</code><code class="p">.</code><code class="nx">TodoList</code> <code class="o">=</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">Collection</code><code class="p">.</code><code class="nx">extend</code><code class="p">({</code>

    <code class="c">// Reference to this collection's model.</code>
    <code class="nx">model</code><code class="o">:</code> <code class="nx">Todo</code><code class="p">,</code>

    <code class="c">// Save all of the todo items under the `"todos"` namespace.</code>
    <code class="c">// Typically, this should be a unique name within your application</code>
    <code class="nx">localStorage</code><code class="o">:</code> <code class="kd">new</code> <code class="nx">Store</code><code class="p">(</code><code class="s">"todos"</code><code class="p">),</code>
</pre><p class="calibre6">
      In order to switch it over to our RESTful backend, we’re going to
      make use of the <code class="literal">url</code> property or function on a
      collection to reference its location on the server. Models inside
      of a collection then use <code class="literal">url</code> to construct URLs
      of their own. As all of the CRUD for our RESTful API works on the
      base route <span class="firstname">“<span class="firstname">/api/todos</span>”</span>, this is the value we set
      <code class="literal">url</code> to.
    </p><pre class="programlistingjavascript">    <code class="c">// localStorage: new Store("todos"),</code>
    <code class="nx">url</code><code class="o">:</code> <code class="s">'/api/todos'</code><code class="p">,</code>
</pre><p class="calibre6">
      This is the only change necessary to our existing Backbone
      application in order to get things working. Pretty easy, right?
    </p><p class="calibre6">
      <span class="firstname"><strong class="calibre8">todo.jade</strong></span>
    </p><p class="calibre6">
      The Jade templates for our application cover declarative markup
      for both the index (layout.jade) of the application and the main
      Todo container (todo.jade). It also covers the script-tag
      templates used for rendering each new Todo item that’s added.
    </p><pre class="programlistingjavascript">// Todo App Interface

#todoapp
  .title
    h1 Todos
  .content
    #create-todo
      input#new-todo(placeholder=<code class="ni">&amp;quot;</code>What needs to be done?<code class="ni">&amp;quot;</code>, type=<code class="ni">&amp;quot;</code>text<code class="ni">&amp;quot;</code>)
      span.ui-tooltip-top(style=<code class="ni">&amp;quot;</code>display:none;<code class="ni">&amp;quot;</code>) Press Enter to save this task
    #todos
      ul#todo-list
    #todo-stats


// Templates
script#item-template(type=<code class="ni">&amp;quot;</code>text/template<code class="ni">&amp;quot;</code>)
  <code class="ni">&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>todo <code class="ni">&amp;lt;</code>%= done ? 'done' : '' %<code class="ni">&amp;gt;&amp;quot;&amp;gt;</code>
  .display
    <code class="ni">&amp;lt;</code>input class=<code class="ni">&amp;quot;</code>check<code class="ni">&amp;quot;</code> type=<code class="ni">&amp;quot;</code>checkbox<code class="ni">&amp;quot;</code> <code class="ni">&amp;lt;</code>%= done ? 'checked=<code class="ni">&amp;quot;</code>checked<code class="ni">&amp;quot;</code>' : '' %<code class="ni">&amp;gt;</code> /<code class="ni">&amp;gt;</code>
    .todo-text 
    span#todo-destroy
  .edit
    input.todo-input(type=<code class="ni">&amp;quot;</code>text<code class="ni">&amp;quot;</code>, <code class="ni">&amp;quot;</code>value<code class="ni">&amp;quot;</code>=<code class="ni">&amp;quot;&amp;quot;</code>)
  <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>

script#stats-template(type=<code class="ni">&amp;quot;</code>text/template<code class="ni">&amp;quot;</code>)
  <code class="ni">&amp;lt;</code>% if (total) { %<code class="ni">&amp;gt;</code>
  span.todo-count
    span.number <code class="ni">&amp;lt;</code>%= remaining %<code class="ni">&amp;gt;</code> 
    span.word <code class="ni">&amp;lt;</code>%= remaining == 1 ? 'item' : 'items' %<code class="ni">&amp;gt;</code>
    |  left.
  <code class="ni">&amp;lt;</code>% } %<code class="ni">&amp;gt;</code>
  <code class="ni">&amp;lt;</code>% if (done) { %<code class="ni">&amp;gt;</code>
  span.todo-clear
    a(href=<code class="ni">&amp;quot;</code>#<code class="ni">&amp;quot;</code>)
      |  Clear
      span.number-done <code class="ni">&amp;lt;</code>%= done %<code class="ni">&amp;gt;</code>
      |  completed
      span.word-done <code class="ni">&amp;lt;</code>%= done == 1 ? 'item' : 'items' %<code class="ni">&amp;gt;</code>
  <code class="ni">&amp;lt;</code>% } %<code class="ni">&amp;gt;</code>
</pre><p class="calibre6">
      <span class="firstname"><strong class="calibre8">layout.jade</strong></span>
    </p><pre class="programlistingjavascript">!!! 5
//if lt IE 6
  <code class="ni">&amp;lt;</code>html class=<code class="ni">&amp;quot;</code>no-js ie6 oldie<code class="ni">&amp;quot;</code> lang=<code class="ni">&amp;quot;</code>en<code class="ni">&amp;quot;&amp;gt;</code> 
//if IE 7
  <code class="ni">&amp;lt;</code>html class=<code class="ni">&amp;quot;</code>no-js ie7 oldie<code class="ni">&amp;quot;</code> lang=<code class="ni">&amp;quot;</code>en<code class="ni">&amp;quot;&amp;gt;</code>
//if IE 8
  <code class="ni">&amp;lt;</code>html class=<code class="ni">&amp;quot;</code>no-js ie8 oldie<code class="ni">&amp;quot;</code> lang=<code class="ni">&amp;quot;</code>en<code class="ni">&amp;quot;&amp;gt;</code>
//if gt IE 8
  <code class="ni">&amp;lt;</code>!--<code class="ni">&amp;gt;</code> <code class="ni">&amp;lt;</code>html class=<code class="ni">&amp;quot;</code>no-js<code class="ni">&amp;quot;</code> lang=<code class="ni">&amp;quot;</code>en<code class="ni">&amp;quot;&amp;gt;</code> <code class="ni">&amp;lt;</code>!--
head
  meta(charset=<code class="ni">&amp;quot;</code>utf-8<code class="ni">&amp;quot;</code>)
  meta(http-equiv=<code class="ni">&amp;quot;</code>X-UA-Compatible<code class="ni">&amp;quot;</code>, content=<code class="ni">&amp;quot;</code>IE=edge,chrome=1<code class="ni">&amp;quot;</code>)

  title=title
  meta(name=<code class="ni">&amp;quot;</code>description<code class="ni">&amp;quot;</code>, content=<code class="ni">&amp;quot;&amp;quot;</code>)
  meta(name=<code class="ni">&amp;quot;</code>author<code class="ni">&amp;quot;</code>, content=<code class="ni">&amp;quot;&amp;quot;</code>)
  meta(name=<code class="ni">&amp;quot;</code>viewport<code class="ni">&amp;quot;</code>, content=<code class="ni">&amp;quot;</code>width=device-width,initial-scale=1<code class="ni">&amp;quot;</code>)

  // CSS concatenated and minified via ant build script
  link(rel=<code class="ni">&amp;quot;</code>stylesheet<code class="ni">&amp;quot;</code>, href=<code class="ni">&amp;quot;</code>css/style.css<code class="ni">&amp;quot;</code>)
  // end CSS

  script(src=<code class="ni">&amp;quot;</code>js/libs/modernizr-2.0.6.min.js<code class="ni">&amp;quot;</code>)
body

  #container
    header
    #main(role=<code class="ni">&amp;quot;</code>main<code class="ni">&amp;quot;</code>)!=body
    footer
  //! end of #container

  script(src=<code class="ni">&amp;quot;</code>//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js<code class="ni">&amp;quot;</code>)
  script
    window.jQuery || document.write('<code class="ni">&amp;lt;</code>script src=<code class="ni">&amp;quot;</code>js/libs/jquery-1.6.2.min.js<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>\\/script<code class="ni">&amp;gt;</code>')

  // scripts concatenated and minified via ant build script
  script(src=<code class="ni">&amp;quot;</code>js/mylibs/underscore.js<code class="ni">&amp;quot;</code>)
  script(src=<code class="ni">&amp;quot;</code>js/mylibs/backbone.js<code class="ni">&amp;quot;</code>)
  script(defer, src=<code class="ni">&amp;quot;</code>js/plugins.js<code class="ni">&amp;quot;</code>)
  script(defer, src=<code class="ni">&amp;quot;</code>js/script.js<code class="ni">&amp;quot;</code>)
  // end scripts

  // Change UA-XXXXX-X to be your site's ID
  script
    window._gaq = [['_setAccount','UAXXXXXXXX1'],['_trackPageview'],['_trackPageLoadTime']];
    Modernizr.load({load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'});

  //if lt IE 7
    script(src=<code class="ni">&amp;quot;</code>//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js<code class="ni">&amp;quot;</code>)
    script
      window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})
<code class="ni">&amp;lt;</code>/html<code class="ni">&amp;gt;</code>
</pre><p class="calibre6">
      <span class="firstname"><strong class="calibre8">static.html</strong></span>
    </p><p class="calibre6">
      Alternatively, a static version of our index which doesn’t rely on
      Jade can be put together as follows. See
      <a class="ulink" href="https://github.com/addyosmani/backbone-boilerplates/blob/master/option1/public/static.html">here</a>
      for the complete file or below for a sample.
    </p><pre class="programlistingjavascript"> <code class="ni">&amp;lt;</code>div id=<code class="ni">&amp;quot;</code>container<code class="ni">&amp;quot;&amp;gt;</code>
    <code class="ni">&amp;lt;</code>div id=<code class="ni">&amp;quot;</code>main<code class="ni">&amp;quot;</code> role=<code class="ni">&amp;quot;</code>main<code class="ni">&amp;quot;&amp;gt;</code>

      <code class="ni">&amp;lt;</code>!-- Todo App Interface--<code class="ni">&amp;gt;</code>

      <code class="ni">&amp;lt;</code>div id=<code class="ni">&amp;quot;</code>todoapp<code class="ni">&amp;quot;&amp;gt;</code>
        <code class="ni">&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>title<code class="ni">&amp;quot;&amp;gt;</code>
          <code class="ni">&amp;lt;</code>h1<code class="ni">&amp;gt;</code>Todos<code class="ni">&amp;lt;</code>/h1<code class="ni">&amp;gt;</code>
        <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>

        <code class="ni">&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>content<code class="ni">&amp;quot;&amp;gt;</code>
          <code class="ni">&amp;lt;</code>div id=<code class="ni">&amp;quot;</code>create-todo<code class="ni">&amp;quot;&amp;gt;</code>
            <code class="ni">&amp;lt;</code>input id=<code class="ni">&amp;quot;</code>new-todo<code class="ni">&amp;quot;</code> placeholder=<code class="ni">&amp;quot;</code>What needs to be done?<code class="ni">&amp;quot;</code> type=
            <code class="ni">&amp;quot;</code>text<code class="ni">&amp;quot;</code> /<code class="ni">&amp;gt;&amp;lt;</code>span style=<code class="ni">&amp;quot;</code>display:none;<code class="ni">&amp;quot;</code> class=<code class="ni">&amp;quot;</code>ui-tooltip-top<code class="ni">&amp;quot;&amp;gt;</code>Press Enter to
            save this task<code class="ni">&amp;lt;</code>/span<code class="ni">&amp;gt;</code>
          <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>

          <code class="ni">&amp;lt;</code>div id=<code class="ni">&amp;quot;</code>todos<code class="ni">&amp;quot;&amp;gt;</code>
            <code class="ni">&amp;lt;</code>ul id=<code class="ni">&amp;quot;</code>todo-list<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>/ul<code class="ni">&amp;gt;</code>
          <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>

          <code class="ni">&amp;lt;</code>div id=<code class="ni">&amp;quot;</code>todo-stats<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>/div<code class="ni">&amp;gt;</code>
        <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>


    <code class="ni">&amp;lt;</code>!-- Templates--<code class="ni">&amp;gt;</code>

      <code class="ni">&amp;lt;</code>script id=<code class="ni">&amp;quot;</code>item-template<code class="ni">&amp;quot;</code> type=<code class="ni">&amp;quot;</code>text/template<code class="ni">&amp;quot;&amp;gt;</code>
      <code class="ni">&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>todo <code class="ni">&amp;lt;</code>%= done ? 'done' : '' %<code class="ni">&amp;gt;&amp;quot;&amp;gt;</code>
      <code class="ni">&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>display<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>input class=<code class="ni">&amp;quot;</code>check<code class="ni">&amp;quot;</code> type=<code class="ni">&amp;quot;</code>checkbox<code class="ni">&amp;quot;</code> <code class="ni">&amp;lt;</code>%= done ? 'checked=<code class="ni">&amp;quot;</code>checked<code class="ni">&amp;quot;</code>' : '' %<code class="ni">&amp;gt;</code> /<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>todo-text<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>/div<code class="ni">&amp;gt;&amp;lt;</code>span id=<code class="ni">&amp;quot;</code>todo-destroy<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>/span<code class="ni">&amp;gt;&amp;lt;</code>/div<code class="ni">&amp;gt;&amp;lt;</code>div class=<code class="ni">&amp;quot;</code>edit<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>input type=<code class="ni">&amp;quot;</code>text<code class="ni">&amp;quot;</code> value=<code class="ni">&amp;quot;&amp;quot;</code> class=<code class="ni">&amp;quot;</code>todo-input<code class="ni">&amp;quot;</code>/<code class="ni">&amp;gt;&amp;lt;</code>/div<code class="ni">&amp;gt;&amp;lt;</code>/div<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>/script<code class="ni">&amp;gt;</code>

      <code class="ni">&amp;lt;</code>script id=<code class="ni">&amp;quot;</code>stats-template<code class="ni">&amp;quot;</code> type=<code class="ni">&amp;quot;</code>text/template<code class="ni">&amp;quot;&amp;gt;</code>
      <code class="ni">&amp;lt;</code>% if (total) { %<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>span class=<code class="ni">&amp;quot;</code>todo-count<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>span class=<code class="ni">&amp;quot;</code>number<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>%= remaining %<code class="ni">&amp;gt;</code> <code class="ni">&amp;lt;</code>/span<code class="ni">&amp;gt;&amp;lt;</code>span class=<code class="ni">&amp;quot;</code>word<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>%= remaining == 1 ? 'item' : 'items' %<code class="ni">&amp;gt;&amp;lt;</code>/span<code class="ni">&amp;gt;</code> left.
      <code class="ni">&amp;lt;</code>/span<code class="ni">&amp;gt;&amp;lt;</code>% } %<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>% if (done) { %<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>span class=<code class="ni">&amp;quot;</code>todo-clear<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>a href=<code class="ni">&amp;quot;</code>#<code class="ni">&amp;quot;&amp;gt;</code> Clear
      <code class="ni">&amp;lt;</code>span class=<code class="ni">&amp;quot;</code>number-done<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>%= done %<code class="ni">&amp;gt;&amp;lt;</code>/span<code class="ni">&amp;gt;</code> completed
      <code class="ni">&amp;lt;</code>span class=<code class="ni">&amp;quot;</code>word-done<code class="ni">&amp;quot;&amp;gt;&amp;lt;</code>%= done == 1 ? 'item' : 'items' %<code class="ni">&amp;gt;&amp;lt;</code>/span<code class="ni">&amp;gt;&amp;lt;</code>/a<code class="ni">&amp;gt;&amp;lt;</code>/span<code class="ni">&amp;gt;&amp;lt;</code>% } %<code class="ni">&amp;gt;</code>
      <code class="ni">&amp;lt;</code>/script<code class="ni">&amp;gt;</code>

    <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>
  <code class="ni">&amp;lt;</code>/div<code class="ni">&amp;gt;</code>

  <code class="ni">&amp;lt;</code>!--! end of #container--<code class="ni">&amp;gt;</code>
</pre></div><div class="book" title="Practical Setup"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="practical-setup" class="calibre1"></a>Practical Setup</h2></div></div></div><p class="calibre6">
      We’ve now gone through the major points of developing a RESTful
      backend using Node.js, Express and Mongoose. Next, let’s make sure
      you can get your environment setup to run the updated Todo app.
    </p><div class="book" title="MongoDB"><div class="book"><div class="book"><div class="book"><h3 class="title4"><a id="mongodb" class="calibre1"></a>MongoDB</h3></div></div></div><p class="calibre6">
        Once you’ve downloaded
        <a class="ulink" href="http://www.mongodb.org/downloads">MongoDB</a>,
        you’ll need to complete two steps to get it up and running.
      </p><p class="calibre6">
        <span class="firstname"><strong class="calibre8">Data directories</strong></span>
      </p><p class="calibre6">
        MongoDB stores data in the bin/data/db folder but won’t actually
        create this directory for you. Navigate to where you’ve
        downloaded and extracted MongoDB and run the following from
        terminal:
      </p><pre class="programlistingjavascript">sudo mkdir -p /data/db/
sudo chown `id -u` /data/db
</pre><p class="calibre6">
        <span class="firstname"><strong class="calibre8">Running and connecting to your
        server</strong></span>
      </p><p class="calibre6">
        Once this is done, open up two terminal windows.
      </p><p class="calibre6">
        In the first, <code class="literal">cd</code> to your MongoDB bin
        directory or type in the complete path to it. You’ll need to
        start &lt;cpde&gt;mongod`.
      </p><pre class="programlistingjavascript">$ ./bin/mongod
</pre><p class="calibre6">
        Next, in the second terminal, start the `mongo&lt;/code shell
        which will connect up to localhost by default.
      </p><pre class="programlistingjavascript">$ ./bin/mongo
</pre><p class="calibre6">
        That’s it!.
      </p></div><div class="book" title="Express and Mongoose"><div class="book"><div class="book"><div class="book"><h3 class="title4"><a id="express-and-mongoose" class="calibre1"></a>Express and Mongoose</h3></div></div></div><p class="calibre6">
        Option 1 (HTML) and Option 2 (Jade) of the practical download
        both come with an install.sh bash script. This allows you to
        easily install Express, Mongoose, Jade (and optionally MongoDB
        if you prefer to) through npm (the node package manager).
      </p><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="calibre6">
            Make sure you have Node.js installed. If not, you can grab
            it <a class="ulink" href="http://nodejs.org/#download">here</a>
          </p></li><li class="listitem"><p class="calibre6">
            Next run <code class="literal">$ ./install.sh</code> at the terminal
            to install the rest of our dependencies. To see the exact
            contents of the install.sh file, see below:
          </p></li></ul></div><p class="calibre6">
        <span class="firstname"><strong class="calibre8">install.sh</strong></span>
      </p><pre class="programlistingjavascript">#!/bin/bash
npm install express
npm install mongodb --mongodb:native
npm install mongoose
npm install jade
</pre><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="calibre6">
            After you’ve installed all of the dependencies for the
            stack, we can get to cloning the repo containing our
            practicals and running them. Start by running the below
            lines:
          </p></li></ul></div><pre class="programlistingjavascript">git clone git://github.com/addyosmani/backbone-boilerplates.git
cd option2
node app.js
</pre><p class="calibre6">
        For option1 (without Jade), simply cd into option1 and run
        <code class="literal">node app.js</code> from there.
      </p><p class="calibre6">
        Finally, either of the example apps can now be accessed by
        navigating to:
      </p><div class="book"><ul class="itemizedlist"><li class="listitem"><p class="calibre6">
            Option 1:
            <code class="literal">http://localhost:3000/static.html</code>
          </p></li><li class="listitem"><p class="calibre6">
            Option 2: <code class="literal">http://localhost:3000/todo</code>
          </p></li></ul></div><p class="calibre6">
        That’s it! Whilst there’s a lot more than can be done to expand
        on the concepts covered so far, the base we’re reviewed should
        be enough to get you up and running with this stack if you wish
        to use it with Backbone.
      </p></div></div></div></div>

{% endraw %}

