---
layout: page
title: "Developing Backbone.js Applications"
prev: OEBPS/ch02s06.html
next: OEBPS/ch02s08.html
book_path: books/developing-backbone-js-applications-addy-osmani--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Routers"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="routers" class="calibre1"></a>Routers</h1></div></div></div><p class="calibre6">
      In Backbone, routers are used to help manage application state and
      for connecting URLs to application events. This is achieved using
      hash-tags with URL fragments, or using the browser’s pushState and
      History API. Some examples of routes may be seen below:
    </p><pre class="programlistingjavascript"><code class="nx">http</code><code class="o">:</code><code class="c">//unicorns.com/#whatsup</code>
<code class="nx">http</code><code class="o">:</code><code class="c">//unicorns.com/#search/seasonal-horns/page2</code>
</pre><p class="calibre6">
      Note: An application will usually have at least one route mapping
      a URL route to a function that determines what happens when a user
      reaches that particular route. This relationship is defined as
      follows:
    </p><pre class="programlistingjavascript"><code class="s">"route"</code> <code class="o">:</code> <code class="s">"mappedFunction"</code>
</pre><p class="calibre6">
      Let us now define our first controller by extending
      <code class="literal">Backbone.Router</code>. For the purposes of this
      guide, we’re going to continue pretending we’re creating a photo
      gallery application that requires a GalleryRouter.
    </p><p class="calibre6">
      Note the inline comments in the code example below as they
      continue the rest of the lesson on routers.
    </p><pre class="programlistingjavascript"><code class="kd">var</code> <code class="nx">GalleryRouter</code> <code class="o">=</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">Router</code><code class="p">.</code><code class="nx">extend</code><code class="p">({</code>
    <code class="c">/* define the route and function maps for this router */</code>
    <code class="nx">routes</code><code class="o">:</code> <code class="p">{</code>
        <code class="s">"about"</code> <code class="o">:</code> <code class="s">"showAbout"</code><code class="p">,</code>
        <code class="c">/*Sample usage: http://unicorns.com/#about*/</code>

        <code class="s">"photos/:id"</code> <code class="o">:</code> <code class="s">"getPhoto"</code><code class="p">,</code>
        <code class="c">/*This is an example of using a ":param" variable which allows us to match </code>
<code class="c">        any of the components between two URL slashes*/</code>
        <code class="c">/*Sample usage: http://unicorns.com/#photos/5*/</code>

        <code class="s">"search/:query"</code> <code class="o">:</code> <code class="s">"searchPhotos"</code><code class="p">,</code>
        <code class="c">/*We can also define multiple routes that are bound to the same map function,</code>
<code class="c">        in this case searchPhotos(). Note below how we're optionally passing in a </code>
<code class="c">        reference to a page number if one is supplied*/</code>
        <code class="c">/*Sample usage: http://unicorns.com/#search/lolcats*/</code>

        <code class="s">"search/:query/p:page"</code> <code class="o">:</code> <code class="s">"searchPhotos"</code><code class="p">,</code>
        <code class="c">/*As we can see, URLs may contain as many ":param"s as we wish*/</code>
        <code class="c">/*Sample usage: http://unicorns.com/#search/lolcats/p1*/</code>

        <code class="s">"photos/:id/download/*imagePath"</code> <code class="o">:</code> <code class="s">"downloadPhoto"</code><code class="p">,</code>
        <code class="c">/*This is an example of using a *splat. splats are able to match any number of </code>
<code class="c">        URL components and can be combined with ":param"s*/</code>
        <code class="c">/*Sample usage: http://unicorns.com/#photos/5/download/files/lolcat-car.jpg*/</code>

        <code class="c">/*If you wish to use splats for anything beyond default routing, it's probably a good </code>
<code class="c">        idea to leave them at the end of a URL otherwise you may need to apply regular</code>
<code class="c">        expression parsing on your fragment*/</code>

        <code class="s">"*other"</code>    <code class="o">:</code> <code class="s">"defaultRoute"</code>
        <code class="c">/*This is a default route that also uses a *splat. Consider the</code>
<code class="c">        default route a wildcard for URLs that are either not matched or where</code>
<code class="c">        the user has incorrectly typed in a route path manually*/</code>
        <code class="c">/*Sample usage: http://unicorns.com/#anything*/</code>

    <code class="p">},</code>

    <code class="nx">showAbout</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
    <code class="p">},</code>

    <code class="nx">getPhoto</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">id</code><code class="p">){</code>
        <code class="c">/* </code>
<code class="c">        Note that the id matched in the above route will be passed to this function</code>
<code class="c">        */</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">"You are trying to reach photo "</code> <code class="o">+</code> <code class="nx">id</code><code class="p">);</code>
    <code class="p">},</code>

    <code class="nx">searchPhotos</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">query</code><code class="p">,</code> <code class="nx">page</code><code class="p">){</code>
        <code class="kd">var</code> <code class="nx">page_number</code> <code class="o">=</code> <code class="nx">page</code> <code class="o">||</code> <code class="mi">1</code><code class="p">;</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">"Page number: "</code> <code class="o">+</code> <code class="nx">page_number</code> <code class="o">+</code> <code class="s">" of the results for "</code> <code class="o">+</code> <code class="nx">query</code><code class="p">);</code>
    <code class="p">},</code>

    <code class="nx">downloadPhoto</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">id</code><code class="p">,</code> <code class="nx">path</code><code class="p">){</code>
    <code class="p">},</code>

    <code class="nx">defaultRoute</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">other</code><code class="p">){</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">"Invalid. You attempted to reach:"</code> <code class="o">+</code> <code class="nx">other</code><code class="p">);</code>
    <code class="p">}</code>
<code class="p">});</code>

<code class="c">/* Now that we have a router setup, remember to instantiate it*/</code>

<code class="kd">var</code> <code class="nx">myGalleryRouter</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">GalleryRouter</code><code class="p">();</code>
</pre><p class="calibre6">
      As of Backbone 0.5+, it’s possible to opt-in for HTML5 pushState
      support via <code class="literal">window.history.pushState</code>. This
      permits you to define routes such as
      http://www.scriptjunkie.com/just/an/example. This will be
      supported with automatic degradation when a user’s browser doesn’t
      support pushState. For the purposes of this tutorial, we’ll use
      the hashtag method.
    </p><div class="book" title="Backbone.history"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="backbone.history" class="calibre1"></a>Backbone.history</h2></div></div></div><p class="calibre6">
        Next, we need to initialize <code class="literal">Backbone.history</code>
        as it handles <code class="literal">hashchange</code> events in our
        application. This will automatically handle routes that have
        been defined and trigger callbacks when they’ve been accessed.
      </p><p class="calibre6">
        The <code class="literal">Backbone.history.start()</code> method will
        simply tell Backbone that it’s OK to begin monitoring all
        <code class="literal">hashchange</code> events as follows:
      </p><pre class="programlistingjavascript"><code class="nx">Backbone</code><code class="p">.</code><code class="nx">history</code><code class="p">.</code><code class="nx">start</code><code class="p">();</code>
<code class="nx">Router</code><code class="p">.</code><code class="nx">navigate</code><code class="p">();</code>
</pre><p class="calibre6">
        As an aside, if you would like to save application state to the
        URL at a particular point you can use the
        <code class="literal">.navigate()</code> method to achieve this. It simply
        updates your URL fragment without the need to trigger the
        <code class="literal">hashchange</code> event:
      </p><pre class="programlistingjavascript"><code class="c">/*Lets imagine we would like a specific fragment for when a user zooms into a photo*/</code>
<code class="nx">zoomPhoto</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">factor</code><code class="p">){</code>
    <code class="kd">this</code><code class="p">.</code><code class="nx">zoom</code><code class="p">(</code><code class="nx">factor</code><code class="p">);</code> <code class="c">//imagine this zooms into the image</code>
    <code class="kd">this</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s">"zoom/"</code> <code class="o">+</code> <code class="nx">factor</code><code class="p">);</code> <code class="c">//updates the fragment for us, but doesn't trigger the route</code>
<code class="p">}</code>
</pre><p class="calibre6">
        It is also possible for <code class="literal">Router.navigate()</code> to
        trigger the route as well as updating the URL fragment.
      </p><pre class="programlistingjavascript"><code class="nx">zoomPhoto</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">factor</code><code class="p">){</code>
    <code class="kd">this</code><code class="p">.</code><code class="nx">zoom</code><code class="p">(</code><code class="nx">factor</code><code class="p">);</code> <code class="c">//imagine this zooms into the image</code>
    <code class="kd">this</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s">"zoom/"</code> <code class="o">+</code> <code class="nx">factor</code><code class="p">,</code> <code class="kd">true</code><code class="p">);</code> <code class="c">//updates the fragment for us and triggers the route</code>
<code class="p">}</code>
</pre></div></div></div>

{% endraw %}

