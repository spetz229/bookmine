---
layout: page
title: "CoffeeScript (for jay muratore)"
prev: f_0018.html
next: f_0020.html
book_path: books/trevor-burnham-coffeescript-accelerated-javascript-development-pragmatic--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

<h2 id="sec.scope" class="calibre13">2.2 Scope: Where You See ’Em</h2>
<p id="N10CF4" class="calibre5">
      So far, we haven’t worried about where variables live. Alas, we can’t always be so cavalier. Consider this example:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">age = 99</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">reincarnate = <strong class="prompt">-&gt;</strong> age = 0</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">reincarnate()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">console.log <em class="string">"I am </em>#{age}<em class="string"> years old"</em>
</code>
</td>
</tr>
</table>
<p id="N10D1D" class="calibre5">
      As you’d probably expect, the output is this:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">I am 0 years old</code>
</td>
</tr>
</table>
<p id="N10D2B" class="calibre5">
      However, we can try flipping the first and second lines around, like this:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">reincarnate = <strong class="prompt">-&gt;</strong> age = 0</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">age = 99</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">reincarnate()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">console.log <em class="string">"I am </em>#{age}<em class="string"> years old"</em>
</code>
</td>
</tr>
</table>
<p id="N10D4A" class="calibre5">
      Now hit Run and the code tells a very different story:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">I am 99 years old</code>
</td>
</tr>
</table>
<p id="N10D58" class="calibre5">
      Strange—the <code class="cf">reincarnate()</code> call doesn’t have any effect! And what if we cut out <code class="cf">age = 99</code> altogether?
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">reincarnate = <strong class="prompt">-&gt;</strong> age = 0</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">reincarnate()</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">console.log <em class="string">"age = </em>#{age}<em class="string">"</em>
</code>
</td>
</tr>
</table>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">ReferenceError: age is not defined</code>
</td>
</tr>
</table>
<p id="N10D85" class="calibre5">
      We’ve got ourselves a “scope” issue! But what is <span class="emph">scope</span>? A variable’s scope is its home, as defined by three rules:
    </p>
<ol class="calibre24">
<li class="calibre3">
<p id="N10D8E" class="calibre5">
        Every function creates a scope, and the only way to create a scope is to define a function.
      </p>
</li>
<li class="calibre3">
<p id="N10D92" class="calibre5">
        A variable lives in the outermost scope in which an assignment has been made to that variable.
      </p>
</li>
<li class="calibre3">
<p id="N10D96" class="calibre5">
        Outside of its scope, a variable is invisible.
      </p>
</li>
</ol>
<p id="N10D99" class="calibre5">
      For instance, the scope of <code class="cf">age</code> in the first example was the global scope; in the middle example, there was a variable named <code class="cf">age</code> in the global scope and another in the <code class="cf">reincarnate</code> function’s scope; and in the last example, there was just the <code class="cf">reincarnate</code>-scoped <code class="cf">age</code>. That’s why we got a <code class="cf">ReferenceError</code> from trying to display <code class="cf">age</code> outside of <code class="cf">reincarnate</code>: no variable with that name exists outside of that function.
    </p>
<p id="N10DB4" class="calibre5">
      CoffeeScript’s approach to scope is known as <span class="emph">lexical scope</span>, and it’s the same as in JavaScript, except that a variable’s scope is defined explicitly in JavaScript using the <code class="cf">var</code> keyword while CoffeeScript infers scope from assignments. This not only saves your fingers precious effort, it also discourages you from shadowing one variable by giving a different variable in a nested scope the same name. See <a href="#sb.shadowing">​<em class="emph">Shadowing: The Name’s the Same</em>​</a>.
    </p>
<div class="sidebar" id="sb.shadowing">
<div class="sidebar-title">Shadowing: The Name’s the Same</div>
<div class="calibre1">
<p id="N10DC7" class="calibre5">
        There are only two ways to shadow a variable in CoffeeScript: One is, as we saw in the second <code class="cf1">reincarnate</code> example, to create a variable in a surrounding scope <span class="emph">after</span> a variable with inner scope. The other way is with a function argument:
      </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">x = 5</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">triple = (x) <strong class="prompt">-&gt;</strong> x *= 3</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">triple x<em class="comment">      # 15</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix1"> </td>
<td class="codeline1">
<code class="calibre16">x<em class="comment">             # 5</em>
</code>
</td>
</tr>
</table>
<p id="N10DF3" class="calibre5">
        Shadowing is generally considered bad style and should be avoided. Give your variables distinct names, lest you sew the seeds of scope confusion.
      </p>
</div>
</div>
<p id="N10DF6" class="calibre5">
      A function’s scope is nested within the scope that the function itself lives in. (Remember, functions are just variables.) This is another important thing to understand about scope: it doesn’t depend on where or how the function is being called. You can always tell which scope something lives in just by eyeballing the code or by compiling to JavaScript and looking for <code class="cf">var</code> declarations, which are always placed at the top of their scope:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">singCountdown = (count) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  singBottleCount = (specifyLocation) <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    locationStr = <strong class="prompt">if</strong> specifyLocation <strong class="prompt">then</strong> <em class="string">'on the wall'</em> <strong class="prompt">else</strong> <em class="string">''</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    bottleStr = <strong class="prompt">if</strong> count is 1 <strong class="prompt">then</strong> <em class="string">'bottle'</em> <strong class="prompt">else</strong> <em class="string">'bottles'</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    console.log <em class="string">"</em>#{count}<em class="string"></em>#{bottleStr}<em class="string"> of beer </em>#{locationStr}<em class="string">"</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  singDecrement = <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    console.log <em class="string">"Take one down, pass it around"</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    count--</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  singBottleCount <strong class="prompt">true</strong>; singBottleCount <strong class="prompt">false</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  singDecrement(); singBottleCount <strong class="prompt">true</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  <strong class="prompt">if</strong> count isnt 0 <strong class="prompt">then</strong> singCountdown count</code>
</td>
</tr>
</table>
<p id="N10E67" class="calibre5">
      This example yields the following (omitting everything but the <code class="cf">function</code>s that create scope and the <code class="cf">var</code>s that inhabit them):
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">
<strong class="prompt">var</strong> singCountdown;</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">singCountdown = <strong class="prompt">function</strong>(count) {</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  <strong class="prompt">var</strong> singBottleCount, singDecrement;</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  singBottleCount = <strong class="prompt">function</strong>(specifyLocation) {</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    <strong class="prompt">var</strong> bottleStr, locationStr;</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">    <em class="comment">// ...</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  }</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  <em class="comment">// ...</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">}</code>
</td>
</tr>
</table>
<p id="N10EA5" class="calibre5">
      You might be wondering, “How do I give a variable a scope without making an assignment?” The answer is, you don’t. Instead, you make an assignment, traditionally with <code class="cf">null</code> or some more sensible initial value. Here’s an example:
    </p>
<table class="processedcode">
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">obj = <strong class="prompt">null</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">initializeObj = <strong class="prompt">-&gt;</strong>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">  obj = ...<em class="comment">   # create object with superpowers</em>
</code>
</td>
</tr>
<tr class="calibre15">
<td class="codeprefix"> </td>
<td class="codeline">
<code class="calibre16">window.onload = initializeObj</code>
</td>
</tr>
</table>
<p id="N10EC5" class="calibre5">
      That does it for our discussion of scope in CoffeeScript. And now for something completely different: <code class="cf">this</code>.
    </p>
<script src="scripts/book_local.js" type="text/javascript" class="calibre2"/>
</div>

{% endraw %}

