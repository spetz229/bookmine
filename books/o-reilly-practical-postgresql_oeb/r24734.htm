---
layout: page
title: "Unknown"
prev: r24536.htm
next: r24858.htm
book_path: books/o-reilly-practical-postgresql_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="NAVHEADER"><table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0" class="calibre"><tr class="calibre1"><th colspan="3" class="calibre2">Practical PostgreSQL</th></tr><tr class="calibre1"><td width="10%" valign="bottom" class="calibre3"><a href="r24536.htm" accesskey="P">Prev</a></td><td width="80%" valign="bottom" class="calibre4"/><td width="10%" valign="bottom" class="calibre5"><a href="r24858.htm" accesskey="N">Next</a></td></tr></table><hr width="100%" class="calibre6"/></div><h1 class="calibre7"><a name="SQL-CREATERULE" class="calibre8">CREATE RULE</a></h1><div class="NAVHEADER"><a name="AEN24738"></a><h2 class="SECT">Name</h2>CREATE RULE -- Defines a new rule on a table.</div><div class="NAVHEADER"><a name="AEN24741"></a><h2 class="SECT">Synopsis</h2><pre class="SCREEN">CREATE RULE <tt class="REPLACEABLE"><i class="EMPHASIS">name</i></tt> AS ON <tt class="REPLACEABLE"><i class="EMPHASIS">event</i></tt> TO <tt class="REPLACEABLE"><i class="EMPHASIS">object</i></tt> [ WHERE <tt class="REPLACEABLE"><i class="EMPHASIS">condition</i></tt> ] DO [ INSTEAD ]  <tt class="REPLACEABLE"><i class="EMPHASIS">action</i></tt>
<tt class="REPLACEABLE"><i class="EMPHASIS">action</i></tt> ::= NOTHING | query | ( query [; ...] ) | [ query [; ...] ]</pre><div class="NAVHEADER"><a name="R2-SQL-CREATERULE-1"></a><h3 class="AUTHOR">Parameters</h3><p class="calibre9"> </p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><tt class="REPLACEABLE"><i class="EMPHASIS">name</i></tt></dt><dd class="calibre16"><p class="calibre9">The name of the new rule you are creating.</p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE"><i class="EMPHASIS">event</i></tt></dt><dd class="calibre16"><p class="calibre9">The event that triggers the rule. This parameter should be one of: <tt class="REPLACEABLE">SELECT</tt>, <tt class="REPLACEABLE">UPDATE</tt>, <tt class="REPLACEABLE">DELETE</tt>, or <tt class="REPLACEABLE">INSERT</tt>.</p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE"><i class="EMPHASIS">object</i></tt></dt><dd class="calibre16"><p class="calibre9">The name of a table, or the fully qualified name of a table column (e.g., <tt class="REPLACEABLE"><i class="EMPHASIS">table_name.column_name</i></tt>). </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE"><i class="EMPHASIS">condition</i></tt></dt><dd class="calibre16"><p class="calibre9">A SQL condition evaluating to a value of type <tt class="REPLACEABLE">boolean</tt>, which specifies when this rule should be used. This statement should not refer to a table; the only exception to this is that the condition <span><i class="EMPHASIS">may</i></span> refer to the special <tt class="REPLACEABLE">new</tt> and <tt class="REPLACEABLE">old</tt> relations, which represent the existing rows, and any new row data provided, respectively.</p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">INSTEAD</tt></dt><dd class="calibre16"><p class="calibre9">The <tt class="REPLACEABLE">INSTEAD</tt> keyword; when used, the <tt class="REPLACEABLE"><i class="EMPHASIS">action</i></tt> is executed instead of the specified <tt class="REPLACEABLE"><i class="EMPHASIS">event</i></tt>. Otherwise, the <tt class="REPLACEABLE"><i class="EMPHASIS">action</i></tt> executes before the <tt class="REPLACEABLE"><i class="EMPHASIS">event</i></tt> does.</p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE"><i class="EMPHASIS">action</i></tt></dt><dd class="calibre16"><p class="calibre9">The query (or queries) that define the action to perform when the rule is triggered, and the condition is met. The query (or queries) can be any valid <tt class="REPLACEABLE">SELECT</tt>, <tt class="REPLACEABLE">INSERT</tt>, <tt class="REPLACEABLE">UPDATE</tt>, <tt class="REPLACEABLE">DELETE</tt>, or <tt class="REPLACEABLE">NOTIFY</tt> statements.  Supply multiple queries by surrounding them in parentheses.</p><p class="calibre9">You may alternatively use the <tt class="REPLACEABLE">NOTHING</tt> keyword instead of a query. <tt class="REPLACEABLE">NOTHING</tt> will perform no action, and is only useful if you also specify the <tt class="REPLACEABLE">INSTEAD</tt> keyword.</p></dd></dl></div>
<p class="calibre9">Within the <tt class="REPLACEABLE"><i class="EMPHASIS">condition</i></tt> and <tt class="REPLACEABLE"><i class="EMPHASIS">action</i></tt> values, you are able to use the
    special <tt class="REPLACEABLE">new</tt> and <tt class="REPLACEABLE">old</tt> relations to access column values from both the referenced
    <tt class="REPLACEABLE"><i class="EMPHASIS">object</i></tt>, and from the data triggering the rule.</p><p class="calibre9">The <tt class="REPLACEABLE">new</tt> relation is available in an <tt class="REPLACEABLE">INSERT</tt> or <tt class="REPLACEABLE">UPDATE</tt> rule,
    containing the column values being inserted or updated, while the <tt class="REPLACEABLE">old</tt> relation is available in a
    <tt class="REPLACEABLE">SELECT</tt>, <tt class="REPLACEABLE">UPDATE</tt>, or <tt class="REPLACEABLE">DELETE</tt> rule, containing the row data being
    selected, updated, or deleted.</p></div><div class="NAVHEADER"><a name="R2-SQL-CREATERULE-2"></a><h3 class="AUTHOR">Results</h3><p class="calibre9"> </p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><tt class="REPLACEABLE">CREATE</tt></dt><dd class="calibre16"><p class="calibre9">The message returned when a rule is successfully created.</p></dd></dl></div>
</div></div><div class="NAVHEADER"><a name="R1-SQL-CREATERULE-1"></a><h2 class="SECT">Description</h2><p class="calibre9">Use <tt class="REPLACEABLE">CREATE RULE</tt> to create a rule.  Rules allow you to define alternate actions to be taken upon table and class inserts, updates, and deletions.  You can also use the PostgreSQL rule system to implement table views.</p><p class="calibre9">When <tt class="REPLACEABLE">SELECT</tt>, <tt class="REPLACEABLE">INSERT</tt>, <tt class="REPLACEABLE">DELETE</tt>, or <tt class="REPLACEABLE">UPDATE</tt> is issued, the rules for that event are examined in an unspecified order.  If a <tt class="REPLACEABLE">WHERE</tt> clause has been specified by the rule, it is checked; if the specified condition is met, the rule's specified action is performed.  If you specified <tt class="REPLACEABLE">INSTEAD</tt> when creating the rule, the action will be taken instead of the event; otherwise the action will be performed before the query is processed (the event itself).  Be careful not to create what are known as <span><i class="EMPHASIS">circular rules</i></span>; these are rules that reference other rules that in turn reference the original rule.</p><div class="NAVHEADER"><blockquote class="NOTE"><p class="calibre9"><b class="calibre10">Note: </b> When using <tt class="REPLACEABLE">ON SELECT</tt> rules, you must pass the <tt class="REPLACEABLE">INSTEAD</tt> parameter.  Essentially, this means that <tt class="REPLACEABLE">ON SELECT</tt> must always implement table views.</p></blockquote></div></div><div class="NAVHEADER"><a name="R1-SQL-CREATERULE-2"></a><h2 class="SECT">Examples</h2><p class="calibre9">The following example shows the definition of a rule named <tt class="REPLACEABLE">sync_stock_with_editions</tt> that updates the <tt class="REPLACEABLE">stock</tt> table's <tt class="REPLACEABLE">isbn</tt> column automatically when the <tt class="REPLACEABLE">editions</tt> table is modified:</p><pre class="SCREEN">booktown=# <tt class="REPLACEABLE"><b class="calibre10">CREATE RULE sync_stock_with_editions AS</b></tt>
booktown-# <tt class="REPLACEABLE"><b class="calibre10">            ON UPDATE TO editions</b></tt>
booktown-# <tt class="REPLACEABLE"><b class="calibre10">            DO UPDATE stock SET isbn = new.isbn</b></tt>
booktown-# <tt class="REPLACEABLE"><b class="calibre10">                            WHERE isbn = old.isbn;</b></tt>
CREATE</pre></div><div class="NAVHEADER"><hr width="100%" class="calibre6"/><table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0" class="calibre"><tr class="calibre1"><td width="33%" valign="top" class="calibre3"><a href="r24536.htm" accesskey="P">Prev</a></td><td width="34%" valign="top" class="calibre4"><a href="book1.htm" accesskey="H">Home</a></td><td width="33%" valign="top" class="calibre5"><a href="r24858.htm" accesskey="N">Next</a></td></tr><tr class="calibre1"><td width="33%" valign="top" class="calibre3">CREATE OPERATOR</td><td width="34%" valign="top" class="calibre4"><a href="c22759.htm" accesskey="U">Up</a></td><td width="33%" valign="top" class="calibre5">CREATE SEQUENCE</td></tr></table></div></div>

{% endraw %}

