---
layout: page
title: "Unknown"
prev: x17860.htm
next: x19123.htm
book_path: books/o-reilly-practical-postgresql_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="NAVHEADER"><table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0" class="calibre"><tr class="calibre1"><th colspan="3" class="calibre2">Practical PostgreSQL</th></tr><tr class="calibre1"><td width="10%" valign="bottom" class="calibre3"><a href="x17860.htm" accesskey="P">Prev</a></td><td width="80%" valign="bottom" class="calibre4"/><td width="10%" valign="bottom" class="calibre5"><a href="x19123.htm" accesskey="N">Next</a></td></tr></table><hr width="100%" class="calibre6"/></div><div class="NAVHEADER"><div class="calibre18"></div><h1 id="calibre_toc_11" class="calibre7"><a name="USERMANAGEMENT" class="calibre8">Chapter 10. User and Group Management</a></h1><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><b class="calibre10">Table of Contents</b></dt><dt class="NAVHEADER"><a href="c18591.htm#MANAGINGUSERS">Managing Users</a></dt><dt class="NAVHEADER"><a href="x19123.htm">Managing Groups</a></dt><dt class="NAVHEADER"><a href="x19270.htm">Granting Privileges</a></dt></dl></div><p class="calibre9">As in most database systems, <span><i class="EMPHASIS">users</i></span> and <span><i class="EMPHASIS">groups</i></span> handle an important role within
  PostgreSQL. Used correctly, users and groups can allow for fine-grained, versatile access control to your database
  objects.</p><p class="calibre9">PostgreSQL stores both user and group data within its own system catalogs. These are different from the users and groups
  defined within the operating system on which the software is installed. Any connection to PostgreSQL must be made with a
  specific user, and any user may belong to one or more defined groups.</p><p class="calibre9">Users control the allocation of rights and track who is allowed to perform actions on
  the system (and which actions they may perform). Groups exist as a means to simplify the allocation of these rights.
  Both users and groups exist as global database objects, which means they are not tied to any particular database.</p><p class="calibre9">This chapter addresses the management and practical application of PostgreSQL users and groups.</p><div class="NAVHEADER"><h1 class="calibre7"><a name="MANAGINGUSERS" class="calibre8">Managing Users</a></h1><p class="calibre9">In order to establish a connection to PostgreSQL, you must supply a basic form of identification. This is called a
    <span><i class="EMPHASIS">username</i></span>, as it identifies the <span><i class="EMPHASIS">user</i></span> who the system will recognize as connected to a
    database. Users within PostgreSQL are not necessarily related to users of the operating system (which are sometimes called
    system <span><i class="EMPHASIS">accounts</i></span>), though you may choose to name your PostgreSQL users after the system accounts that
    will be accessing them.</p><p class="calibre9">Each user has an internal system ID to PostgreSQL (called a <span><i class="EMPHASIS">sysid</i></span>), as well as a password, though
    the password is not necessarily required to connect (depending on the configuration of the <span><i class="EMPHASIS">pg_hba.conf</i></span> ;
    (see <a href="c15679.htm">Chapter 8</a>, for more on this subject). The user's system ID is used to associate objects
    in a database with their <span><i class="EMPHASIS">owner</i></span> (the user who is allowed to grant and revoke rights on an object).</p><p class="calibre9">As well as being used to associate database objects with their owner, users may also have <span><i class="EMPHASIS">global</i></span>
    rights assigned to them when they are created. These rights determine whether or not a user is allowed to create and destroy
    databases, and whether or not the user is a <span><i class="EMPHASIS">superuser</i></span> (a user who is allowed all rights, in all
    databases, including the right to create users). The assignment of these rights may be modified at any time by an existing
    superuser.</p><p class="calibre9">PostgreSQL installs a single superuser by default named <span><i class="EMPHASIS">postgres</i></span>. All other users must
    be added by this user, or by another subsequently added superuser.</p><div class="NAVHEADER"><h2 class="SECT"><a name="AEN18619" class="calibre8">Viewing Users</a></h2><p class="calibre9">All user information is stored in a PostgreSQL system table called <tt class="REPLACEABLE">pg_shadow</tt>, shown
      in <a href="c18591.htm#THEPGSHADOWTABLETWO">Table 10-1</a>. This table is only selectable by superusers, though a limited view of this table
      called <tt class="REPLACEABLE">pg_user</tt> is accessible to normal users.</p><div class="NAVHEADER"><a name="THEPGSHADOWTABLETWO"></a><p class="calibre9"><b class="calibre10">Table 10-1. The pg_shadow table</b></p><table border="1" class="calibre"><thead class="calibre11"><tr class="calibre12"><th width="6" valign="TOP" class="calibre13"><p class="calibre9">Column</p></th><th width="6" valign="TOP" class="calibre13"><p class="calibre9">Type</p></th></tr></thead><tbody class="calibre14"><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">usename</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">name</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">usesysid</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">integer</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">usecreatedb</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">boolean</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">usetrace</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">boolean</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">usesuper</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">boolean</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">usecatupd</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">boolean</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">passwd</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">text</tt></p></td></tr><tr class="calibre12"><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">valuntil</tt></p></td><td width="6" valign="TOP" class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">abstime</tt></p></td></tr></tbody></table></div><p class="calibre9">The primary difference between the selectable data in <tt class="REPLACEABLE">pg_user</tt> and
      <tt class="REPLACEABLE">pg_shadow</tt> is that the actual value of the <tt class="REPLACEABLE">passwd</tt> column
      is not shown (it is replaced with a string of asterisks). This is a security measure to ensure that normal users are not
      able to determine one another's passwords.</p><p class="calibre9">The <tt class="REPLACEABLE">usename</tt> column stores the name of the system user, which is a unique character
      string (no two users may have the same name, as users are global database objects). Similarly, the
      <tt class="REPLACEABLE">usesysid</tt> column stores a unique integer value associated with the user. The
      <tt class="REPLACEABLE">usecreatedb</tt> and <tt class="REPLACEABLE">usesuper</tt> each correspond to the pair of
      privileges which can be set upon creation of a user, as documented in <a href="c18591.htm#CREATINGUSERS">the Section called <i class="EMPHASIS">Creating Users</i></a>."</p></div><div class="NAVHEADER"><h2 class="SECT"><a name="CREATINGUSERS" class="calibre8">Creating Users</a></h2><p class="calibre9">PostgreSQL provides two methods by which database users may be created. Each requires authentication as a superuser, for only
      superusers can create new users.</p><p class="calibre9">The first method is through the use of the SQL command <tt class="REPLACEABLE">CREATE USER</tt>, which may be
      executed by any properly authenticated PostgreSQL client (e.g., <span><i class="EMPHASIS">psql</i></span> ). The second is a command-line
      wrapper called <span><i class="EMPHASIS">createuser</i></span>, which may be more convenient for a system administrator, as it can be executed in a single
      command without the need to interact with a PostgreSQL client.</p><p class="calibre9">The following sections document each of these methods.</p><div class="NAVHEADER"><h3 class="AUTHOR"><a name="CREATINGAUSERWITHCREATEUSERSQL" class="calibre8">Creating a user with the CREATE USER SQL command</a></h3><p class="calibre9">The <tt class="REPLACEABLE">CREATE USER</tt> command requires only one parameter: the name of the new
        user. There are also a variety of options that may be set, including a password, explicit system ID, group, and a set of
        rights that may be explicitly allocated. Here is the complete syntax for <tt class="REPLACEABLE">CREATE USER</tt>:
        </p><pre class="SCREEN">  CREATE USER <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt>
    [ WITH [ SYSID <tt class="REPLACEABLE"><i class="EMPHASIS">uid</i></tt> ]
           [ PASSWORD '<tt class="REPLACEABLE"><i class="EMPHASIS">password</i></tt>' ] ]
    [ CREATEDB   | NOCREATEDB ]
    [ CREATEUSER | NOCREATEUSER ]
    [ IN GROUP <tt class="REPLACEABLE"><i class="EMPHASIS">groupname</i></tt> [, ...] ]
    [ VALID UNTIL '<tt class="REPLACEABLE"><i class="EMPHASIS">abstime</i></tt>' ]</pre><p class="calibre9">In this syntax, <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> is the name of the new user to be created. You cannot have two users
        with the same name. By specifying the <tt class="REPLACEABLE">WITH</tt> keyword, either or both of the
        <tt class="REPLACEABLE">SYSID</tt> and <tt class="REPLACEABLE">PASSWORD</tt> keywords may be applied.</p><p class="calibre9">Every other optional keyword may follow in the order displayed (not requiring the use of the
        <tt class="REPLACEABLE">WITH</tt> keyword). The following is a detailed explanation of each optional keyword and its
        meaning:</p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><tt class="REPLACEABLE">SYSID </tt><tt class="REPLACEABLE"><i class="EMPHASIS">uid</i></tt></dt><dd class="calibre16"><p class="calibre9">              Specifies that the system ID is to be set to the value of <tt class="REPLACEABLE"><i class="EMPHASIS">uid</i></tt>.  If omitted, a reasonable,
              unique numeric default is chosen.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">PASSWORD '</tt><tt class="REPLACEABLE"><i class="EMPHASIS">password</i></tt>'</dt><dd class="calibre16"><p class="calibre9">              Sets the new user's password to <tt class="REPLACEABLE"><i class="EMPHASIS">password</i></tt>. If unspecified, the password defaults to
              <tt class="REPLACEABLE">NULL</tt>.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">CREATEDB | NOCREATEDB</tt></dt><dd class="calibre16"><p class="calibre9">              Specifying the <tt class="REPLACEABLE">CREATEDB</tt> keyword grants the new user the right to create new
              databases, as well as the right to destroy databases which they own. Specifying
              <tt class="REPLACEABLE">NOCREATEDB</tt> explicitly enforces the default, which is the lack of this right.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">CREATEUSER | NOCREATEUSER</tt></dt><dd class="calibre16"><p class="calibre9">              Grants the right to create new users, which
              implicitly creates a superuser. Notice that a user with the rights to create other users will
              therefore have <span><i class="EMPHASIS">all rights</i></span>, in all databases (including the rights to create a database, even
              if <tt class="REPLACEABLE">NOCREATEDB</tt> was specified). <tt class="REPLACEABLE">NOCREATEUSER</tt>
              explicitly enforces the default, which is the lack of this right.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">IN GROUP </tt><tt class="REPLACEABLE"><i class="EMPHASIS">groupname</i></tt> [, ...]</dt><dd class="calibre16"><p class="calibre9">              Adds the new user to the group named <tt class="REPLACEABLE"><i class="EMPHASIS">groupname</i></tt>. Multiple group names may be specified by
              separating them with commas. The group(s) must exist in order for the statement to succeed.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">VALID UNTIL '</tt><tt class="REPLACEABLE"><i class="EMPHASIS">abstime</i></tt>'</dt><dd class="calibre16"><p class="calibre9">              Sets the user's password to expire at <tt class="REPLACEABLE"><i class="EMPHASIS">abstime</i></tt>, which must be of a recognizable timestamp format.
              After that date, the password must be reset, and the expiration moved forward.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">VALID UNTIL '</tt><tt class="REPLACEABLE"><i class="EMPHASIS">infinity</i></tt>'</dt><dd class="calibre16"><p class="calibre9">              Sets the user's password to be valid indefinitely.
            </p></dd></dl></div><p class="calibre9">By not specifying either <tt class="REPLACEABLE">CREATEDB</tt> or <tt class="REPLACEABLE">CREATEUSER</tt>,
        users are implicitly "normal" with no special rights. They may not create databases or
        other users, nor may they destroy databases or users. Such users may connect to databases in PostgreSQL, but they can only
        perform the statements which they have been granted access to (see <a href="x19270.htm">the Section called <i class="EMPHASIS">Granting Privileges</i></a>" for more on granting rights).</p><p class="calibre9"><a href="c18591.htm#CREATINGANORMALUSER">Example 10-1</a> creates a normal user named <tt class="REPLACEABLE">salesuser</tt>. It also
        sets a password of <span><i class="EMPHASIS">N0rm4!</i></span> by the use of the <tt class="REPLACEABLE">WITH PASSWORD</tt>
        clause.  By omitting the <tt class="REPLACEABLE">VALID UNTIL</tt> clause, this password will never expires.</p><div class="NAVHEADER"><a name="CREATINGANORMALUSER"></a><p class="calibre9"><b class="calibre10">Example 10-1. Creating a normal user</b></p><pre class="SCREEN">template1=# <tt class="REPLACEABLE"><b class="calibre10">CREATE USER salesuser</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">            WITH PASSWORD 'N0rm4!';</b></tt>
CREATE USER</pre></div><p class="calibre9">The <tt class="REPLACEABLE">CREATE USER</tt> server message returned in <a href="c18591.htm#CREATINGANORMALUSER">Example 10-1</a>
        indicates that the user was added successfully. Other messages you may receive from this command are as follows:</p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><tt class="REPLACEABLE">ERROR:  CREATE USER: permission denied</tt></dt><dd class="calibre16"><p class="calibre9">              This message is returned if the user issuing the CREATE USER command is not a superuser.
              Only superusers may create new users.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">ERROR:  CREATE USER: user name "salesuser" already exists</tt></dt><dd class="calibre16"><p class="calibre9">              This message indicates that a user with the name <tt class="REPLACEABLE">salesuser</tt> already exists.
            </p></dd></dl></div><p class="calibre9">If you wish to create a user who has the ability to create databases within PostgreSQL but not create or destroy
        PostgreSQL users, you may specify the <tt class="REPLACEABLE">CREATEDB</tt> keyword rather than
        <tt class="REPLACEABLE">CREATEUSER</tt>. This allows the named user to arbitrarily create databases, as
        well as drop any databases which they own. See <a href="c16573.htm">Chapter 9</a>, for more on this the topic of creating
        and destroying databases.</p><p class="calibre9"><a href="c18591.htm#CREATINGADATABASEUSER">Example 10-2</a> illustrates the creation of a user named <tt class="REPLACEABLE">dbuser</tt> who
        has the right to create new databases. This is achieved by specifying the <tt class="REPLACEABLE">CREATEDB</tt>
        keyword after the username. Notice also the use of the <tt class="REPLACEABLE">WITH PASSWORD</tt> and
        <tt class="REPLACEABLE">VALID UNTIL</tt> keywords. These set the password for <tt class="REPLACEABLE">dbuser</tt> to
        <span><i class="EMPHASIS">DbuS3r</i></span>, which will be valid until November 11th, 2002.</p><div class="NAVHEADER"><a name="CREATINGADATABASEUSER"></a><p class="calibre9"><b class="calibre10">Example 10-2. Creating a user with CREATEDB rights</b></p><pre class="SCREEN">template1=# <tt class="REPLACEABLE"><b class="calibre10">CREATE USER dbuser CREATEDB</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">            WITH PASSWORD 'DbuS3r'</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">            VALID UNTIL '2002-11-11';</b></tt>
CREATE USER</pre></div><p class="calibre9">Resetting an expired user's password does not modify the <tt class="REPLACEABLE">VALID UNTIL</tt>
        value. In order to re-active a user's access whose password has expired, both the <tt class="REPLACEABLE">WITH PASSWORD</tt>
        and <tt class="REPLACEABLE">VALID UNTIL</tt> keywords must be provided to the <tt class="REPLACEABLE">ALTER USER</tt>
        command. See <a href="c18591.htm#ALTERINGUSERS">the Section called <i class="EMPHASIS">Altering Users</i></a>" for more on this command.</p><div class="NAVHEADER"><p class="calibre9"></p><table class="calibre" border="1" width="100%"><tr class="calibre1"><td class="calibre23"><b class="calibre10">Warning</b></td></tr><tr class="calibre1"><td class="calibre15"><p class="calibre9"><tt class="REPLACEABLE">VALID UNTIL</tt> settings are only relevant to systems which are not trusted; sites
         which are trusted do not require passwords. See <a href="c15679.htm">Chapter 8</a> for more on
          host-based authentication.</p></td></tr></table></div><p class="calibre9">You may wish to create an alternate superuser from the <span><i class="EMPHASIS">postgres</i></span> user, though caution should be
        exercised in creating superusers. These users are granted <span><i class="EMPHASIS">every right</i></span> within PostgreSQL, including
        creating users, removing users, and destroying databases. <a href="c18591.htm#CREATINGASUPERUSER">Example 10-3</a> demonstrates the creation
        of a PostgreSQL superuser named <tt class="REPLACEABLE">manager</tt> from the <span><i class="EMPHASIS">psql</i></span> prompt.</p><div class="NAVHEADER"><a name="CREATINGASUPERUSER"></a><p class="calibre9"><b class="calibre10">Example 10-3. Creating a
superuser</b></p><pre class="SCREEN">template1=# <tt class="REPLACEABLE"><b class="calibre10">CREATE USER manager CREATEUSER;</b></tt>
CREATE USER</pre></div></div><div class="NAVHEADER"><h3 class="AUTHOR"><a name="CREATINGAUSERWITHCREATEUSER" class="calibre8">Creating a user with the createuser script</a></h3><p class="calibre9">The <span><i class="EMPHASIS">createuser</i></span> script is executed directly from the command line, and can operate in one of
        two ways. If issued without any arguments, it will interactively prompt you for the username and each of the rights, and
        attempt to make a local connection to PostgreSQL. Alternatively, you may choose to specify the options and
        the username to be created on the command line.</p><p class="calibre9">As with other command-line applications for PostgreSQL, arguments may be supplied either in their short form (with
        a single dash, and character), or in their long form (with two dashes, and the full name of the argument).</p><p class="calibre9">Here is the syntax for <span><i class="EMPHASIS">createuser</i></span> :</p><pre class="SCREEN">  createuser [ <tt class="REPLACEABLE"><i class="EMPHASIS">options</i></tt> ] [ <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> ]</pre><p class="calibre9">The <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> in the syntax represents the name of the user you wish to create. Replace
        <tt class="REPLACEABLE"><i class="EMPHASIS">options</i></tt> with one or more of the following flags:</p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER">-d, - -createdb</dt><dd class="calibre16"><p class="calibre9">              Equivalent to the <tt class="REPLACEABLE">CREATEDB</tt> keyword of the <tt class="REPLACEABLE">CREATE USER</tt>
              SQL command. Allows the new user to create databases.
            </p></dd><dt class="NAVHEADER">-D, - -no-createdb</dt><dd class="calibre16"><p class="calibre9">              Equivalent to the <tt class="REPLACEABLE">NOCREATEDB</tt> keyword of the <tt class="REPLACEABLE">CREATE USER</tt>
              SQL command. Explicitly indicates that the new user may not create databases. This is the default.
            </p></dd><dt class="NAVHEADER">-a, - -adduser</dt><dd class="calibre16"><p class="calibre9">              Equivalent to the <tt class="REPLACEABLE">CREATEUSER</tt> keyword of the <tt class="REPLACEABLE">CREATE USER</tt>
              SQL command. Allows the new user to create users, and raises the status of the user to a superuser (enabling
              <span><i class="EMPHASIS">all</i></span> rights within PostgreSQL).
            </p></dd><dt class="NAVHEADER">-A, - -no-adduser</dt><dd class="calibre16"><p class="calibre9">              Equivalent to the <tt class="REPLACEABLE">NOCREATEUSER</tt> keyword of the <tt class="REPLACEABLE">CREATE USER</tt>
              SQL command. Explicitly indicates that the new user is not a superuser. This is the default.
            </p></dd><dt class="NAVHEADER">-i <tt class="REPLACEABLE"><i class="EMPHASIS">SYSID</i></tt>, - -sysid=<tt class="REPLACEABLE"><i class="EMPHASIS">SYSID</i></tt></dt><dd class="calibre16"><p class="calibre9">              Sets the new users system ID to <tt class="REPLACEABLE"><i class="EMPHASIS">SYSID</i></tt>.
            </p></dd><dt class="NAVHEADER">-P, - -pwprompt</dt><dd class="calibre16"><p class="calibre9">              Results in a password prompt allowing you to set the password of the new user <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt>.
            </p></dd><dt class="NAVHEADER">-h <tt class="REPLACEABLE"><i class="EMPHASIS">HOSTNAME</i></tt>, - -host=<tt class="REPLACEABLE"><i class="EMPHASIS">HOSTNAME</i></tt></dt><dd class="calibre16"><p class="calibre9">              Specifies that <tt class="REPLACEABLE"><i class="EMPHASIS">HOSTNAME</i></tt> will be connected to, rather than the localhost, or the host defined
              by the <tt class="REPLACEABLE">PGHOST</tt> environment variable.
            </p></dd><dt class="NAVHEADER">-p <tt class="REPLACEABLE"><i class="EMPHASIS">PORT</i></tt>, - -port=<tt class="REPLACEABLE"><i class="EMPHASIS">PORT</i></tt></dt><dd class="calibre16"><p class="calibre9">              Specifies that the database connection will be made on port <tt class="REPLACEABLE"><i class="EMPHASIS">PORT</i></tt>, rather than the
              default port (usually 5432).
            </p></dd><dt class="NAVHEADER">-U <tt class="REPLACEABLE"><i class="EMPHASIS">USERNAME</i></tt>, - -username=<tt class="REPLACEABLE"><i class="EMPHASIS">USERNAME</i></tt></dt><dd class="calibre16"><p class="calibre9">              Specifies that <tt class="REPLACEABLE"><i class="EMPHASIS">USERNAME</i></tt> will be the user who connects to PostgreSQL
              (The default is to connect using the name of the system user executing the <span><i class="EMPHASIS">createuser</i></span> script).
            </p></dd><dt class="NAVHEADER">-W, - -password</dt><dd class="calibre16"><p class="calibre9">              Results in a password prompt for the connecting user, which happens automatically if the
              <span><i class="EMPHASIS">pg_hba.conf</i></span> file is configured not to <span><i class="EMPHASIS">trust</i></span> the requesting host.
            </p></dd><dt class="NAVHEADER">-e, - -echo</dt><dd class="calibre16"><p class="calibre9">              Causes the CREATE USER command sent to PostgreSQL to be displayed to the screen as it is
              executed by <span><i class="EMPHASIS">createuser</i></span>.
            </p></dd><dt class="NAVHEADER">-q, - -quiet</dt><dd class="calibre16"><p class="calibre9">              Prevents output from being sent to <span><i class="EMPHASIS">stdout</i></span> (though errors will
              still be sent to <span><i class="EMPHASIS">stderr</i></span>).
            </p></dd></dl></div><p class="calibre9">If any of the <span><i class="EMPHASIS">-d</i></span>, <span><i class="EMPHASIS">-D</i></span>, <span><i class="EMPHASIS">-a</i></span>, <span><i class="EMPHASIS">-A</i></span>,
        or <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> arguments are omitted, <span><i class="EMPHASIS">createuser</i></span> will prompt you for each missing
        argument. This is because PostgreSQL will not make any assumptions about the rights intended for the new user, nor about the new user's name. <a href="c18591.htm#CREATINGAUSER">Example 10-4</a> creates a user named <tt class="REPLACEABLE">newuser</tt>, who has neither the right to create a
        database, nor create users.</p><div class="NAVHEADER"><a name="CREATINGAUSER"></a><p class="calibre9"><b class="calibre10">Example 10-4. Creating a user with createuser</b></p><pre class="SCREEN">[jworsley@booktown ~]$ <tt class="REPLACEABLE"><b class="calibre10">createuser -U manager -D -A newuser</b></tt>
CREATE USER</pre></div><p class="calibre9">Notice also the <span><i class="EMPHASIS">-U manager</i></span> flag passed to the <span><i class="EMPHASIS">createuser</i></span> script. This
        indicates that the user with which to connect to PostgreSQL is <tt class="REPLACEABLE">manager</tt>, not
        <tt class="REPLACEABLE">jworsley</tt> as the script would otherwise assume, based on the name of the system account
        invoking the script.</p><p class="calibre9">If you prefer to be interactively prompted for each setting, (instead of having to remember the meaning of each
        flag or check the reference each time) you may simply omit the flags you are uncertain of. The
        <span><i class="EMPHASIS">createuser</i></span> script will then prompt you for the basic <span><i class="EMPHASIS">createuser</i></span> options. These
        options include the PostgreSQL username, whether the user may create databases, and whether or not the user may add new
        users to PostgreSQL.</p><p class="calibre9"><a href="c18591.htm#INTERACTIVELYCREATINGAUSER">Example 10-5</a> demonstrates using the <span><i class="EMPHASIS">createuser</i></span> script in
        interactive mode.  The net effect of this example is the same as the single line executed in <a href="c18591.htm#CREATINGAUSER">Example 10-4</a>.</p><div class="NAVHEADER"><a name="INTERACTIVELYCREATINGAUSER"></a><p class="calibre9"><b class="calibre10">Example 10-5. Interactively creating a user with createuser</b></p><pre class="SCREEN">[jworsley@booktown ~]$ <tt class="REPLACEABLE"><b class="calibre10">createuser</b></tt>
Enter name of user to add: newuser
Shall the new user be allowed to create databases? (y/n) n
Shall the new user be allowed to create more new users? (y/n) n
CREATE USER</pre></div></div></div><div class="NAVHEADER"><h2 class="SECT"><a name="ALTERINGUSERS" class="calibre8">Altering Users</a></h2><p class="calibre9">Existing users may only be modified by PostgreSQL superusers. Possible modifications include each of the options
      available at the creation of the user (e.g., password, password expiration date, global rights), except for the system ID
      of an existing user, which may not be modified. Modification of existing users is achieved through the use of the
      <tt class="REPLACEABLE">ALTER USER</tt> SQL statement.</p><p class="calibre9">Here is the syntax for <tt class="REPLACEABLE">ALTER USER</tt>:</p><pre class="SCREEN">  ALTER USER <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt>
             [ WITH PASSWORD '<tt class="REPLACEABLE"><i class="EMPHASIS">password</i></tt>' ]
             [ CREATEDB | NOCREATEDB ]
             [ CREATEUSER | NOCREATEUSER ]
             [ VALID UNTIL '<tt class="REPLACEABLE"><i class="EMPHASIS">abstime</i></tt>' ]</pre><p class="calibre9">The required <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> argument specifies which user is to be modified. Any of the following
      parameters may additionally be specified:</p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><tt class="REPLACEABLE">WITH PASSWORD '</tt><tt class="REPLACEABLE"><i class="EMPHASIS">password</i></tt>'</dt><dd class="calibre16"><p class="calibre9">            Sets <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt>'s password to <tt class="REPLACEABLE"><i class="EMPHASIS">password</i></tt>.
          </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">CREATEDB | NOCREATEDB</tt></dt><dd class="calibre16"><p class="calibre9">            Grants or revokes from <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> the right to create databases.
          </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">CREATEUSER | NOCREATEUSER</tt></dt><dd class="calibre16"><p class="calibre9">            Grants or revokes from <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> the status of superuser, which enables <span><i class="EMPHASIS">all</i></span>
            possible right within PostgreSQL (most notably the ability to create and destroy users and superusers).
          </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">VALID UNTIL '</tt><tt class="REPLACEABLE"><i class="EMPHASIS">abstime</i></tt>'</dt><dd class="calibre16"><p class="calibre9">            Sets <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt>'s password to expire at <tt class="REPLACEABLE"><i class="EMPHASIS">abstime</i></tt>, which must be of some valid
            timestamp format. This value is only relevant for systems requiring password authentication, and is otherwise ignored
            (e.g., for trusted sites).
          </p></dd></dl></div><p class="calibre9">A common function of <tt class="REPLACEABLE">ALTER USER</tt> is to reset the password (and potentially the
      expiration date) of a user. If a PostgreSQL user had an expiration date set when their user was originally added, and that date has passed, and the user
      requires password-based authentication, a superuser will have to reset both the password <span><i class="EMPHASIS">and</i></span> the
      expiration date to re-activate a user's ability to connect. If you want to cause a user's password to never expire, set it
      to the special timestamp <span><i class="EMPHASIS">infinity</i></span>.</p><p class="calibre9"><a href="c18591.htm#RESETTINGAPASSWORD">Example 10-6</a> modifies a user named <tt class="REPLACEABLE">salesuser</tt>. The user's
      password is set to <span><i class="EMPHASIS">n3Wp4s4</i></span> by the <tt class="REPLACEABLE">WITH PASSWORD</tt> clause, and set to
      expire on January 1st, 2003 by the <tt class="REPLACEABLE">VALID UNTIL</tt> clause.</p><div class="NAVHEADER"><a name="RESETTINGAPASSWORD"></a><p class="calibre9"><b class="calibre10">Example 10-6. Resetting a password</b></p><pre class="SCREEN">template1=# <tt class="REPLACEABLE"><b class="calibre10">ALTER USER salesuser</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">           WITH PASSWORD 'n3WP4s4'</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">           VALID UNTIL '2003-01-01';</b></tt>
ALTER USER</pre></div><p class="calibre9">At times you may wish to grant a user additional rights beyond those originally granted to them. The use of the
      <tt class="REPLACEABLE">CREATEUSER</tt> keyword in <a href="c18591.htm#ADDINGRIGHTS">Example 10-7</a> modifies the user
      <tt class="REPLACEABLE">salesuser</tt> to have all rights in PostgreSQL, making the user into a superuser. Note
      that this makes the <tt class="REPLACEABLE">CREATEDB</tt> right moot, as superusers can create databases
      implicitly.</p><div class="NAVHEADER"><a name="ADDINGRIGHTS"></a><p class="calibre9"><b class="calibre10">Example 10-7. Adding superuser rights</b></p><pre class="SCREEN">template1=# <tt class="REPLACEABLE"><b class="calibre10">ALTER USER salesuser</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">           CREATEUSER;</b></tt>
ALTER USER</pre></div><p class="calibre9">Conversely, there may be times when a user no longer deserves rights that have been granted in the past. These rights
      may be just as easily removed by a superuser with the <tt class="REPLACEABLE">NOCREATEDB</tt> and
      <tt class="REPLACEABLE">NOCREATEUSER</tt> keywords.</p><div class="NAVHEADER"><a name="REMOVINGRIGHTS"></a><p class="calibre9"><b class="calibre10">Example 10-8. Removing superuser rights</b></p><pre class="SCREEN">template1=# <tt class="REPLACEABLE"><b class="calibre10">ALTER USER salesuser</b></tt>
template1-# <tt class="REPLACEABLE"><b class="calibre10">           NOCREATEDB NOCREATEUSER;</b></tt>
ALTER USER</pre></div><div class="NAVHEADER"><p class="calibre9"></p><table class="calibre" border="1" width="100%"><tr class="calibre1"><td class="calibre23"><b class="calibre10">Warning</b></td></tr><tr class="calibre1"><td class="calibre15"><p class="calibre9">As any superuser may revoke rights from another superuser, or even remove another superuser, it is wise to be
        <span><i class="EMPHASIS">extremely careful</i></span> when granting the <tt class="REPLACEABLE">CREATEUSER</tt> right.</p></td></tr></table></div></div><div class="NAVHEADER"><h2 class="SECT"><a name="REMOVINGUSERS" class="calibre8">Removing Users</a></h2><p class="calibre9">PostgreSQL users may at any time be removed from the system by authenticated superusers. The only restriction is that
      a user may not be removed if any databases exist which are owned by that user. If a user owns a database, that database
      must be dropped before the user can be removed from the system.</p><p class="calibre9">As with the creation of PostgreSQL users, there are two methods by which users may be removed. These are the
      <tt class="REPLACEABLE">DROP USER</tt> SQL command, and the <span><i class="EMPHASIS">dropuser</i></span> command-line executable.</p><div class="NAVHEADER"><h3 class="AUTHOR"><a name="AEN19063" class="calibre8">Removing users with the DROP USER SQL command</a></h3><p class="calibre9">        A superuser may remove a user by issuing the DROP USER command from a valid PostgreSQL client.
        The <span><i class="EMPHASIS">psql</i></span> program is most commonly used to achieve this task.
        </p><p class="calibre9">Here is the syntax for <tt class="REPLACEABLE">DROP USER</tt>:</p><pre class="SCREEN">  DROP USER <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt></pre><p class="calibre9">In this syntax, <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> is the name of the user that you intend to permanently remove from
        the system. <a href="c18591.htm#REMOVINGAUSERWITHDROPUSERSQLEXAMPLE">Example 10-9</a> shows the use of the <span><i class="EMPHASIS">psql</i></span> client to
        connect to PostgreSQL as the <tt class="REPLACEABLE">manager</tt> user in order to remove the
        <tt class="REPLACEABLE">salesuser</tt> database user.</p><div class="NAVHEADER"><a name="REMOVINGAUSERWITHDROPUSERSQLEXAMPLE"></a><p class="calibre9"><b class="calibre10">Example 10-9. Removing a user with DROP USER</b></p><pre class="SCREEN">[jworsley@booktown ~]$ <tt class="REPLACEABLE"><b class="calibre10">psql -U manager template1</b></tt>
Welcome to psql, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help on internal slash commands
       \g or terminate with semicolon to execute query
       \q to quit

template1=# <tt class="REPLACEABLE"><b class="calibre10">DROP USER salesuser;</b></tt>
DROP USER</pre></div><p class="calibre9">The <tt class="REPLACEABLE">DROP USER</tt> server message indicates that the user was successfully removed from
        the system. Other messages that you might receive from this command include:</p><p class="calibre9"> </p><p class="calibre9"></p><div class="NAVHEADER"><dl class="calibre9"><dt class="NAVHEADER"><tt class="REPLACEABLE">ERROR:  DROP USER: permission denied</tt></dt><dd class="calibre16"><p class="calibre9">              Indicates that the user initiating the command does not have the right to drop a user. Only superusers may drop
              existing database users.
            </p></dd><dt class="NAVHEADER"><tt class="REPLACEABLE">ERROR:  DROP USER: user "salesuser" does not exist</tt></dt><dd class="calibre16"><p class="calibre9">              Indicates that there is no such user with the name <tt class="REPLACEABLE">salesuser</tt>.
            </p></dd></dl></div>
</div><div class="NAVHEADER"><h3 class="AUTHOR"><a name="REMOVINGUSERSWITHDROPUSER" class="calibre8">Removing users with the dropuser operating system command</a></h3><p class="calibre9">The <span><i class="EMPHASIS">dropuser</i></span> command operates much like the <span><i class="EMPHASIS">createuser</i></span> script. It offers the
        same connection options, ensuring that it can be used remotely as well as locally, and requires only the username of the user
        to be removed from the system.</p><p class="calibre9">Here is the syntax for <span><i class="EMPHASIS">dropuser</i></span>: </p><pre class="SCREEN">  dropuser [ <tt class="REPLACEABLE"><i class="EMPHASIS">options</i></tt> ] [ <tt class="REPLACEABLE"><i class="EMPHASIS">username</i></tt> ]</pre><p class="calibre9">Each of the connectivity options is identical to those for <span><i class="EMPHASIS">createuser</i></span>, described in <a href="c18591.htm#CREATINGAUSERWITHCREATEUSER">the Section called <i class="EMPHASIS">Creating a user with the createuser script</i></a>," earlier in this chapter. <a href="c18591.htm#REMOVINGAUSERWITHDROPUSEREXAMPLE">Example 10-10</a>
        demonstrates the same net effect as the SQL statement in <a href="c18591.htm#REMOVINGAUSERWITHDROPUSERSQLEXAMPLE">Example 10-9</a> by
        connecting to the PostgreSQL backend as the <tt class="REPLACEABLE">manager</tt> user, and removing the user named
        <tt class="REPLACEABLE">salesuser</tt>.</p><div class="NAVHEADER"><a name="REMOVINGAUSERWITHDROPUSEREXAMPLE"></a><p class="calibre9"><b class="calibre10">Example 10-10. Removing a user with dropuser</b></p><pre class="SCREEN">[jworsley@booktown ~]$ <tt class="REPLACEABLE"><b class="calibre10">dropuser -U manager salesuser</b></tt>
DROP USER</pre></div><p class="calibre9">The output from <span><i class="EMPHASIS">dropuser</i></span> is the same as the output for the SQL
        <tt class="REPLACEABLE">DROP USER</tt> command. If you omit the <tt class="REPLACEABLE">username</tt> that you wish
        to remove when you execute the script <span><i class="EMPHASIS">dropuser</i></span>, you will be prompted interactively for the
        name of that user to be removed from the system.</p></div></div></div></div><div class="NAVHEADER"><hr width="100%" class="calibre6"/><table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0" class="calibre"><tr class="calibre1"><td width="33%" valign="top" class="calibre3"><a href="x17860.htm" accesskey="P">Prev</a></td><td width="34%" valign="top" class="calibre4"><a href="book1.htm" accesskey="H">Home</a></td><td width="33%" valign="top" class="calibre5"><a href="x19123.htm" accesskey="N">Next</a></td></tr><tr class="calibre1"><td width="33%" valign="top" class="calibre3">Backing Up and Restoring Data</td><td width="34%" valign="top" class="calibre4"><a href="p15677.htm" accesskey="U">Up</a></td><td width="33%" valign="top" class="calibre5">Managing Groups</td></tr></table></div></div>

{% endraw %}

