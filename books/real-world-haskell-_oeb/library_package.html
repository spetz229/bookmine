---
layout: page
title: "Real World Haskell, 1st Edition"
prev: I_sect15_d1e13904_split_001.html
next: I_sect15_d1e14861.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="I_sect15_d1e13904_split_000.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect15_d1e14861.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="library_package" class="calibre27" id="library_package"></a><h3 id="title-IDAOVHGF" class="docSection1Title">5.14. Creating a Package</h3><a name="x_Ep" class="calibre27" id="x_Ep"></a><p class="docText">The Haskell<a name="ch05-packagescreating" class="calibre27" id="ch05-packagescreating"></a> community<a name="ch05-cabal" class="calibre27" id="ch05-cabal"></a> has built a standard set of tools, named Cabal, that help
    with building, installing, and distributing software. Cabal organizes
    software as a <span class="docEmphasis">package</span>. A package contains one
    library, and possibly several executable programs.</p><a name="library_packaged1e14676" class="calibre27" id="library_packaged1e14676"></a><h4 id="title-IDADWHGF" class="docSection1Title">5.14.1. Writing a Package Description</h4><a name="x_Fp" class="calibre27" id="x_Fp"></a><p class="docText">To do anything with a package, Cabal needs a description
      of it. This is contained in a text file whose name ends with the suffix
      <i class="docEmphasis">.cabal</i>. This file belongs in the
      top-level directory of your project. It has a simple format, which we'll
      describe next.</p><a name="x_Gp" class="calibre27" id="x_Gp"></a><p class="docText">A Cabal package must have a name. Usually, the name of
      the package matches the name of the <i class="docEmphasis">.cabal</i> file. We'll call our package
      <tt class="calibre34">mypretty</tt>, so our file is <i class="docEmphasis">mypretty.cabal</i>. Often, the directory that
      contains a <i class="docEmphasis">.cabal</i> file will have
      the same name as the package, e.g., <tt class="calibre34">mypretty</tt>.</p><a name="x_Hp" class="calibre27" id="x_Hp"></a><p class="docText">A package description begins with a series of global
      properties, which apply to every library and executable in the
      package:</p><pre class="calibre39">Name:          mypretty
Version:       0.1

-- This is a comment.  It stretches to the end of the line.</pre><br class="calibre48"/>
<a name="x_Ip" class="calibre27" id="x_Ip"></a><p class="docText">Package names must be unique. If you create and install
      a package that has the same name as a package already present on your
      system, <span class="docMonofont">GHC</span> will get very
      confused.</p><a name="x_Jp" class="calibre27" id="x_Jp"></a><p class="docText">The global properties include a substantial amount of
      information that is intended for human readers, not Cabal itself:</p><pre class="calibre39">Synopsis:      My pretty printing library, with JSON support
Description:
  A simple pretty-printing library that illustrates how to
  develop a Haskell library.
Author:        Real World Haskell
Maintainer:    nobody@realworldhaskell.org</pre><br class="calibre48"/>
<a name="x_Kp" class="calibre27" id="x_Kp"></a><p class="docText">As the <tt class="calibre34">Description</tt> field indicates, a field
      can span multiple lines, provided they're indented.</p><a name="x_Lp" class="calibre27" id="x_Lp"></a><p class="docText">Also included in the global properties is license
      information. Most Haskell packages are licensed under the BSD license,
      which Cabal calls <tt class="calibre34">BSD3</tt>.<sup class="docFootnote"><a class="docLink1" href="#x_Lpd1e14724">[11]</a></sup> (Obviously, you're free to choose whatever license you
      think is appropriate.) The optional <tt class="calibre34">License-File</tt> field lets
      us specify the name of a file that contains the exact text of our
      package's licensing terms.</p><blockquote class="calibre30"><p class="docFootnote1"><sup class="calibre50"><a name="x_Lpd1e14724" class="calibre5" id="x_Lpd1e14724">[11]</a></sup> The "3" in <tt class="calibre34">BSD3</tt> refers to
          the number of clauses in the license. An older version of the BSD
          license contained 4 clauses, but it is no longer used.</p></blockquote><a name="x_Np" class="calibre27" id="x_Np"></a><p class="docText">The features supported by successive versions of Cabal
      evolve over time, so it's wise to indicate what versions of Cabal we
      expect to be compatible with. The features we are describing are
      supported by versions 1.2 and higher of Cabal:</p><pre class="calibre39">Cabal-Version: &gt;= 1.2</pre><br class="calibre48"/>
<a name="x_Op" class="calibre27" id="x_Op"></a><p class="docText">To describe an individual library within a package, we
      <a name="I_indexterm5_d1e14681" class="calibre27" id="I_indexterm5_d1e14681"></a>write a <span class="docEmphasis">library section</span>. The use of
      indentation here is significant; the contents of a section must be
      indented:</p><pre class="calibre39">library
  Exposed-Modules: Prettify
                   PrettyJSON
                   SimpleJSON
  Build-Depends:   base &gt;= 2.0</pre><br class="calibre48"/>
<a name="x_Pp" class="calibre27" id="x_Pp"></a><p class="docText">The <tt class="calibre34">Exposed-Modules</tt> field <a name="I_indexterm5_d1e14695" class="calibre27" id="I_indexterm5_d1e14695"></a>contains a list of modules that should be available to
      users of this package. An optional field, <tt class="calibre34">Other-Modules</tt>,
      contains<a name="I_indexterm5_d1e14702" class="calibre27" id="I_indexterm5_d1e14702"></a> a list of <span class="docEmphasis">internal</span>
      modules.<a name="I_indexterm5_d1e14710" class="calibre27" id="I_indexterm5_d1e14710"></a> These are required for this library to function, but will
      not be visible to users.</p><a name="x_Qp" class="calibre27" id="x_Qp"></a><p class="docText">The <tt class="calibre34">Build-Depends</tt> field<a name="I_indexterm5_d1e14719" class="calibre27" id="I_indexterm5_d1e14719"></a> contains a comma-separated list of packages that our
      library requires to build. For each package, we can optionally specify
      the range of versions with which this library is known to work. The
      <tt class="calibre34">base</tt> package contains many of the core Haskell modules,
      such as the <tt class="calibre34">Prelude</tt>, so it's effectively always
      required.</p><p class="calibre37"><table border="0" cellspacing="0" cellpadding="1" width="90%" class="calibre41"><tr class="calibre16"><td class="v3"><table width="100%" border="0" cellspacing="0" cellpadding="6" class="calibre42"><tr class="calibre16"><td width="60" valign="top" class="v3"><img src="tip_yellow.gif" alt="" class="calibre43"/></td><td valign="top" class="v3"><p class="docNormalTitle">Figuring out build dependencies</p><a name="x_Rp" class="calibre27" id="x_Rp"></a><p class="docText">We don't have to guess or do any research to establish
        which packages we depend on. If we try to build our package without a
        <tt class="calibre34">Build-Depends</tt> field, compilation will fail with a useful
        error message. Here's an example where we commented out the dependency
        on the <tt class="calibre34">base</tt> package:</p><pre class="calibre39">$<b class="calibre40">runghc Setup build</b>
Preprocessing library mypretty-0.1...
Building mypretty-0.1...

PrettyJSON.hs:8:7:
    Could not find module `Data.Bits':
      it is a member of package base, which is hidden</pre><a name="x_Sp" class="calibre27" id="x_Sp"></a><p class="docText">The error message makes it clear that we need to add
        the <tt class="calibre34">base</tt> package, even though <tt class="calibre34">base</tt> is
        already installed. Forcing us to be explicit about every package we
        need has a practical benefit: a command-line tool named
        <i class="docEmphasis">cabal-install</i> will automatically download, build,
        and install a package and all of the packages it depends on.</p></td></tr></table></td></tr></table></p><br class="calibre48"/><a name="library_packaged1e14820" class="calibre27" id="library_packaged1e14820"></a><h4 id="title-IDAJ1HGF" class="docSection1Title">5.14.2. GHC's Package Manager</h4><a name="x_Tp" class="calibre27" id="x_Tp"></a><p class="docText"><span class="docMonofont">GHC</span> includes
      a simple package manager that tracks which packages are installed, and
      what the versions of those packages are. A command-line tool named
      <i class="docEmphasis">ghc-pkg</i> lets us work with its package
      databases.</p><a name="x_Up" class="calibre27" id="x_Up"></a><p class="docText">We say <span class="docEmphasis">databases</span> because
      <span class="docMonofont">GHC</span> distinguishes between
      <span class="docEmphasis">system-wide</span> packages, which are available to every
      user, and <span class="docEmphasis">per-user</span> packages, which are only visible
      to the current user. The per-user database lets us avoid the need for
      administrative privileges to install packages.</p><a name="x_Wp" class="calibre27" id="x_Wp"></a><p class="docText">The <tt class="calibre34">ghc-pkg</tt> command provides
      subcommands to address different tasks. Most of the time, we'll need
      only two of them. The <tt class="calibre34">ghc-pkg list</tt> command lets us see what
      packages are installed. When we want to uninstall a package,
      <tt class="calibre34">ghc-pkg unregister</tt> tells <span class="docMonofont">GHC</span> that we won't be using a particular
      package any longer. (We will have to manually delete the installed files
      ourselves.)</p><a name="library_packaged1e14858" class="calibre27" id="library_packaged1e14858"></a><h4 id="title-IDAT2HGF" class="docSection1Title">5.14.3. Setting Up, Building, and Installing</h4><a name="x_Xp" class="calibre27" id="x_Xp"></a><p class="docText">In addition to a <i class="docEmphasis">.cabal</i> file, a package must contain a
      <span class="docEmphasis">setup</span> file. This allows Cabal's build process to be
      heavily customized (if a package needs it). The simplest setup file
      looks like this:</p><pre class="calibre39">-- file: ch05/Setup.hs
#!/usr/bin/env runhaskell
import Distribution.Simple
main = defaultMain</pre><br class="calibre48"/>
<a name="x_Yp" class="calibre27" id="x_Yp"></a><p class="docText">We save this file under the name <i class="docEmphasis">Setup.hs</i>.</p><a name="x_ap" class="calibre27" id="x_ap"></a><p class="docText">Once we write the <i class="docEmphasis">.cabal</i> and <i class="docEmphasis">Setup.hs</i> files, there are three steps
      left:</p><div class="calibre15"><ol class="docList2" type="1"><li class="calibre19"><div class="calibre15"><p class="docText">To instruct Cabal how to build and where to install a package,
          we run a simple <span class="docEmphasis">command</span>:</p><pre class="calibre39">              $
              <b class="calibre40">runghc Setup configure</b></pre><br class="calibre48"/>
<p class="docText">This ensures that the packages we need are
          available, and it stores settings to be used later by other Cabal
          commands.</p><p class="docText">If we do not provide any arguments to
          <tt class="calibre34">configure</tt>, Cabal will install our package in the
          system-wide package database. To install it into our home directory
          and our personal package database, we must provide a little more
          information:</p></div></li><li class="calibre19"><div class="calibre15"><p class="docText">We build the package:</p><pre class="calibre39">              $
              <b class="calibre40">runghc Setup build</b></pre><br class="calibre48"/>
</div></li><li class="calibre19"><div class="calibre15"><p class="docText">If this succeeds, we can install the package. We don't need to
          indicate where to install to—Cabal will use the settings we provided
          in the <tt class="calibre34">configure</tt> step. It will install to our own
          directory and update <span class="docMonofont">GHC</span>'s per-user package
          database.</p></div></li></ol></div>
<a href="21061538.html" class="calibre2"><img src="pixel.gif" alt="" border="0" class="calibre31"/></a><ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="I_sect15_d1e13904_split_000.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect15_d1e14861.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

