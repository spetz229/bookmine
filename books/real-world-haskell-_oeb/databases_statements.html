---
layout: page
title: "Real World Haskell, 1st Edition"
prev: databases_args.html
next: databases_readingresults.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="databases_args.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="databases_readingresults.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="databases_statements" class="calibre27" id="databases_statements"></a><h3 id="title-IDAYAQZC" class="docSection1Title">21.8. Prepared Statements</h3><a name="x_kc" class="calibre27" id="x_kc"></a><p class="docText">HDBC defines a<a name="I_indexterm21_d1e44745" class="calibre27" id="I_indexterm21_d1e44745"></a> function <tt class="calibre34">prepare</tt> that
    will prepare a SQL query, but it does not yet bind the parameters to the
    query. <tt class="calibre34">prepare</tt> returns a <tt class="calibre34">Statement</tt> representing the compiled
    query.</p><a name="x_lc" class="calibre27" id="x_lc"></a><p class="docText">Once you have a <tt class="calibre34">Statement</tt>, you can do a number of things with
    it. You can call <tt class="calibre34">execute</tt> on it one or more times. After
    calling <tt class="calibre34">execute</tt> on a query that returns
    data, you can use one of the fetch functions to retrieve that data.
    Functions such as <tt class="calibre34">run</tt> and <tt class="calibre34">quickQuery'</tt> use statements and <tt class="calibre34">execute</tt> internally; they are simply shortcuts to
    let you perform common tasks quickly. When you need more control over
    what's happening, you can use a <tt class="calibre34">Statement</tt> instead of a function such as <tt class="calibre34">run</tt>.</p><a name="x_mc" class="calibre27" id="x_mc"></a><p class="docText">Let's look at using statements to insert multiple values
    with a single query. Here's an example:</p><pre class="calibre39">ghci&gt; <b class="calibre40">conn &lt;- connectSqlite3 "test1.db"</b>ghci&gt; <b class="calibre40">stmt &lt;- prepare conn "INSERT INTO test VALUES (?, ?)"</b>ghci&gt; <b class="calibre40">execute stmt [toSql 1, toSql "one"]</b>
1
ghci&gt; <b class="calibre40">execute stmt [toSql 2, toSql "two"]</b>
1
ghci&gt; <b class="calibre40">execute stmt [toSql 3, toSql "three"]</b>
1
ghci&gt; <b class="calibre40">execute stmt [toSql 4, SqlNull]</b>
1
ghci&gt; <b class="calibre40">commit conn</b>ghci&gt; <b class="calibre40">disconnect conn</b></pre><a name="x_nc" class="calibre27" id="x_nc"></a><p class="docText">Here, we create a prepared statement and call it <tt class="calibre34">stmt</tt>. We then execute that statement four times
    and pass different parameters each time. These parameters are used, in
    order, to replace the question marks in the original query string.
    Finally, we commit the changes and disconnect the database.</p><a name="x_oc" class="calibre27" id="x_oc"></a><p class="docText">HDBC also provides a function, <tt class="calibre34">executeMany</tt>, that can be useful in situations
    such as this. <tt class="calibre34">executeMany</tt> simply takes
    a list of rows of data to call the statement with. Here's an
    example:</p><pre class="calibre39">        ghci&gt; 
        <b class="calibre40">conn &lt;- connectSqlite3 "test1.db"</b>
        ghci&gt; 
        <b class="calibre40">stmt &lt;- prepare conn "INSERT INTO test VALUES (?, ?)"</b>
        ghci&gt; 
        <b class="calibre40">executeMany stmt [[toSql 5, toSql "five's nice"], [toSql 6, SqlNull]]</b>
        ghci&gt; 
        <b class="calibre40">commit conn</b>
        ghci&gt; 
        <b class="calibre40">disconnect conn</b></pre><a name="databases_statementsd1e45172" class="calibre27" id="databases_statementsd1e45172"></a><div class="docNote"><p class="docNormalTitle">NOTE</p><p class="calibre37"><a name="x_pc" class="calibre27" id="x_pc"></a></p><p class="docText">On the server, most databases will have an optimization
      that they can apply to <tt class="calibre34">executeMany</tt> so
      that they only have to compile this query string once, rather than
      twice.<sup class="docFootnote"><a class="docLink1" href="#x_pcd1e45180">[54]</a></sup> This can lead to a dramatic performance gain when
      inserting large amounts of data at one time. Some databases can also
      apply this optimization to <tt class="calibre34">execute</tt>,
      but not all.</p><blockquote class="calibre30"><p class="docFootnote1"><sup class="calibre50"><a name="x_pcd1e45180" class="calibre5" id="x_pcd1e45180">[54]</a></sup> HDBC emulates this behavior for databases that do
          not provide it, offering programmers a unified API for running
          queries repeatedly.</p></blockquote></div>
<a href="21061538.html" class="calibre2"><img src="pixel.gif" alt="" border="0" class="calibre31"/></a><ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="databases_args.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="databases_readingresults.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

