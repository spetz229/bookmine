---
layout: page
title: "Real World Haskell, 1st Edition"
prev: I_sect110_d1e24985.html
next: binary_implicit.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="I_sect110_d1e24985.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="binary_implicit.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect110_d1e25091" class="calibre27" id="I_sect110_d1e25091"></a><h3 id="title-IDAVQXZH" class="docSection1Title">10.3. Getting Rid of Boilerplate Code</h3><a name="x_JR" class="calibre27" id="x_JR"></a><p class="docText">While<a name="I_indexterm10_d1e25096" class="calibre27" id="I_indexterm10_d1e25096"></a><a name="I_indexterm10_d1e25097" class="calibre27" id="I_indexterm10_d1e25097"></a> our <i class="docEmphasis">parseP5</i> function
    works, the style in which we wrote it is somehow not pleasing. Our code
    marches steadily to the right of the screen, and it's clear that a
    slightly more complicated function would soon run out of visual real
    estate. We repeat a pattern of constructing and then deconstructing
    Maybe values, only continuing if a particular value matches
    <i class="docEmphasis">Just</i>. All of the similar <tt class="calibre34">case</tt> expressions act as <span class="docEmphasis">boilerplate
    code</span>, busywork that obscures what we're really trying to do. In
    short, this function is begging for some abstraction and
    refactoring.</p><a name="x_KR" class="calibre27" id="x_KR"></a><p class="docText">If we step back a little, we can see two patterns. First
    is that many of the functions that we apply have similar types. Each takes
    a ByteString as its last argument and returns
    Maybe something else. Second, every step in the
    "ladder" of our <i class="docEmphasis">parseP5</i>
    function deconstructs a Maybe value, and either fails or
    passes the unwrapped result to a <span class="docEmphasis">function</span>.</p><a name="x_LR" class="calibre27" id="x_LR"></a><p class="docText">We can quite easily write a function that captures this
    second pattern:</p><pre class="calibre39">-- file: ch10/PNM.hs
(&gt;&gt;?) :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
Nothing &gt;&gt;? _ = Nothing
Just v  &gt;&gt;? f = f v</pre><br class="calibre48"/>
<a name="x_MR" class="calibre27" id="x_MR"></a><p class="docText">The <i class="docEmphasis">(&gt;&gt;?)</i>
    function<a name="I_indexterm10_d1e25149" class="calibre27" id="I_indexterm10_d1e25149"></a> acts very simply: it takes a value as its left argument,
    and a function as its right. If the value is not <tt class="calibre34">Nothing</tt>, it applies the function to whatever is
    wrapped in the <tt class="calibre34">Just</tt> constructor. We have defined our function
    as an operator so that we can use it to chain functions together. Finally,
    we haven't provided a fixity declaration for <i class="docEmphasis">(&gt;&gt;?)</i>, so it defaults to <tt class="calibre34">infixl
    9</tt> (left-associative, strongest operator precedence). In other
    words, <tt class="calibre34">a &gt;&gt;? b &gt;&gt;? c</tt> will be evaluated from left
    to right, as <tt class="calibre34">(a &gt;&gt;? b) &gt;&gt;? c)</tt>.</p><a name="x_NR" class="calibre27" id="x_NR"></a><p class="docText">With this chaining function in hand, we can take a second
    try at our parsing function:</p><pre class="calibre39">-- file: ch10/PNM.hs
parseP5_take2 :: L.ByteString -&gt; Maybe (Greymap, L.ByteString)
parseP5_take2 s =
    matchHeader (L8.pack "P5") s      &gt;&gt;?
    \s -&gt; skipSpace ((), s)           &gt;&gt;?
    (getNat . snd)                    &gt;&gt;?
    skipSpace                         &gt;&gt;?
    \(width, s) -&gt;   getNat s         &gt;&gt;?
    skipSpace                         &gt;&gt;?
    \(height, s) -&gt;  getNat s         &gt;&gt;?
    \(maxGrey, s) -&gt; getBytes 1 s     &gt;&gt;?
    (getBytes (width * height) . snd) &gt;&gt;?
    \(bitmap, s) -&gt; Just (Greymap width height maxGrey bitmap, s)

skipSpace :: (a, L.ByteString) -&gt; Maybe (a, L.ByteString)
skipSpace (a, s) = Just (a, L8.dropWhile isSpace s)</pre><br class="calibre48"/>
<a name="x_OR" class="calibre27" id="x_OR"></a><p class="docText">The key to understanding this function is to think about
    the chaining. On the left side of each <i class="docEmphasis">(&gt;&gt;?)</i> is a Maybe value; on
    the right is a function that returns a Maybe value. Each
    left-and-right-side expression is thus of type Maybe,
    suitable for passing to the following <i class="docEmphasis">(&gt;&gt;?)</i> expression.</p><a name="x_PR" class="calibre27" id="x_PR"></a><p class="docText">The other change that we've made to improve readability is
    add a <i class="docEmphasis">skipSpace</i> function. With these
    changes, we've halved the number of lines of code compared to our original
    parsing function. By removing the boilerplate <tt class="calibre34">case</tt> expressions, we've made the code easier to
    follow.</p><a name="x_QR" class="calibre27" id="x_QR"></a><p class="docText">While we warned against overuse of anonymous functions in
    <a class="docLink" href="fp_anonymous.html#fp_anonymous">Section 4.7</a>, we use several in our chain of functions
    here. Because these functions are so small, we wouldn't improve
    readability by giving them names.</p>
<a href="21061538.html" class="calibre2"><img src="pixel.gif" alt="" border="0" class="calibre31"/></a><ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="I_sect110_d1e24985.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="binary_implicit.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

