---
layout: page
title: "Real World Haskell, 1st Edition"
prev: monadcase_split_001.html
next: monadcase_ap.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="monadcase_split_000.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="monadcase_ap.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="monadcase_urlencoded" class="calibre27" id="monadcase_urlencoded"></a><h3 id="title-IDA0LU1F" class="docSection1Title">15.1. Golfing Practice: Association Lists</h3><a name="x_ki" class="calibre27" id="x_ki"></a><p class="docText">Web <a name="ch15-monads001" class="calibre27" id="ch15-monads001"></a>clients and servers often pass information around as a
    simple textual list<a name="I_indexterm15_d1e33907" class="calibre27" id="I_indexterm15_d1e33907"></a> of key-value pairs:</p><pre class="calibre39">name=Attila+%42The+Hun%42&amp;occupation=Khan</pre><br class="calibre48"/>
<a name="x_li" class="calibre27" id="x_li"></a><p class="docText">The encoding is <a name="I_indexterm15_d1e33915" class="calibre27" id="I_indexterm15_d1e33915"></a>named <tt class="calibre34">application/x-www-form-urlencoded</tt>, and
    it's easy to understand. Each key-value pair is separated by an &amp;
    character. Within a pair, a key is a series of characters, followed by an
    =, followed by a value.</p><a name="x_mi" class="calibre27" id="x_mi"></a><p class="docText">We can obviously represent a key as a String,
    but the HTTP specification is not clear about whether a key must be
    followed by a value. We can capture this ambiguity by representing a value
    as a Maybe String. If we use <tt class="calibre34">Nothing</tt> for a
    value, then there is no value present. If we wrap a string in
    <tt class="calibre34">Just</tt>, then there is a value. Using Maybe lets us
    distinguish between "no value" and "empty value."</p><a name="x_ni" class="calibre27" id="x_ni"></a><p class="docText">Haskell programmers use the <a name="I_indexterm15_d1e33945" class="calibre27" id="I_indexterm15_d1e33945"></a>name <span class="docEmphasis">association list</span> for the type
    [(a, b)], where we can think of each element as an
    association between a key and a value. The name originates in the Lisp
    community, where it's usually abbreviated as an
    <span class="docEmphasis">alist</span>. We could thus represent the preceding string
    as the following Haskell value:</p><pre class="calibre39">-- file: ch15/MovieReview.hs
    [("name",       Just "Attila \"The Hun\""),
     ("occupation", Just "Khan")]</pre><br class="calibre48"/>
<a name="x_oi" class="calibre27" id="x_oi"></a><p class="docText">In <a class="docLink" href="applicative_urlencoded.html#applicative_urlencoded">Section 16.6</a>, we'll parse
    an <tt class="calibre34">application/x-www-form-urlencoded</tt> string, and we will
    represent the result as an alist of [(String, Maybe String)].
    Let's say we want to use one of these alists to fill out a data
    structure:</p><pre class="calibre39">-- file: ch15/MovieReview.hs
data MovieReview = MovieReview {
      revTitle :: String
    , revUser :: String
    , revReview :: String
    }</pre><br class="calibre48"/>
<a name="x_pi" class="calibre27" id="x_pi"></a><p class="docText">We'll begin by belaboring the obvious with a naive
    function:</p><pre class="calibre39">-- file: ch15/MovieReview.hs
simpleReview :: [(String, Maybe String)] -&gt; Maybe MovieReview
simpleReview alist =
  case lookup "title" alist of
    Just (Just title@(_:_)) -&gt;
      case lookup "user" alist of
        Just (Just user@(_:_)) -&gt;
          case lookup "review" alist of
            Just (Just review@(_:_)) -&gt;
                Just (MovieReview title user review)
            _ -&gt; Nothing -- no review
        _ -&gt; Nothing -- no user
    _ -&gt; Nothing -- no title</pre><br class="calibre48"/>
<a name="x_qi" class="calibre27" id="x_qi"></a><p class="docText">It returns a MovieReview only if the alist
    contains all of the necessary values, and they're all nonempty strings.
    However, the fact that it validates its inputs is its only merit. It
    suffers badly from the "staircasing" that we've learned to be
    wary of, and it knows the intimate details of the representation of an
    alist.</p><a name="x_ri" class="calibre27" id="x_ri"></a><p class="docText">Since we're now well acquainted with the
    Maybe monad, we can tidy up the staircasing:</p><pre class="calibre39">-- file: ch15/MovieReview.hs
maybeReview alist = do
    title &lt;- lookup1 "title" alist
    user &lt;- lookup1 "user" alist
    review &lt;- lookup1 "review" alist
    return (MovieReview title user review)

lookup1 key alist = case lookup key alist of
                      Just (Just s@(_:_)) -&gt; Just s
                      _ -&gt; Nothing</pre><br class="calibre48"/>
<a name="x_si" class="calibre27" id="x_si"></a><p class="docText">Although this is much neater, we're still repeating
    ourselves. We can take advantage of the fact that the
    <tt class="calibre34">MovieReview</tt> constructor acts as a normal, pure function by
    <span class="docEmphasis">lifting</span> it into the monad, as we discussed in <a class="docLink" href="monads_liftM.html#monads_liftM">Section 14.7</a>:</p><pre class="calibre39">-- file: ch15/MovieReview.hs
liftedReview alist =
    liftM3 MovieReview (lookup1 "title" alist)
                       (lookup1 "user" alist)
                       (lookup1 "review" alist)</pre><br class="calibre48"/>
<a name="x_oG1" class="calibre27" id="x_oG1"></a><p class="docText">We still have some repetition here, but it is
    dramatically reduced and also more difficult to remove.</p>
<ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="monadcase_split_000.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="monadcase_ap.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

