---
layout: page
title: "Real World Haskell, 1st Edition"
prev: monadtrans_maybet_split_001.html
next: I_sect118_d1e40625.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"><a href="21061538.html" class="calibre13"><img src="btn_next_.gif" alt="Next" border="0" class="calibre26"/></a> 
           
          <span class="calibre9"><a target="_self" href="monadtrans_maybet_split_000.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect118_d1e40625.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect118_d1e40515" class="calibre27" id="I_sect118_d1e40515"></a><h3 id="title-IDABDAN" class="docSection1Title">18.7. Transformer Stacking Order Is Important</h3><a name="x_iu" class="calibre27" id="x_iu"></a><p class="docText">From<a name="I_indexterm18_d1e40520" class="calibre27" id="I_indexterm18_d1e40520"></a><a name="I_indexterm18_d1e40521" class="calibre27" id="I_indexterm18_d1e40521"></a><a name="I_indexterm18_d1e40524" class="calibre27" id="I_indexterm18_d1e40524"></a>our early examples using monad transformers <a name="I_indexterm18_d1e40530" class="calibre27" id="I_indexterm18_d1e40530"></a><a name="I_indexterm18_d1e40535" class="calibre27" id="I_indexterm18_d1e40535"></a>such as ReaderT and StateT, it
    might be easy to conclude that the order in which we stack monad
    transformers doesn't <span class="docEmphasis">matter</span>.</p><a name="x_ju" class="calibre27" id="x_ju"></a><p class="docText">When we stack StateT on top of
    State, it should be clearer that order can indeed make a
    difference. The types StateT Int (State String) and
    StateT String (State Int) might carry around the same
    information, but we can't use them interchangeably. The ordering
    determines when we need to use <i class="docEmphasis">lift</i>
    to get at one or the other piece of state.</p><a name="x_ku" class="calibre27" id="x_ku"></a><p class="docText">Here's a case that more dramatically demonstrates the
    importance of ordering. Suppose we have a computation that might fail, and
    we want to log the circumstances under which it does so:</p><pre class="calibre39">-- file: ch18/MTComposition.hs
{-# LANGUAGE FlexibleContexts #-}
import Control.Monad.Writer
import MaybeT

problem :: MonadWriter [String] m =&gt; m ()
problem = do
  tell ["this is where i fail"]
  fail "oops"</pre><br class="calibre48"/>
<a name="x_lu" class="calibre27" id="x_lu"></a><p class="docText">Which of these monad stacks will give us the information
    we need?</p><pre class="calibre39">-- file: ch18/MTComposition.hs
type A = WriterT [String] Maybe

type B = MaybeT (Writer [String])

a :: A ()
a = problem

b :: B ()
b = problem</pre><br class="calibre48"/>
<a name="x_mu" class="calibre27" id="x_mu"></a><p class="docText">Let's try the alternatives in <i class="docEmphasis">ghci</i>:</p><pre class="calibre39">ghci&gt; <b class="calibre40">runWriterT a</b>
Loading package mtl-1.1.0.1 ... linking ... done.
Nothing
ghci&gt; <b class="calibre40">runWriter $ runMaybeT b</b>
(Nothing,["this is where i fail"])</pre><a name="x_nu" class="calibre27" id="x_nu"></a><p class="docText">This difference in results should not come as a
    surprise—just look at the signatures of the execution functions:</p><pre class="calibre39">ghci&gt; <b class="calibre40">:t runWriterT</b>
runWriterT :: WriterT w m a -&gt; m (a, w)
ghci&gt; <b class="calibre40">:t runWriter . runMaybeT</b>
runWriter . runMaybeT :: MaybeT (Writer w) a -&gt; (Maybe a, w)</pre><a name="x_ou" class="calibre27" id="x_ou"></a><p class="docText">Our WriterT-on-Maybe stack has
    Maybe as the underlying monad, so <i class="docEmphasis">runWriterT</i> must give us back a result of type
    Maybe. In our test case, we get to see only the log of what
    happened if nothing actually went wrong!</p><a name="x_pu" class="calibre27" id="x_pu"></a><p class="docText">Stacking monad transformers is analogous to composing
    functions. If we change the order in which we apply functions and then get
    different results, we won't be surprised. So it is with monad
    transformers, too.</p>
<ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"><a href="21061538.html" class="calibre2"><img src="btn_next_.gif" alt="Next" border="0" class="calibre31"/></a> 
           
          <span class="calibre33"><a target="_self" href="monadtrans_maybet_split_000.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect118_d1e40625.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

