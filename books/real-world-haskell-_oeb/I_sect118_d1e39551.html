---
layout: page
title: "Real World Haskell, 1st Edition"
prev: I_sect118_d1e39405.html
next: I_sect118_d1e39658_split_000.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"><a href="21061538.html" class="calibre13"><img src="btn_next_.gif" alt="Next" border="0" class="calibre26"/></a> 
           
          <span class="calibre9"><a target="_self" href="I_sect118_d1e39405.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect118_d1e39658_split_000.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect118_d1e39551" class="calibre27" id="I_sect118_d1e39551"></a><h3 id="643999-925" class="docSection1Title">18.3. Common Patterns in Monads and Monad Transformers</h3><a name="x_Rt" class="calibre27" id="x_Rt"></a><p class="docText">Most<a name="I_indexterm18_d1e39556" class="calibre27" id="I_indexterm18_d1e39556"></a> of the monads and monad transformers <a name="I_indexterm18_d1e39562" class="calibre27" id="I_indexterm18_d1e39562"></a>in the <tt class="calibre34">mtl</tt> library follow a few common patterns
    around naming and typeclasses.</p><a name="x_St" class="calibre27" id="x_St"></a><p class="docText">To illustrate these rules, we will focus on a single
    straightforward monad: the <tt class="calibre34">reader</tt> monad. The
    <tt class="calibre34">reader</tt> monad's API is detailed by the
    MonadReader typeclass.<a name="I_indexterm18_d1e39582" class="calibre27" id="I_indexterm18_d1e39582"></a> Most <tt class="calibre34">mtl</tt> monads have similarly named
    typeclasses. MonadWriter defines the API of the writer monad,
    and so on:</p><pre class="calibre39">-- file: ch18/Reader.hs
class (Monad m) =&gt; MonadReader r m | m -&gt; r where
    ask   :: m r
    local :: (r -&gt; r) -&gt; m a -&gt; m a</pre><br class="calibre48"/>
<a name="x_Ut" class="calibre27" id="x_Ut"></a><p class="docText">The type variable <span class="docMonofont">r</span>
    represents the immutable state that the reader monad carries around. The
    Reader r monad is an instance of the MonadReader
    class, as is the ReaderT r m monad transformer. Again, this
    pattern is repeated by other mtl monads: there usually exist
    both a concrete monad and a transformer, each of which are instances of
    the typeclass that defines the monad's API.</p><a name="x_Vt" class="calibre27" id="x_Vt"></a><p class="docText">Returning to the specifics of the reader monad, we haven't
    touched upon the <i class="docEmphasis">local</i> function
    before. It temporarily modifies the current environment using the r
    -&gt; r function, and then executes its action in the modified
    environment. To make this idea more concrete, here is a simple
    example:</p><pre class="calibre39">-- file: ch18/LocalReader.hs
import Control.Monad.Reader

myName step = do
  name &lt;- ask
  return (step ++ ", I am " ++ name)

localExample :: Reader String (String, String, String)
localExample = do
  a &lt;- myName "First"
  b &lt;- local (++"dy") (myName "Second")
  c &lt;- myName "Third"
  return (a, b, c)</pre><br class="calibre48"/>
<a name="x_Wt" class="calibre27" id="x_Wt"></a><p class="docText">If we execute the <i class="docEmphasis">localExample</i> action in <i class="docEmphasis">ghci</i>, we can see that the effect of modifying
    the environment is confined to one place:</p><pre class="calibre39">ghci&gt; <b class="calibre40">runReader localExample "Fred"</b>
Loading package mtl-1.1.0.1 ... linking ... done.
("First, I am Fred","Second, I am Freddy","Third, I am Fred")
</pre><a name="x_Xt" class="calibre27" id="x_Xt"></a><p class="docText">When the underlying monad <span class="docMonofont">m</span>
    is an instance of MonadIO, the <tt class="calibre34">mtl</tt> library
    provides an instance for ReaderT r m and also for a number of
    other typeclasses. Here are a few:</p><pre class="calibre39">-- file: ch18/Reader.hs
instance (Monad m) =&gt; Functor (ReaderT r m) where
    ...

instance (MonadIO m) =&gt; MonadIO (ReaderT r m) where
    ...

instance (MonadPlus m) =&gt; MonadPlus (ReaderT r m) where
    ...</pre><br class="calibre48"/>
<a name="x_Yt" class="calibre27" id="x_Yt"></a><p class="docText">Once again, most <tt class="calibre34">mtl</tt> monad transformers
    define instances such as these, in order to make it easier for us to work
    with them.</p>
<ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"><a href="21061538.html" class="calibre2"><img src="btn_next_.gif" alt="Next" border="0" class="calibre31"/></a> 
           
          <span class="calibre33"><a target="_self" href="I_sect118_d1e39405.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect118_d1e39658_split_000.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

