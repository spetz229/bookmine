---
layout: page
title: "Real World Haskell, 1st Edition"
prev: I_sect126_d1e49589.html
next: I_sect126_d1e49776.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"><a href="21061538.html" class="calibre13"><img src="btn_next_.gif" alt="Next" border="0" class="calibre26"/></a> 
           
          <span class="calibre9"><a target="_self" href="I_sect126_d1e49589.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect126_d1e49776.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect126_d1e49680" class="calibre27" id="I_sect126_d1e49680"></a><h3 id="643999-887" class="docSection1Title">26.4. The ST Monad</h3><a name="x_o71" class="calibre27" id="x_o71"></a><p class="docText">Back in <a class="docLink" href="barcode_array_split_000.html#barcode_array_mutable">Section 12.2.3</a>, we
    mentioned that modifying an immutable array is prohibitively expensive, as
    it requires copying the entire array. Using a UArray does not
    change this, so what can we do to reduce the cost to bearable
    levels?</p><a name="x_p71" class="calibre27" id="x_p71"></a><p class="docText">In an imperative language, we would simply modify the
    elements of the array in place—this will be our approach in Haskell,
    too.</p><a name="x_q71" class="calibre27" id="x_q71"></a><p class="docText">Haskell provides a special monad,<a name="I_indexterm26_d1e49694" class="calibre27" id="I_indexterm26_d1e49694"></a> named ST,<sup class="docFootnote"><a class="docLink1" href="#x_q71d1e49977">[60]</a></sup> which lets us work safely with mutable state. Compared to
    the State monad, it has some powerful added
    capabilities:</p><blockquote class="calibre30"><p class="docFootnote1"><sup class="calibre50"><a name="x_q71d1e49977" class="calibre5" id="x_q71d1e49977">[60]</a></sup> The name ST is an acronym for
        <span class="docEmphasis">state thread</span>.</p></blockquote><ul class="calibre18"><li class="calibre19"><p class="docText">We can <span class="docEmphasis">thaw</span> an immutable array
        to give a mutable array; modify the mutable array in place; and
        <span class="docEmphasis">freeze</span> a new immutable array when we are
        done.</p></li><li class="calibre19"><p class="docText">We have the ability to use <span class="docEmphasis">mutable
        references</span>. This<a name="I_indexterm26_d1e49730" class="calibre27" id="I_indexterm26_d1e49730"></a> lets us implement data structures that we can modify
        after construction, as in an imperative language. This ability is
        vital for some imperative data structures and algorithms, for which
        similarly efficient, purely functional alternatives have not yet been
        discovered.</p></li></ul><a name="x_u71" class="calibre27" id="x_u71"></a><p class="docText">The IO monad also provides these
    capabilities. The major difference between the two is that the
    ST monad is intentionally designed so that we can
    <span class="docEmphasis">escape</span> from it back into pure Haskell code. We enter
    the ST monad via the execution <a name="I_indexterm26_d1e49748" class="calibre27" id="I_indexterm26_d1e49748"></a>function <i class="docEmphasis">runST</i> (in the
    same way as most other Haskell monads do—except IO, of
    course), and we escape by returning from <i class="docEmphasis">runST</i>.</p><a name="x_v71" class="calibre27" id="x_v71"></a><p class="docText">When we apply a monad's execution function, we expect it
    to behave repeatably: given the same body and arguments, we must get the
    same results every time. This also applies to <i class="docEmphasis">runST</i>. To achieve this repeatability, the
    ST monad is more restrictive than the IO monad.
    We cannot read or write files, create global variables, or fork threads.
    Indeed, although we can create and work with mutable references and
    arrays, the type system prevents them from escaping to the caller of
    <i class="docEmphasis">runST</i>. A mutable array must be frozen
    into an immutable array before we can return it, and a mutable reference
    cannot escape at all.</p>
<ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"><a href="21061538.html" class="calibre2"><img src="btn_next_.gif" alt="Next" border="0" class="calibre31"/></a> 
           
          <span class="calibre33"><a target="_self" href="I_sect126_d1e49589.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect126_d1e49776.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

