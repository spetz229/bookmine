---
layout: page
title: "Real World Haskell, 1st Edition"
prev: I_sect126_d1e49566.html
next: I_sect126_d1e49680.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="I_sect126_d1e49566.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect126_d1e49680.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect126_d1e49589" class="calibre27" id="I_sect126_d1e49589"></a><h3 id="title-IDARTJUD" class="docSection1Title">26.3. Basic Design</h3><a name="x_f71" class="calibre27" id="x_f71"></a><p class="docText">The data structure that we use for our Haskell Bloom
    filter is a direct translation of the simple description we gave earlier—a
    bit array and a function that computes hashes:</p><pre class="calibre39">-- file: BloomFilter/Internal.hs
module BloomFilter.Internal
    (
      Bloom(..)
    , MutBloom(..)
    ) where

import Data.Array.ST (STUArray)
import Data.Array.Unboxed (UArray)
import Data.Word (Word32)

data Bloom a = B {
      blmHash  :: (a -&gt; [Word32])
    , blmArray :: UArray Word32 Bool
    }</pre><br class="calibre48"/>
<a name="x_g71" class="calibre27" id="x_g71"></a><p class="docText">When we create our Cabal package, we will not be
    exporting this <tt class="calibre34">BloomFilter.</tt><tt class="calibre34">Internal</tt> module. It exists purely to let us
    control the visibility of names. We will import
    <tt class="calibre34">BloomFilter.Internal</tt> into both the mutable and immutable
    modules, but we will re-export from each module only the type that is
    relevant to that module's API.</p><a name="bloomfilter_uarray" class="calibre27" id="bloomfilter_uarray"></a><h4 id="title-IDAIUJUD" class="docSection1Title">26.3.1. Unboxing, Lifting, and Bottom</h4><a name="x_h71" class="calibre27" id="x_h71"></a><p class="docText">Unlike other Haskell <a name="I_indexterm26_d1e49611" class="calibre27" id="I_indexterm26_d1e49611"></a>arrays, a UArray contains<a name="I_indexterm26_d1e49620" class="calibre27" id="I_indexterm26_d1e49620"></a> <span class="docEmphasis">unboxed</span> values.</p><a name="x_i71" class="calibre27" id="x_i71"></a><p class="docText">For a normal Haskell type, a value can be either fully
      evaluated, an unevaluated thunk, or the special value <img src="u22a5.gif" border="0" class="calibre45"/>, pronounced (and
      sometimes written) <span class="docEmphasis">bottom</span>. The value <img src="u22a5.gif" border="0" class="calibre45"/> is a
      placeholder for a computation that does not succeed. Such a computation
      could take any of several forms. It could be an infinite loop, an
      application of <i class="docEmphasis">error</i>, or the
      special value <i class="docEmphasis">undefined</i>.</p><a name="x_j71" class="calibre27" id="x_j71"></a><p class="docText">A type that can contain <img src="u22a5.gif" border="0" class="calibre45"/> is referred to as
      <span class="docEmphasis">lifted</span>. All normal Haskell types are lifted. In
      practice, this means that we can always write <tt class="calibre34">error "eek!"</tt>
      or <tt class="calibre34">undefined</tt> in place of a normal expression.</p><a name="x_k71" class="calibre27" id="x_k71"></a><p class="docText">This ability to store thunks or <img src="u22a5.gif" border="0" class="calibre45"/> comes with a
      performance cost: it adds an extra layer of indirection. To see why we
      need this indirection, consider the Word32 type. A value of
      this type is a full 32 bits wide, so on a 32-bit system, there is no way
      to directly encode the value <img src="u22a5.gif" border="0" class="calibre45"/> within 32 bits. The runtime system has to
      maintain, and check, some extra data to track whether the value is <img src="u22a5.gif" border="0" class="calibre45"/> or
      not.</p><a name="x_l71" class="calibre27" id="x_l71"></a><p class="docText">An unboxed value does away with this indirection. In
      doing so, it gains performance but sacrifices the ability to represent a
      thunk or <img src="u22a5.gif" border="0" class="calibre45"/>. Since it can be denser than a normal Haskell array, an array
      of unboxed values is an excellent choice for numeric data and
      bits.</p><a name="x_n71" class="calibre27" id="x_n71"></a><p class="docText"><span class="docMonofont">GHC</span>
      implements a UArray of Bool values by packing
      eight array elements into each byte, so this type is perfect for our
      needs.</p><a name="bloomfilter_uarrayd1e49942" class="calibre27" id="bloomfilter_uarrayd1e49942"></a><div class="docNote"><p class="docNormalTitle">NOTE</p><p class="calibre37"><a name="x_m71" class="calibre27" id="x_m71"></a></p><p class="docText">The counterpart of an unboxed type is a
        <span class="docEmphasis">boxed</span> type, which uses <span class="docEmphasis">indirection</span>. All lifted types are boxed,
        but a few low-level boxed types are not lifted. For instance,
        <span class="docMonofont">GHC</span>'s runtime system has a
        low-level array type for which it uses boxing (i.e., it maintains a
        pointer to the array). If it has a reference to such an array, it
        knows that the array must exist, so it does not need to account for
        the possibility of <img src="u22a5.gif" border="0" class="calibre45"/>. This array type is thus boxed, but not lifted.
        Boxed but unlifted types show up only at the lowest level of runtime
        hacking. We will never encounter them in normal use.</p></div>
<a href="21061538.html" class="calibre2"><img src="pixel.gif" alt="" border="0" class="calibre31"/></a><ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="I_sect126_d1e49566.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect126_d1e49680.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

