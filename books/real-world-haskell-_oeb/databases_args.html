---
layout: page
title: "Real World Haskell, 1st Edition"
prev: database_sqlvalue.html
next: databases_statements.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="database_sqlvalue.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="databases_statements.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="databases_args" class="calibre27" id="databases_args"></a><h3 id="title-IDAPABSD" class="docSection1Title">21.7. Query Parameters</h3><a name="x_ec" class="calibre27" id="x_ec"></a><p class="docText">HDBC, like most databases,<a name="I_indexterm21_d1e44659" class="calibre27" id="I_indexterm21_d1e44659"></a> supports a notion of replaceable parameters in queries.
    There are three primary benefits of using replaceable parameters: they
    prevent SQL injection attacks or trouble when the input contains quote
    characters, they improve performance when executing similar queries
    repeatedly, and they permit easy and portable insertion of data into
    queries.</p><a name="x_fc" class="calibre27" id="x_fc"></a><p class="docText">Let's say you want to add thousands of rows into our new
    table <tt class="calibre34">test</tt>. You could issue queries
    that look like <tt class="calibre34">INSERT INTO test VALUES (0,
    'zero')</tt> and <tt class="calibre34">INSERT INTO test VALUES (1,
    'one')</tt>. This forces the database server to parse each SQL
    statement individually. If you could replace the two values with a
    placeholder, the server could parse the SQL query once and just execute it
    multiple times with the different data.</p><a name="x_gc" class="calibre27" id="x_gc"></a><p class="docText">A second problem involves escaping characters. What if you
    want to insert the string <tt class="calibre34">"I don't like
    1"</tt>? SQL uses the single quote character to show the end of the
    field. Most SQL databases would require you to write this as <tt class="calibre34">'I don''t like 1'</tt>. But rules for other special
    characters such as backslashes differ between databases. Rather than
    trying to code this yourself, HDBC can handle it all for you. Let's look
    at an example:</p><pre class="calibre39">ghci&gt; <b class="calibre40">conn &lt;- connectSqlite3 "test1.db"</b>ghci&gt; <b class="calibre40">run conn "INSERT INTO test VALUES (?, ?)" [toSql 0, toSql "zero"]</b>
1
ghci&gt; <b class="calibre40">commit conn</b>ghci&gt; <b class="calibre40">disconnect conn</b></pre><a name="x_hc" class="calibre27" id="x_hc"></a><p class="docText">The question marks in the INSERT query<a name="I_indexterm21_d1e44707" class="calibre27" id="I_indexterm21_d1e44707"></a> in this example are the placeholders. We then pass the
    parameters that are going to go there. <tt class="calibre34">run</tt> takes a list of <tt class="calibre34">SqlValue</tt>, so we use <tt class="calibre34">toSql</tt> to convert each item into an <tt class="calibre34">SqlValue</tt>. HDBC automatically handles conversion
    of the <tt class="calibre34">String</tt> <tt class="calibre34">"zero"</tt> into the appropriate representation for
    the database in use.</p><a name="x_ic" class="calibre27" id="x_ic"></a><p class="docText">This approach won't actually achieve any performance
    benefits when inserting large amounts of data. For that, we need more
    control over the process of creating the SQL query. We'll discuss that in
    the next section.</p><a name="databases_argsd1e45034" class="calibre27" id="databases_argsd1e45034"></a><div class="docNote"><p class="docNormalTitle">NOTE</p><p class="calibre37"><a name="x_jc" class="calibre27" id="x_jc"></a></p><p class="docText">Replaceable parameters work only for parts of the
      queries where the server is expecting a value, such as a WHERE clause in
      a SELECT statement or a value for an INSERT statement. You cannot say
      <tt class="calibre34">run "SELECT * from ?" [toSql
      "tablename"]</tt> and expect it to work. A table name is not a
      value, and most databases will not accept this syntax. That's not a big
      problem in practice, because there is rarely a call for replacing things
      in this way that aren't values.</p></div>
<a href="21061538.html" class="calibre2"><img src="pixel.gif" alt="" border="0" class="calibre31"/></a><ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="database_sqlvalue.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="databases_statements.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

