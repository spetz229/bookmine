---
layout: page
title: "Real World Haskell, 1st Edition"
prev: monads_state_split_001.html
next: I_sect114_d1e33741.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"><a href="21061538.html" class="calibre13"><img src="btn_next_.gif" alt="Next" border="0" class="calibre26"/></a> 
           
          <span class="calibre9"><a target="_self" href="monads_state_split_000.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect114_d1e33741.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect114_d1e33514" class="calibre27" id="I_sect114_d1e33514"></a><h3 id="643999-863" class="docSection1Title">14.14. Monads and Functors</h3><a name="x_Ha" class="calibre27" id="x_Ha"></a><p class="docText">Functors<a name="I_indexterm14_d1e33519" class="calibre27" id="I_indexterm14_d1e33519"></a><a name="I_indexterm14_d1e33520" class="calibre27" id="I_indexterm14_d1e33520"></a><a name="ch14-functionsmonads" class="calibre27" id="ch14-functionsmonads"></a><a name="ch14-monfunctions" class="calibre27" id="ch14-monfunctions"></a> and monads are closely related. The terms are borrowed from
    a branch of mathematics<a name="I_indexterm14_d1e33532" class="calibre27" id="I_indexterm14_d1e33532"></a> called <span class="docEmphasis">category theory</span>, but they did
    not make the transition to Haskell completely unscathed.</p><a name="x_ch" class="calibre27" id="x_ch"></a><p class="docText">In category theory, a monad is built from a functor. You
    might expect that in Haskell, the <tt class="calibre34">Monad</tt> typeclass would thus
    be a subclass of <tt class="calibre34">Functor</tt>, but it isn't defined as such in the
    standard <tt class="calibre34">Prelude</tt>—an unfortunate oversight.</p><a name="x_dh" class="calibre27" id="x_dh"></a><p class="docText">However, authors of Haskell libraries use a workaround:
    when programmers define an instance of <tt class="calibre34">Monad</tt> for a type, they
    almost always write a <tt class="calibre34">Functor</tt> instance for it, too. You can
    expect that you'll be able to use the <tt class="calibre34">Functor</tt> typeclass's
    <i class="docEmphasis">fmap</i> function with any monad.</p><a name="x_eh" class="calibre27" id="x_eh"></a><p class="docText">If we compare the type signature of <a name="I_indexterm14_d1e33566" class="calibre27" id="I_indexterm14_d1e33566"></a><i class="docEmphasis">fmap</i> with those of some
    of the standard monad functions that we've already seen, we get a hint as
    to what <i class="docEmphasis">fmap</i> on a monad does:</p><pre class="calibre39">ghci&gt; <b class="calibre40">:type fmap</b>
fmap :: (Functor f) =&gt; (a -&gt; b) -&gt; f a -&gt; f b
ghci&gt; <b class="calibre40">:module +Control.Monad</b>
ghci&gt; <b class="calibre40">:type liftM</b>
liftM :: (Monad m) =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r</pre><a name="x_fh" class="calibre27" id="x_fh"></a><p class="docText">Sure enough, <i class="docEmphasis">fmap</i>
    lifts a pure function into the monad, just as <i class="docEmphasis">liftM</i> does.</p><a name="monads_join" class="calibre27" id="monads_join"></a><h4 id="title-IDACUEVD" class="docSection1Title">14.14.1. Another Way of Looking at Monads</h4><a name="x_gh" class="calibre27" id="x_gh"></a><p class="docText">Now that we know about the relationship between
      <a name="I_indexterm14_d1e33606" class="calibre27" id="I_indexterm14_d1e33606"></a>functors and monads, if we look back at the list monad, we
      can see something interesting. Specifically, take a look at the
      definition of <i class="docEmphasis">(&gt;&gt;=)</i> for
      lists:</p><pre class="calibre39">-- file: ch14/ListMonad.hs
instance Monad [] where
    return x = [x]
    xs &gt;&gt;= f = concat (map f xs)</pre><br class="calibre48"/>
<a name="x_hh" class="calibre27" id="x_hh"></a><p class="docText">Recall that <span class="docMonofont">f</span> has type a -&gt;
      [a]. When we call <tt class="calibre34">map f xs</tt>, we get back a value of
      type [[a]], which we have to "flatten" using
      <tt class="calibre34">concat</tt>.</p><a name="x_ih" class="calibre27" id="x_ih"></a><p class="docText">Consider what we could do if <tt class="calibre34">Monad</tt> was a
      subclass of <i class="docEmphasis">Functor</i>. Since
      <i class="docEmphasis">fmap</i> for lists is defined to be
      <i class="docEmphasis">map</i>, we could replace <i class="docEmphasis">map</i> with <i class="docEmphasis">fmap</i> in the definition of <i class="docEmphasis">(&gt;&gt;=)</i>. This is not very interesting by
      itself, but suppose we go further.</p><a name="x_jh" class="calibre27" id="x_jh"></a><p class="docText">The <i class="docEmphasis">concat</i> function
      is of type [[a]] -&gt; [a]. As we mentioned, it flattens
      the nesting of lists. We could generalize this type signature from lists
      to monads, giving us the "remove a level of nesting" type
      m (m a) -&gt; m a. The function that has this type is
      conventionally named <i class="docEmphasis">join</i>.</p><a name="x_kh" class="calibre27" id="x_kh"></a><p class="docText">If we had definitions of <i class="docEmphasis">join</i> and <i class="docEmphasis">fmap</i>, we wouldn't need to write a definition
      of <i class="docEmphasis">(&gt;&gt;=)</i> for every monad,
      because it would be completely generic. Here's what an alternative
      definition of the <tt class="calibre34">Monad</tt> typeclass might look like, along
      with a definition of <i class="docEmphasis">(&gt;&gt;=)</i>:</p><pre class="calibre39">-- file: ch14/AltMonad.hs
import Prelude hiding ((&gt;&gt;=), return)

class Functor m =&gt; AltMonad m where
    join :: m (m a) -&gt; m a
    return :: a -&gt; m a

(&gt;&gt;=) :: AltMonad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
xs &gt;&gt;= f = join (fmap f xs)</pre><br class="calibre48"/>
<a name="x_lh" class="calibre27" id="x_lh"></a><p class="docText">Neither definition of a monad is "better," because if we
      have <i class="docEmphasis">join</i> we can write <i class="docEmphasis">(&gt;&gt;=)</i> and vice versa, but the different
      perspectives can be refreshing.</p><a name="x_mh" class="calibre27" id="x_mh"></a><p class="docText">Removing a layer<a name="I_indexterm14_d1e33707" class="calibre27" id="I_indexterm14_d1e33707"></a><a name="I_indexterm14_d1e33710" class="calibre27" id="I_indexterm14_d1e33710"></a> of monadic wrapping can, in fact, be useful in realistic
      circumstances. We can find a generic definition of <i class="docEmphasis">join</i> in the <tt class="calibre34">Control.Monad</tt>
      module:</p><pre class="calibre39">-- file: ch14/MonadJoin.hs
join :: Monad m =&gt; m (m a) -&gt; m a
join x = x &gt;&gt;= id</pre><br class="calibre48"/>
<a name="x_nh" class="calibre27" id="x_nh"></a><p class="docText">Here are some examples of what it does:</p><pre class="calibre39">ghci&gt; <b class="calibre40">join (Just (Just 1))</b>
Just 1
ghci&gt; <b class="calibre40">join Nothing</b>
Nothing
ghci&gt; <b class="calibre40">join [[1],[2,3]]</b>
[1,2,3]</pre>
<ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"><a href="21061538.html" class="calibre2"><img src="btn_next_.gif" alt="Next" border="0" class="calibre31"/></a> 
           
          <span class="calibre33"><a target="_self" href="monads_state_split_000.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect114_d1e33741.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

