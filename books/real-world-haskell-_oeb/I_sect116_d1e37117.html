---
layout: page
title: "Real World Haskell, 1st Edition"
prev: I_sect116_d1e37048.html
next: I_sect116_d1e37324.html
book_path: books/real-world-haskell-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>

    <a name="toppage" class="calibre5" id="toppage"></a>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody">
      <tr valign="top" class="calibre6">
        <td class="calibre7">
          <a name="MainContent" class="calibre5" id="MainContent"></a>
          <table width="95%" class="sfbody">
            <tr class="calibre6">
              <td class="v">
                <!--Copyright (c) 2002 Safari Tech Books Online-->
                <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody">
                  <tr class="calibre6">
                    <td valign="middle" class="v1" height="5">
                      <img src="pixel.gif" alt="" border="0" class="calibre8"/>
                    </td>
                  </tr>
                  <tr class="calibre6">
                    <td valign="middle" class="v1">
                      <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody">
                        <tr class="calibre6">
                          <td class="v"><span class="calibre9"> </span>
                   
                  <span class="calibre9">   </span>
             <span class="calibre9"> </span></td>
                        </tr>
                      </table>
                    </td>
                    <td class="v1"/>
                    <td valign="middle" class="v2"> 
           
          <span class="calibre9"><a target="_self" href="I_sect116_d1e37048.html" title="Previous section" class="calibre13"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre14"/></a></span>
				
				 
				
				<span class="calibre9"><a target="_self" href="I_sect116_d1e37324.html" title="Next section" class="calibre13"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre14"/></a></span></td>
                  </tr>
                </table>
                <div id="section" class="calibre15">
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v3">Safari IT Books Language Constructs Functional Programming Haskell Safari IT Books Programming Programming Programming Bryan O'Sullivan  Donald Bruce Stewart  John Goerzen  O'Reilly Media, Inc. Real World Haskell, 1st Edition<a name="I_sect116_d1e37117" class="calibre27" id="I_sect116_d1e37117"></a><h3 id="title-IDAXGNWE" class="docSection1Title">16.10. Applicative Parsing by Example</h3><a name="x_pj" class="calibre27" id="x_pj"></a><p class="docText">We'll start by rewriting our existing form parser from the
    bottom up, beginning with <i class="docEmphasis">p_hex</i>,
    which parses a hexadecimal escape sequence. Here's the code in normal
    <tt class="calibre34">do</tt>-notation style:</p><pre class="calibre39">-- file: ch16/FormApp.hs
p_hex :: CharParser () Char
p_hex = do
  char '%'
  a &lt;- hexDigit
  b &lt;- hexDigit
  let ((d, _):_) = readHex [a,b]
  return . toEnum $ d</pre><br class="calibre48"/>
<a name="x_qj" class="calibre27" id="x_qj"></a><p class="docText">And here's our applicative version:</p><pre class="calibre39">-- file: ch16/FormApp.hs
a_hex = hexify &lt;$&gt; (char '%' *&gt; hexDigit) &lt;*&gt; hexDigit
    where hexify a b = toEnum . fst . head . readHex $ [a,b]</pre><br class="calibre48"/>
<a name="x_rj" class="calibre27" id="x_rj"></a><p class="docText">Although the individual parsers are mostly untouched, the
    combinators that we're gluing them together with have changed. The only
    familiar one is <i class="docEmphasis">(&lt;$&gt;)</i>,
    which<a name="I_indexterm16_d1e37139" class="calibre27" id="I_indexterm16_d1e37139"></a> we already know is a synonym for <i class="docEmphasis">fmap</i>.</p><a name="x_sj" class="calibre27" id="x_sj"></a><p class="docText">From our definition of Applicative, we know
    that <i class="docEmphasis">(&lt;*&gt;)</i> is<a name="I_indexterm16_d1e37154" class="calibre27" id="I_indexterm16_d1e37154"></a> <i class="docEmphasis">ap</i>.</p><a name="x_tj" class="calibre27" id="x_tj"></a><p class="docText">The remaining unfamiliar combinator is <i class="docEmphasis">(*&gt;)</i>, which applies<a name="I_indexterm16_d1e37166" class="calibre27" id="I_indexterm16_d1e37166"></a> its first argument, throws away its result, and then
    applies the second and returns its result. In other words, it's <a name="I_indexterm16_d1e37170" class="calibre27" id="I_indexterm16_d1e37170"></a>similar to <i class="docEmphasis">(&gt;&gt;)</i>.</p><p class="calibre37"><table border="0" cellspacing="0" cellpadding="1" width="90%" class="calibre41"><tr class="calibre16"><td class="v3"><table width="100%" border="0" cellspacing="0" cellpadding="6" class="calibre42"><tr class="calibre16"><td width="60" valign="top" class="v3"><img src="tip_yellow.gif" alt="" class="calibre43"/></td><td valign="top" class="v3"><p class="docNormalTitle">A handy tip about angle brackets</p><a name="x_uj" class="calibre27" id="x_uj"></a><p class="docText">Before we continue, here's a useful aid for remembering
      what all the angle brackets are for in the combinators from
      <tt class="calibre34">Control.Applicative</tt>: if there's an angle bracket pointing
      to a side, the result from that side should be used.</p><a name="x_vj" class="calibre27" id="x_vj"></a><p class="docText">For example, <i class="docEmphasis">(*&gt;)</i> returns the result on its right;
      <i class="docEmphasis">(&lt;*&gt;)</i> returns results from
      both sides; and <i class="docEmphasis">(&lt;*)</i>—which we
      have not seen yet—returns the result on its left.</p></td></tr></table></td></tr></table></p><br class="calibre48"/><a name="x_wj" class="calibre27" id="x_wj"></a><p class="docText">Although the concepts here should mostly be familiar from
    our earlier coverage of functors and monads, we'll walk through this
    function to explain what's happening. First, to get a grip on our types,
    we'll hoist <i class="docEmphasis">hexify</i> to the top level
    and give it a signature:</p><pre class="calibre39">-- file: ch16/FormApp.hs
hexify :: Char -&gt; Char -&gt; Char
hexify a b = toEnum . fst . head . readHex $ [a,b]</pre><br class="calibre48"/>
<a name="x_xj" class="calibre27" id="x_xj"></a><p class="docText">Parsec's <i class="docEmphasis">hexDigit</i>
    parser parses a single hexadecimal digit:</p><pre class="calibre39">ghci&gt; <b class="calibre40">:type hexDigit</b>
hexDigit :: CharParser st Char
</pre><a name="x_yj" class="calibre27" id="x_yj"></a><p class="docText">Therefore, <tt class="calibre34">char '%' *&gt; hexDigit</tt> has the
    same type, since <i class="docEmphasis">(*&gt;)</i> returns the
    result on its right. (The CharParser type is nothing more
    than a synonym for GenParser Char.)</p><pre class="calibre39">ghci&gt; <b class="calibre40">:type char '%' *&gt; hexDigit</b>
char '%' *&gt; hexDigit :: GenParser Char st Char
</pre><a name="x_zj" class="calibre27" id="x_zj"></a><p class="docText">The expression <tt class="calibre34">hexify &lt;$&gt; (char '%' *&gt;
    hexDigit)</tt> is a parser that matches a <tt class="calibre34">%</tt> character
    followed by <tt class="calibre34">hexDigit</tt>, and whose result is a function:</p><pre class="calibre39">ghci&gt; <b class="calibre40">:type hexify &lt;$&gt; (char '%' *&gt; hexDigit)</b>
hexify &lt;$&gt; (char '%' *&gt; hexDigit) :: GenParser Char st (Char -&gt; Char)
</pre><a name="x_Ak" class="calibre27" id="x_Ak"></a><p class="docText">Finally, <i class="docEmphasis">(&lt;*&gt;)</i>
    applies the parser on its left, and then the parser on its right, and then
    applies the function that's the result of the left parse to the value
    that's the result of the right.</p><a name="x_Bk" class="calibre27" id="x_Bk"></a><p class="docText">If you've been able to follow this, you understand the
    <i class="docEmphasis">(&lt;*&gt;)</i> and <i class="docEmphasis">ap</i> combinators—<i class="docEmphasis">(&lt;*&gt;)</i> is plain old <i class="docEmphasis">($)</i> lifted to applicative functors, and
    <i class="docEmphasis">ap</i> is the same thing lifted to
    monads:</p><pre class="calibre39">ghci&gt; <b class="calibre40">:type ($)</b>
($) :: (a -&gt; b) -&gt; a -&gt; b
ghci&gt; <b class="calibre40">:type (&lt;*&gt;)</b>
(&lt;*&gt;) :: (Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
ghci&gt; <b class="calibre40">:type ap</b>
ap :: (Monad m) =&gt; m (a -&gt; b) -&gt; m a -&gt; m b</pre><a name="x_Ck" class="calibre27" id="x_Ck"></a><p class="docText">Next, we'll consider the <i class="docEmphasis">p_char</i> parser:</p><pre class="calibre39">-- file: ch16/FormApp.hs
p_char :: CharParser () Char
p_char = oneOf urlBaseChars
     &lt;|&gt; (char '+' &gt;&gt; return ' ')
     &lt;|&gt; p_hex

urlBaseChars = ['a'..'z']++['A'..'Z']++['0'..'9']++"$-_.!*'(),"</pre><br class="calibre48"/>
<a name="x_Dk" class="calibre27" id="x_Dk"></a><p class="docText">This remains almost the same in an applicative style, save
    for one piece of convenient notation:</p><pre class="calibre39">-- file: ch16/FormApp.hs
a_char = oneOf urlBaseChars
     &lt;|&gt; (' ' &lt;$ char '+')
     &lt;|&gt; a_hex</pre><br class="calibre48"/>
<a name="x_Ek" class="calibre27" id="x_Ek"></a><p class="docText">Here, the <i class="docEmphasis">(&lt;$)</i>
    combinator uses the value on the left if the parser on the right
    succeeds.</p><a name="x_Fk" class="calibre27" id="x_Fk"></a><p class="docText">Finally, the equivalent of <i class="docEmphasis">p_pair_app1</i> is almost identical:</p><pre class="calibre39">-- file: ch16/FormParse.hs
p_pair_app1 =
    liftM2 (,) (many1 p_char) (optionMaybe (char '=' &gt;&gt; many p_char))</pre><br class="calibre48"/>
<a name="x_Gk" class="calibre27" id="x_Gk"></a><p class="docText">All we've changed is the combinator we use for lifting—the
    <i class="docEmphasis">liftA</i> functions act in the same way
    as their <i class="docEmphasis">liftM</i> cousins:</p><pre class="calibre39">-- file: ch16/FormApp.hs
a_pair :: CharParser () (String, Maybe String)
a_pair = liftA2 (,) (many1 a_char) (optionMaybe (char '=' *&gt; many a_char))</pre><br class="calibre48"/>
<a href="21061538.html" class="calibre2"><img src="pixel.gif" alt="" border="0" class="calibre31"/></a><ul class="calibre18"></ul></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="middle" class="v3" height="5">
                        <img src="pixel.gif" alt="" border="0" class="calibre32"/>
                      </td>
                    </tr>
                    <tr class="calibre16">
                      <td valign="middle" class="v3">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="sfbody1">
                          <tr class="calibre16">
                            <td class="v5"><span class="calibre33"> </span>
                   
                  <span class="calibre33">   </span>
             <span class="calibre33"> </span></td>
                          </tr>
                        </table>
                      </td>
                      <td class="v3"/>
                      <td valign="middle" class="v6"> 
           
          <span class="calibre33"><a target="_self" href="I_sect116_d1e37048.html" title="Previous section" class="calibre2"><img border="0" src="btn_prev.gif" alt="Previous section" id="btn_prev" class="calibre17"/></a></span>
				
				 
				
				<span class="calibre33"><a target="_self" href="I_sect116_d1e37324.html" title="Next section" class="calibre2"><img border="0" src="btn_next.gif" alt="Next section" id="btn_next" class="calibre17"/></a></span></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="2" class="sfbody1">
                    <tr class="calibre16">
                      <td valign="top" class="v6">
                        <span class="calibre33"></span>
                      </td>
                    </tr>
                  </table>
                </div>
                <!--IP User 2-->
              </td>
            </tr>
          </table>
        </td>
        <td class="calibre7">
                         
                      </td>
      </tr>
      <tr class="calibre6">
        <td colspan="3" valign="bottom" class="calibre7">
          <br class="calibre20"/>
          <p class="v4"></p>
          <br class="calibre20"/>
        </td>
      </tr>
    </table>
  </div>

{% endraw %}

