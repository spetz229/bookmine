---
layout: page
title: "JavaScript Web Applications"
prev: OEBPS/ch07s08.html
next: OEBPS/ch08.html
book_path: books/alex-maccaw-javascript-web-applications-otx--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="jQuery Drag and Drop Uploader"><div class="book"><div class="book"><div class="book"><h1 class="title1"><a id="I_sect17_d1e7282" class="calibre1"></a>jQuery Drag and Drop Uploader</h1></div></div></div><p class="calibre3"><a id="index-283A778QF0P" class="calibre1"></a><a id="index-874M030JI4G" class="calibre1"></a><a id="index-688F146JR0F" class="calibre1"></a><a id="index-110U658VS6S" class="calibre1"></a>So, let’s put all that knowledge into practice by building a
    drag-and-drop file uploader. We’re going to need several libraries:
    <em class="calibre4">jquery.js</em> for the backbone,
    <em class="calibre4">jquery.ui.js</em> for the progress bar,
    <em class="calibre4">jquery.drop.js</em> to abstract the drag-and-drop APIs,
    and <em class="calibre4">jquery.upload.js</em> for the Ajax upload. All our
    logic will go inside <code class="literal">jQuery.ready()</code>, so
    it will be run when the DOM is ready:</p><pre class="screen">//= require &lt;jquery&gt;
//= require &lt;jquery.ui&gt;
//= require &lt;jquery.drop&gt;
//= require &lt;jquery.upload&gt;

jQuery.ready(function($){
  /* ... */
});</pre><div class="book" title="Creating a Drop Area"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="id2926470" class="calibre12"></a>Creating a Drop Area</h2></div></div></div><p class="calibre3"><a id="I_indexterm7_d1e7327" class="calibre1"></a>We want users to be able to drag and drop files onto the
      <code class="literal">#drop</code> element, so let’s turn it into
      a drop area. We need to bind to the <span class="calibre1"><em class="calibre4">drop</em></span>
      event,<a id="I_indexterm7_d1e7337" class="calibre1"></a><a id="I_indexterm7_d1e7340" class="calibre1"></a> canceling it and retrieving any dropped files, which are
      then passed to the <code class="literal">uploadFile()</code>
      function:<a id="I_indexterm7_d1e7350" class="calibre1"></a><a id="I_indexterm7_d1e7355" class="calibre1"></a></p><pre class="screen">var view = $("#drop");
view.dropArea();

view.bind("drop", function(e){ 
  e.stopPropagation();
  e.preventDefault();

  var files = e.originalEvent.dataTransfer.files;
  for ( var i = 0; i &lt; files.length; i++)
    uploadFile(files[i]);

  return false;
});</pre></div><div class="book" title="Uploading the File"><div class="book"><div class="book"><div class="book"><h2 class="title3"><a id="id2926554" class="calibre12"></a>Uploading the File</h2></div></div></div><p class="calibre3">And now for the <code class="literal">uploadFile()</code>
      function—where the magic happens. We’re going use the <code class="literal">$.upload()</code> function in jquery.upload.js to
      send an Ajax upload request to the server. We’ll listen to progress
      events on the request and update a jQuery UI progress bar. Once the
      upload is complete, we’ll notify the user and remove the element:</p><pre class="screen">var uploadFile = function(file){
  var element = $("&lt;div /&gt;");
  element.text(file.fileName);

  var bar = $("&lt;div /&gt;");
  element.append(bar);
  $("#progress").append(element);

  var onProgress = function(e){
    var per = Math.round((e.position / e.total) * 100);
    bar.progressbar({value: per});
  };

  var onSuccess = function(){
    element.text("Complete");
    element.delay(1000).fade();
  };

  $.upload("/uploads", file, {upload: {progress: onProgress}, success: onSuccess});
};</pre><p class="calibre3">That’s pretty straightforward! To see the full example, check out
      <span class="calibre1"><em class="calibre4">assets/ch07/dragdropupload.html</em></span>.<a id="I_indexterm7_d1e7378" class="calibre1"></a><a id="I_indexterm7_d1e7379" class="calibre1"></a><a id="I_indexterm7_d1e7380" class="calibre1"></a><a id="I_indexterm7_d1e7381" class="calibre1"></a><a id="I_indexterm7_d1e7382" class="calibre1"></a></p></div></div></div>

{% endraw %}

