---
layout: page
title: "JavaScript Web Applications"
prev: OEBPS/ch02s08.html
next: OEBPS/ch02s10.html
book_path: books/alex-maccaw-javascript-web-applications-otx--_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Custom Events and jQuery Plug-Ins"><div class="book"><div class="book"><div class="book"><h1 class="title1"><a id="I_sect12_d1e2338" class="calibre1"></a>Custom Events and jQuery Plug-Ins</h1></div></div></div><p class="calibre3"><a id="I_indexterm2_d1e2342" class="calibre1"></a><a id="I_indexterm2_d1e2347" class="calibre1"></a>Custom events, often used to great effect in jQuery
    plug-ins, are a great way to architect any piece of logic that interacts
    with the DOM. If you’re unfamiliar with jQuery plug-ins, skip ahead to
    <a class="ulink" href="apb.html" title="Appendix B. CSS Extensions">Appendix B</a>, which includes a jQuery
    primer.</p><p class="calibre3">If you’re adding a piece of functionality to your application,
    always consider whether it could be abstracted and split out in a plug-in.
    This will help with decoupling and could leave you with a reusable
    library.</p><p class="calibre3">For example, let’s look at a simple jQuery plug-in for tabs. We’re
    going to have a <code class="literal">ul</code> list that will
    respond to click events. When the user clicks on a list item, we’ll add an
    <span class="calibre1"><em class="calibre4">active</em></span> class to it and remove the
    <span class="calibre1"><em class="calibre4">active</em></span> class from the other list items:</p><pre class="screen">&lt;ul id="tabs"&gt;
  &lt;li data-tab="users"&gt;Users&lt;/li&gt;
  &lt;li data-tab="groups"&gt;Groups&lt;/li&gt;
&lt;/ul&gt;

&lt;div id="tabsContent"&gt;
  &lt;div data-tab="users"&gt; ... &lt;/div&gt;
  &lt;div data-tab="groups"&gt; ... &lt;/div&gt;
&lt;/div&gt;</pre><p class="calibre3">In addition, we have a <code class="literal">tabsContent</code> div that contains the actual
    contents of the tabs. We’ll also be adding and removing the
    <span class="calibre1"><em class="calibre4">active</em></span> class from the div’s children, depending on
    which tab was clicked. The actual displaying and hiding of the tabs will
    be done by CSS—our plug-in just toggles the <span class="calibre1"><em class="calibre4">active</em></span>
    class:</p><pre class="screen">jQuery.fn.tabs = function(control){
  var element = $(this);
  control = $(control);

  element.find("li").bind("click", function(){
    // Add/remove active class from the list-item
    element.find("li").removeClass("active");
    $(this).addClass("active");

    // Add/remove active class from tabContent
    var tabName = $(this).attr("data-tab");
    control.find("&gt;[data-tab]").removeClass("active");
    control.find("&gt;[data-tab='" + tabName + "']").addClass("active");
  });

  // Activate first tab
  element.find("li:first").addClass("active");    

  // Return 'this' to enable chaining
  return this;
};</pre><p class="calibre3">The plug-in is on jQuery’s <code class="literal">prototype</code>, so it can be called on jQuery
    instances:</p><pre class="screen">$("ul#tabs").tabs("#tabContent");</pre><p class="calibre3">What’s wrong with the plug-in so far? Well, we’re adding a
    <span class="calibre1"><em class="calibre4">click</em></span> event handler onto all the list items, which is
    our first mistake. Instead, we should be using the <code class="literal">delegate()</code> function covered earlier in this
    chapter. Also, that click handler is massive, so it’s difficult to see
    what’s going on. Furthermore, if another developer wanted to extend our
    plug-in, he’d probably have to rewrite it.</p><p class="calibre3">Let’s see how we can use custom events to clean up our code. We’ll
    fire a <span class="calibre1"><em class="calibre4">change.tabs</em></span> event when a tab is clicked, and
    bind several handlers to change the <span class="calibre1"><em class="calibre4">active</em></span> class as
    appropriate:</p><pre class="screen">jQuery.fn.tabs = function(control){
  var element = $(this);
  control = $(control);

  element.delegate("li", "click", function(){
    // Retrieve tab name
    var tabName = $(this).attr("data-tab");

    // Fire custom event on tab click
    element.trigger("change.tabs", tabName);
  });

  // Bind to custom event
  element.bind("change.tabs", function(e, tabName){
    element.find("li").removeClass("active");
    element.find("&gt;[data-tab='" + tabName + "']").addClass("active");
  });

  element.bind("change.tabs", function(e, tabName){
    control.find("&gt;[data-tab]").removeClass("active");
    control.find("&gt;[data-tab='" + tabName + "']").addClass("active");
  });

  // Activate first tab
  var firstName = element.find("li:first").attr("data-tab");
  element.trigger("change.tabs", firstName);

  return this;
};</pre><p class="calibre3">See how much cleaner the code is with custom event handlers? It
    means we can split up the tab change handlers, and it has the added
    advantage of making the plug-in much easier to extend. For example, we can
    now programmatically change tabs by firing our
    <span class="calibre1"><em class="calibre4">change.tabs</em></span> event on the observed list:</p><pre class="screen">$("#tabs").trigger("change.tabs", "users");</pre><p class="calibre3">We could also tie up the tabs with the window’s hash, adding back
    button support:</p><pre class="screen">$("#tabs").bind("change.tabs", function(e, tabName){
  window.location.hash = tabName;
});

$(window).bind("hashchange", function(){
  var tabName = window.location.hash.slice(1);
  $("#tabs").trigger("change.tabs", tabName);
});</pre><p class="calibre3">The fact that we’re using custom events gives other developers a lot
    of scope when extending our work.<a id="I_indexterm2_d1e2422" class="calibre1"></a></p></div></div>

{% endraw %}

