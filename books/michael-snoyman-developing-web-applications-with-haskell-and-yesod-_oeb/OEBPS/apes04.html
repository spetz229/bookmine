---
layout: page
title: "Developing Web Applications with Haskell and Yesod"
prev: OEBPS/apes03.html
next: OEBPS/apes05.html
book_path: books/michael-snoyman-developing-web-applications-with-haskell-and-yesod-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Manager"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="I_sect1_d1e11158" class="calibre1"></a>Manager</h1></div></div></div><p class="calibre7"></p><p class="calibre7">The connection manager allows you to reuse connections. When making multiple queries to a
   single server (e.g., accessing Amazon S3), this can be critical for creating efficient code. A
   manager will keep track of multiple connections to a given server (taking into account port and
   SSL as well), automatically reaping unused connections as needed. When you make a request,
    <code class="literal">http-conduit</code> first tries to check out an existing connection. When you’re
   finished with the connection (if the server allows keep-alive), the connection is returned to the
   manager. If anything goes wrong, the connection is closed.</p><p class="calibre7">To keep our code exception-safe, we use the <code class="literal">ResourceT</code> monad transformer. All
   this means for you is that your code needs to be wrapped inside a call to
    <code class="literal">runResourceT</code>, either implicitly or explicitly, and that code inside that block
   will need to <code class="literal">liftIO</code> to perform normal IO actions.</p><p class="calibre7">There are two ways you can get ahold of a manager. <code class="literal">newManager</code> will return a
   manager that will not be automatically closed (you can use <code class="literal">closeManager</code> to do so
   manually), while <code class="literal">withManager</code> will start a new <code class="literal">ResourceT</code> block,
   allow you to use the manager, and then automatically close the <code class="literal">ResourceT</code> when
   you’re done. If you want to use a <code class="literal">ResourceT</code> for an entire application, and have
   no need to close it, you should probably use <code class="literal">newManager</code>.</p><p class="calibre7">One other thing to point out: you obviously don’t want to create a new manager for each and
   every request; that would defeat the whole purpose. You should create your
    <code class="literal">Manager</code> early and then share it.</p></div></div>

{% endraw %}

