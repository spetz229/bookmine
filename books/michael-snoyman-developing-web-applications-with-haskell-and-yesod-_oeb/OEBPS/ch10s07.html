---
layout: page
title: "Developing Web Applications with Haskell and Yesod"
prev: OEBPS/ch10s06.html
next: OEBPS/ch10s08.html
book_path: books/michael-snoyman-developing-web-applications-with-haskell-and-yesod-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Attributes"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="I_sect110_d1e5649" class="calibre1"></a>Attributes</h1></div></div></div><p class="calibre7">So far, we have seen a basic syntax for our <code class="literal">persist</code> blocks: a line
            for the name of our entities, and then an indented line for each field with two words:
            the name of the field and the data type of the field. Persistent handles more than this:
            you can assign an arbitrary list of attributes after the first two words on a line.</p><p class="calibre7">Suppose we want to have a <code class="literal">Person</code> entity with an (optional) age and
            the timestamp of when he/she was added to the system. For entities already in the
            database, we want to just use the current date-time for that timestamp.</p><a id="I_programlisting10_d1e5662" class="firstname"></a><pre class="programlistinghaskell"><code class="cm">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell,</code>
<code class="cm">             OverloadedStrings, GADTs, FlexibleContexts #-}</code>
<code class="kr">import</code> <code class="nn">Database.Persist</code>
<code class="kr">import</code> <code class="nn">Database.Persist.Sqlite</code>
<code class="kr">import</code> <code class="nn">Database.Persist.TH</code>
<code class="kr">import</code> <code class="nn">Data.Time</code>
<code class="kr">import</code> <code class="nn">Control.Monad.IO.Class</code>

<code class="nf">share</code> <code class="p">[</code><code class="n">mkPersist</code> <code class="n">sqlSettings</code><code class="p">,</code> <code class="n">mkMigrate</code> <code class="s">"migrateAll"</code><code class="p">]</code> <code class="p">[</code><code class="n">persist</code><code class="o">|</code>
<code class="kt">Person</code>
    <code class="n">name</code> <code class="kt">String</code>
    <code class="n">age</code> <code class="kt">Int</code> <code class="kt">Maybe</code>
    <code class="n">created</code> <code class="kt">UTCTime</code> <code class="kr">default</code><code class="ow">=</code><code class="n">now</code><code class="nb">()</code>
<code class="o">|</code><code class="p">]</code>

<code class="nf">main</code> <code class="ow">=</code> <code class="n">withSqliteConn</code> <code class="s">":memory:"</code> <code class="o">$</code> <code class="n">runSqlConn</code> <code class="o">$</code> <code class="kr">do</code>
    <code class="n">time</code> <code class="ow">&lt;-</code> <code class="n">liftIO</code> <code class="n">getCurrentTime</code>
    <code class="n">runMigration</code> <code class="n">migrateAll</code>
    <code class="n">insert</code> <code class="o">$</code> <code class="kt">Person</code> <code class="s">"Michael"</code> <code class="p">(</code><code class="kt">Just</code> <code class="mi">26</code><code class="p">)</code> <code class="n">time</code>
    <code class="n">insert</code> <code class="o">$</code> <code class="kt">Person</code> <code class="s">"Greg"</code> <code class="kt">Nothing</code> <code class="n">time</code>
</pre><p class="calibre7"><code class="literal">Maybe</code> is a built-in, single-word attribute. It makes
      the field optional. In Haskell, this means it is wrapped in a <code class="literal">Maybe</code>. In SQL, it makes the column nullable.</p><p class="calibre7">The <code class="literal">default</code> attribute is backend specific, and uses
      whatever syntax is understood by the database. In this case, it uses the database’s
      built-in <code class="literal">now()</code> function. Suppose that we now want to add a
      field for a person’s favorite programming language:</p><a id="I_programlisting10_d1e5679" class="firstname"></a><pre class="programlistinghaskell"><code class="cm">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell,</code>
<code class="cm">             OverloadedStrings, GADTs, FlexibleContexts #-}</code>
<code class="kr">import</code> <code class="nn">Database.Persist</code>
<code class="kr">import</code> <code class="nn">Database.Persist.Sqlite</code>
<code class="kr">import</code> <code class="nn">Database.Persist.TH</code>
<code class="kr">import</code> <code class="nn">Data.Time</code>

<code class="nf">share</code> <code class="p">[</code><code class="n">mkPersist</code> <code class="n">sqlSettings</code><code class="p">,</code> <code class="n">mkMigrate</code> <code class="s">"migrateAll"</code><code class="p">]</code> <code class="p">[</code><code class="n">persist</code><code class="o">|</code>
<code class="kt">Person</code>
    <code class="n">name</code> <code class="kt">String</code>
    <code class="n">age</code> <code class="kt">Int</code> <code class="kt">Maybe</code>
    <code class="n">created</code> <code class="kt">UTCTime</code> <code class="kr">default</code><code class="ow">=</code><code class="n">now</code><code class="nb">()</code>
    <code class="n">language</code> <code class="kt">String</code> <code class="kr">default</code><code class="ow">=</code><code class="s">'Haskell'</code>
<code class="o">|</code><code class="p">]</code>

<code class="nf">main</code> <code class="ow">=</code> <code class="n">withSqliteConn</code> <code class="s">":memory:"</code> <code class="o">$</code> <code class="n">runSqlConn</code> <code class="o">$</code> <code class="kr">do</code>
    <code class="n">runMigration</code> <code class="n">migrateAll</code>
</pre><div class="tip" title="Note"><h3 class="title3">Note</h3><p class="calibre7">The <code class="literal">default</code> attribute has absolutely no impact on the Haskell code itself; you still need to fill in all values. This will only affect the database schema and automatic migrations.</p></div><p class="calibre7">We need to surround the string with single quotes so that the database can properly
      interpret it. Finally, Persistent can use double quotes for containing white space, so if we
      want to set someone’s default home country to be El Salvador:</p><a id="I_programlisting10_d1e5689" class="firstname"></a><pre class="programlistinghaskell"><code class="cm">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell,</code>
<code class="cm">             OverloadedStrings, GADTs, FlexibleContexts #-}</code>
<code class="kr">import</code> <code class="nn">Database.Persist</code>
<code class="kr">import</code> <code class="nn">Database.Persist.Sqlite</code>
<code class="kr">import</code> <code class="nn">Database.Persist.TH</code>
<code class="kr">import</code> <code class="nn">Data.Time</code>

<code class="nf">share</code> <code class="p">[</code><code class="n">mkPersist</code> <code class="n">sqlSettings</code><code class="p">,</code> <code class="n">mkMigrate</code> <code class="s">"migrateAll"</code><code class="p">]</code> <code class="p">[</code><code class="n">persist</code><code class="o">|</code>
<code class="kt">Person</code>
    <code class="n">name</code> <code class="kt">String</code>
    <code class="n">age</code> <code class="kt">Int</code> <code class="kt">Maybe</code>
    <code class="n">created</code> <code class="kt">UTCTime</code> <code class="kr">default</code><code class="ow">=</code><code class="n">now</code><code class="nb">()</code>
    <code class="n">language</code> <code class="kt">String</code> <code class="kr">default</code><code class="ow">=</code><code class="s">'Haskell'</code>
    <code class="n">country</code> <code class="kt">String</code> <code class="s">"default='El Salvador'"</code>
<code class="o">|</code><code class="p">]</code>

<code class="nf">main</code> <code class="ow">=</code> <code class="n">withSqliteConn</code> <code class="s">":memory:"</code> <code class="o">$</code> <code class="n">runSqlConn</code> <code class="o">$</code> <code class="kr">do</code>
    <code class="n">runMigration</code> <code class="n">migrateAll</code>
</pre><p class="calibre7">One last trick you can do with attributes is to specify the names to be used for
            the SQL tables and columns. This can be convenient when interacting with existing
            databases.</p><a id="I_programlisting10_d1e5694" class="firstname"></a><pre class="programlistinghaskell"><code class="nf">share</code> <code class="p">[</code><code class="n">mkPersist</code> <code class="n">sqlSettings</code><code class="p">,</code> <code class="n">mkMigrate</code> <code class="s">"migrateAll"</code><code class="p">]</code> <code class="p">[</code><code class="n">persist</code><code class="o">|</code>
<code class="kt">Person</code> <code class="n">sql</code><code class="ow">=</code><code class="n">the</code><code class="o">-</code><code class="n">person</code><code class="o">-</code><code class="n">table</code>
    <code class="n">firstName</code> <code class="kt">String</code> <code class="n">sql</code><code class="ow">=</code><code class="n">first_name</code>
    <code class="n">lastName</code> <code class="kt">String</code> <code class="n">sql</code><code class="ow">=</code><code class="n">fldLastName</code>
    <code class="n">age</code> <code class="kt">Int</code> <code class="kt">Gt</code> <code class="kt">Desc</code> <code class="s">"sql=The Age of the Person"</code>
    <code class="kt">UniqueName</code> <code class="n">firstName</code> <code class="n">lastName</code>
<code class="o">|</code><code class="p">]</code>
</pre></div></div>

{% endraw %}

