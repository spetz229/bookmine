---
layout: page
title: "Developing Web Applications with Haskell and Yesod"
prev: OEBPS/ch08s09.html
next: OEBPS/ch08s11.html
book_path: books/michael-snoyman-developing-web-applications-with-haskell-and-yesod-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Monadic Forms"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="I_sect18_d1e4337" class="calibre1"></a>Monadic Forms</h1></div></div></div><p class="calibre7">Oftentimes, a simple form layout is adequate, and applicative forms excel at this
      approach. Sometimes, however, you’ll want to have a more customized look to your form.</p><div class="figure"><a id="monadic-x-4" class="firstname"></a><div class="book"><div class="book"><a id="I_mediaobject8_d1e4348" class="firstname"></a><img src="httpatomoreillycomsourceoreillyimages1137531.png" alt="A non-standard form layout" class="calibre5"/></div></div><p class="title7">Figure 8-1. A non-standard form layout</p></div><p class="calibre7">For these use cases, monadic forms fit the bill. They are a bit more verbose
            than their applicative cousins, but this verbosity allows you to have complete control
            over what the form will look like. In order to generate the form above, we could code
            something like this.</p><a id="I_programlisting8_d1e4355" class="firstname"></a><pre class="programlistinghaskell"><code class="cm">{-# LANGUAGE OverloadedStrings, TypeFamilies, QuasiQuotes,</code>
<code class="cm">             TemplateHaskell, MultiParamTypeClasses #-}</code>
<code class="kr">import</code> <code class="nn">Yesod</code>
<code class="kr">import</code> <code class="nn">Control.Applicative</code>
<code class="kr">import</code> <code class="nn">Data.Text</code> <code class="p">(</code><code class="kt">Text</code><code class="p">)</code>

<code class="kr">data</code> <code class="kt">MFormExample</code> <code class="ow">=</code> <code class="kt">MFormExample</code>

<code class="nf">mkYesod</code> <code class="s">"MFormExample"</code> <code class="p">[</code><code class="n">parseRoutes</code><code class="o">|</code>
<code class="o">/</code> <code class="kt">RootR</code> <code class="kt">GET</code>
<code class="o">|</code><code class="p">]</code>

<code class="kr">instance</code> <code class="kt">Yesod</code> <code class="kt">MFormExample</code>

<code class="kr">instance</code> <code class="kt">RenderMessage</code> <code class="kt">MFormExample</code> <code class="kt">FormMessage</code> <code class="kr">where</code>
    <code class="n">renderMessage</code> <code class="kr">_</code> <code class="kr">_</code> <code class="ow">=</code> <code class="n">defaultFormMessage</code>

<code class="kr">data</code> <code class="kt">Person</code> <code class="ow">=</code> <code class="kt">Person</code> <code class="p">{</code> <code class="n">personName</code> <code class="ow">::</code> <code class="kt">Text</code><code class="p">,</code> <code class="n">personAge</code> <code class="ow">::</code> <code class="kt">Int</code> <code class="p">}</code>
    <code class="kr">deriving</code> <code class="kt">Show</code>

<code class="nf">personForm</code> <code class="ow">::</code> <code class="kt">Html</code> <code class="ow">-&gt;</code> <code class="kt">MForm</code> <code class="kt">MFormExample</code> <code class="kt">MFormExample</code> <code class="p">(</code><code class="kt">FormResult</code> <code class="kt">Person</code><code class="p">,</code> <code class="kt">Widget</code><code class="p">)</code>
<code class="nf">personForm</code> <code class="n">extra</code> <code class="ow">=</code> <code class="kr">do</code>
    <code class="p">(</code><code class="n">nameRes</code><code class="p">,</code> <code class="n">nameView</code><code class="p">)</code> <code class="ow">&lt;-</code> <code class="n">mreq</code> <code class="n">textField</code> <code class="s">"this is not used"</code> <code class="kt">Nothing</code>
    <code class="p">(</code><code class="n">ageRes</code><code class="p">,</code> <code class="n">ageView</code><code class="p">)</code> <code class="ow">&lt;-</code> <code class="n">mreq</code> <code class="n">intField</code> <code class="s">"neither is this"</code> <code class="kt">Nothing</code>
    <code class="kr">let</code> <code class="n">personRes</code> <code class="ow">=</code> <code class="kt">Person</code> <code class="o">&lt;$&gt;</code> <code class="n">nameRes</code> <code class="o">&lt;*&gt;</code> <code class="n">ageRes</code>
    <code class="kr">let</code> <code class="n">widget</code> <code class="ow">=</code> <code class="kr">do</code>
            <code class="n">toWidget</code> <code class="p">[</code><code class="n">lucius</code><code class="o">|</code>
<code class="o">##</code><code class="p">{</code><code class="n">fvId</code> <code class="n">ageView</code><code class="p">}</code> <code class="p">{</code>
    <code class="n">width</code><code class="kt">:</code> <code class="mi">3</code><code class="n">em</code><code class="p">;</code>
<code class="p">}</code>
<code class="o">|</code><code class="p">]</code>
            <code class="p">[</code><code class="n">whamlet</code><code class="o">|</code>
<code class="o">#</code><code class="p">{</code><code class="n">extra</code><code class="p">}</code>
<code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code>
    <code class="kt">Hello</code><code class="p">,</code> <code class="n">my</code> <code class="n">name</code> <code class="n">is</code> <code class="o">#</code>
    <code class="o">^</code><code class="p">{</code><code class="n">fvInput</code> <code class="n">nameView</code><code class="p">}</code>
    <code class="nf">\</code> <code class="n">and</code> <code class="kt">I</code> <code class="n">am</code> <code class="o">#</code>
    <code class="o">^</code><code class="p">{</code><code class="n">fvInput</code> <code class="n">ageView</code><code class="p">}</code>
    <code class="nf">\</code> <code class="n">years</code> <code class="n">old</code><code class="o">.</code> <code class="o">#</code>
    <code class="o">&lt;</code><code class="n">input</code> <code class="kr">type</code><code class="ow">=</code><code class="n">submit</code> <code class="n">value</code><code class="ow">=</code><code class="s">"Introduce myself"</code><code class="o">&gt;</code>
<code class="o">|</code><code class="p">]</code>
    <code class="n">return</code> <code class="p">(</code><code class="n">personRes</code><code class="p">,</code> <code class="n">widget</code><code class="p">)</code>

<code class="nf">getRootR</code> <code class="ow">::</code> <code class="kt">Handler</code> <code class="kt">RepHtml</code>
<code class="nf">getRootR</code> <code class="ow">=</code> <code class="kr">do</code>
    <code class="p">((</code><code class="n">res</code><code class="p">,</code> <code class="n">widget</code><code class="p">),</code> <code class="n">enctype</code><code class="p">)</code> <code class="ow">&lt;-</code> <code class="n">runFormGet</code> <code class="n">personForm</code>
    <code class="n">defaultLayout</code> <code class="p">[</code><code class="n">whamlet</code><code class="o">|</code>
<code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="kt">Result:</code> <code class="o">#</code><code class="p">{</code><code class="n">show</code> <code class="n">res</code><code class="p">}</code>
<code class="o">&lt;</code><code class="n">form</code> <code class="n">enctype</code><code class="o">=#</code><code class="p">{</code><code class="n">enctype</code><code class="p">}</code><code class="o">&gt;</code>
    <code class="o">^</code><code class="p">{</code><code class="n">widget</code><code class="p">}</code>
<code class="o">|</code><code class="p">]</code>

<code class="nf">main</code> <code class="ow">::</code> <code class="kt">IO</code> <code class="nb">()</code>
<code class="nf">main</code> <code class="ow">=</code> <code class="n">warpDebug</code> <code class="mi">3000</code> <code class="kt">MFormExample</code>
</pre><p class="calibre7">Similar to the applicative <code class="literal">areq</code>, we use <code class="literal">mreq</code> for monadic forms. (And yes, there’s also <code class="literal">mopt</code> for optional fields.) But there’s a big difference: <code class="literal">mreq</code> gives us back a pair of values. Instead of hiding away the
        <code class="function">FieldView</code> value and automatically inserting it into a
      widget, we get the control to insert it as we see fit.</p><p class="calibre7"><code class="literal">FieldView</code> has a number of pieces of information. The most
            important is <code class="literal">fvInput</code>, which is the actual form field. In this example,
            we also use <code class="literal">fvId</code>, which gives us back the HTML <code class="literal">id</code>
            attribute of the input tag. In our example, we use that to specify the width of the
            field.</p><p class="calibre7">You might be wondering what the story is with the “this is not used” and
      “neither is this” values. <code class="literal">mreq</code> takes a <code class="literal">FieldSettings</code> as its second argument. Since <code class="literal">FieldSettings</code> provides an <code class="literal">IsString</code> instance, the strings are essentially expanded by the compiler
      to:<a id="I_programlisting8_d1e4401" class="firstname"></a></p><pre class="programlistinghaskell"><code class="nf">fromString</code> <code class="s">"this is not used"</code> <code class="o">==</code> <code class="kt">FieldSettings</code>
    <code class="p">{</code> <code class="n">fsLabel</code> <code class="ow">=</code> <code class="s">"this is not used"</code>
    <code class="p">,</code> <code class="n">fsTooltip</code> <code class="ow">=</code> <code class="kt">Nothing</code>
    <code class="p">,</code> <code class="n">fsId</code> <code class="ow">=</code> <code class="kt">Nothing</code>
    <code class="p">,</code> <code class="n">fsName</code> <code class="ow">=</code> <code class="kt">Nothing</code>
    <code class="p">,</code> <code class="n">fsClass</code> <code class="ow">=</code> <code class="kt">[]</code>
    <code class="p">}</code>
</pre><p class="calibre7">In
      the case of applicative forms, the <code class="literal">fsLabel</code> and <code class="literal">fsTooltip</code> values are used when constructing your HTML. In the case
      of monadic forms, Yesod does not generate any of the “wrapper” HTML for you, and
      therefore these values are ignored. However, we still keep the <code class="literal">FieldSettings</code> parameter to allow you to override the <code class="literal">id</code> and <code class="literal">name</code> attributes of your fields if
      desired.</p><p class="calibre7">The other interesting bit is the <code class="literal">extra</code> value. <code class="literal">GET</code> forms include an extra field to indicate that they have been
      submitted, and <code class="literal">POST</code> forms include a security token to
      prevent CSRF attacks. If you don’t include this extra hidden field in your form, Yesod will
      not accept it.</p><p class="calibre7">Other than that, things are pretty straightforward. We create our <code class="literal">personRes</code> value by combining together the <code class="literal">nameRes</code> and <code class="literal">ageRes</code> values, and then return a
      tuple of the person and the widget. And in the <code class="literal">getRootR</code>
      function, everything looks just like an applicative form. In fact, you could swap out our
      monadic form with an applicative one and the code would still work.</p></div></div>

{% endraw %}

