---
layout: page
title: "Developing Web Applications with Haskell and Yesod"
prev: OEBPS/ch08s04.html
next: OEBPS/ch08s06.html
book_path: books/michael-snoyman-developing-web-applications-with-haskell-and-yesod-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Create AForms"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="I_sect18_d1e4020" class="calibre1"></a>Create AForms</h1></div></div></div><p class="calibre7">Now that I’ve (hopefully) convinced you that in our synopsis we were really dealing with
      applicative forms, let’s have a look and try to understand how these things get created. Let’s
      take a simple example:</p><a id="I_programlisting8_d1e4025" class="firstname"></a><pre class="programlistinghaskell"><code class="kr">data</code> <code class="kt">Car</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="p">{</code> <code class="n">carModel</code> <code class="ow">::</code> <code class="kt">Text</code>
    <code class="p">,</code> <code class="n">carYear</code> <code class="ow">::</code> <code class="kt">Int</code>
    <code class="p">}</code>
  <code class="kr">deriving</code> <code class="kt">Show</code>

<code class="nf">carAForm</code> <code class="ow">::</code> <code class="kt">AForm</code> <code class="kt">Synopsis</code> <code class="kt">Synopsis</code> <code class="kt">Car</code>
<code class="nf">carAForm</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="o">&lt;$&gt;</code> <code class="n">areq</code> <code class="n">textField</code> <code class="s">"Model"</code> <code class="kt">Nothing</code>
    <code class="o">&lt;*&gt;</code> <code class="n">areq</code> <code class="n">intField</code> <code class="s">"Year"</code> <code class="kt">Nothing</code>

<code class="nf">carForm</code> <code class="ow">::</code> <code class="kt">Html</code> <code class="ow">-&gt;</code> <code class="kt">MForm</code> <code class="kt">Synopsis</code> <code class="kt">Synopsis</code> <code class="p">(</code><code class="kt">FormResult</code> <code class="kt">Car</code><code class="p">,</code> <code class="kt">Widget</code><code class="p">)</code>
<code class="nf">carForm</code> <code class="ow">=</code> <code class="n">renderTable</code> <code class="n">carAForm</code>
</pre><p class="calibre7">Here, we’ve explicitly split up applicative and monadic forms. In <code class="literal">carAForm</code>, we use the <code class="literal">&lt;$&gt;</code> and <code class="literal">&lt;*&gt;</code> operators. This should not be surprising; these are
      almost always used in applicative-style code. And we have one line for each record in our
        <code class="literal">Car</code> data type. Perhaps unsurprisingly, we have a <code class="literal">textField</code> for the <code class="literal">Text</code> record,
      and an <code class="literal">intField</code> for the <code class="literal">Int</code> record.</p><p class="calibre7">Let’s look a bit more closely at the <code class="literal">areq</code> function. Its
      (simplified) type signature is <code class="literal">Field a -&gt; FieldSettings -&gt;
        Maybe a -&gt; AForm a</code>. So that first argument is going to determine the data type
      of this field, how to parse it, and how to render it. The next argument, <code class="literal">FieldSettings</code>, tells us the label, tooltip, name, and ID of the
      field. In this case, we’re using the previously mentioned <code class="literal">IsString</code> instance of <code class="literal">FieldSettings</code>.</p><p class="calibre7">And what’s up with that <code class="literal">Maybe a</code>? It provides the
      optional default value. For example, if we want our form to fill in “2007” as the
      default car year, we would use <code class="literal">areq intField "Year" (Just
        2007)</code>. We can even take this to the next level, and have a form that takes an
      optional parameter giving the default values.</p><div class="example"><a id="create-aforms-x9" class="firstname"></a><p class="title6">Example 8-1. Form with default values</p><div class="book"><pre class="programlistinghaskell"><code class="nf">carAForm</code> <code class="ow">::</code> <code class="kt">Maybe</code> <code class="kt">Car</code> <code class="ow">-&gt;</code> <code class="kt">AForm</code> <code class="kt">Synopsis</code> <code class="kt">Synopsis</code> <code class="kt">Car</code>
<code class="nf">carAForm</code> <code class="n">mcar</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="o">&lt;$&gt;</code> <code class="n">areq</code> <code class="n">textField</code> <code class="s">"Model"</code> <code class="p">(</code><code class="n">carModel</code> <code class="o">&lt;$&gt;</code> <code class="n">mcar</code><code class="p">)</code>
    <code class="o">&lt;*&gt;</code> <code class="n">areq</code> <code class="n">intField</code> <code class="s">"Year"</code> <code class="p">(</code><code class="n">carYear</code> <code class="o">&lt;$&gt;</code> <code class="n">mcar</code><code class="p">)</code>
</pre></div></div><div class="book" title="Optional Fields"><div class="book"><div class="book"><div class="book"><h2 class="title4"><a id="id3083823" class="calibre1"></a>Optional Fields</h2></div></div></div><p class="calibre7">Suppose we wanted to have an optional field (like the car color). All we do instead is
            use the <code class="literal">aopt</code> function.</p><div class="example"><a id="optional-fields-x2" class="firstname"></a><p class="title6">Example 8-2. Optional fields</p><div class="book"><pre class="programlistinghaskell"><code class="kr">data</code> <code class="kt">Car</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="p">{</code> <code class="n">carModel</code> <code class="ow">::</code> <code class="kt">Text</code>
    <code class="p">,</code> <code class="n">carYear</code> <code class="ow">::</code> <code class="kt">Int</code>
    <code class="p">,</code> <code class="n">carColor</code> <code class="ow">::</code> <code class="kt">Maybe</code> <code class="kt">Text</code>
    <code class="p">}</code>
  <code class="kr">deriving</code> <code class="kt">Show</code>

<code class="nf">carAForm</code> <code class="ow">::</code> <code class="kt">AForm</code> <code class="kt">Synopsis</code> <code class="kt">Synopsis</code> <code class="kt">Car</code>
<code class="nf">carAForm</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="o">&lt;$&gt;</code> <code class="n">areq</code> <code class="n">textField</code> <code class="s">"Model"</code> <code class="kt">Nothing</code>
    <code class="o">&lt;*&gt;</code> <code class="n">areq</code> <code class="n">intField</code> <code class="s">"Year"</code> <code class="kt">Nothing</code>
    <code class="o">&lt;*&gt;</code> <code class="n">aopt</code> <code class="n">textField</code> <code class="s">"Color"</code> <code class="kt">Nothing</code>
</pre></div></div><p class="calibre7">And like required fields, the last argument is the optional default value. However,
            this has two layers of Maybe wrapping. This may seem redundant (and it is), but it makes
            it much easier to write code that takes an optional default form parameter, such as in
            the next example.</p><div class="example"><a id="optional-fields-x6" class="firstname"></a><p class="title6">Example 8-3. Default optional fields</p><div class="book"><pre class="programlistinghaskell"><code class="kr">data</code> <code class="kt">Car</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="p">{</code> <code class="n">carModel</code> <code class="ow">::</code> <code class="kt">Text</code>
    <code class="p">,</code> <code class="n">carYear</code> <code class="ow">::</code> <code class="kt">Int</code>
    <code class="p">,</code> <code class="n">carColor</code> <code class="ow">::</code> <code class="kt">Maybe</code> <code class="kt">Text</code>
    <code class="p">}</code>
  <code class="kr">deriving</code> <code class="kt">Show</code>

<code class="nf">carAForm</code> <code class="ow">::</code> <code class="kt">Maybe</code> <code class="kt">Car</code> <code class="ow">-&gt;</code> <code class="kt">AForm</code> <code class="kt">Synopsis</code> <code class="kt">Synopsis</code> <code class="kt">Car</code>
<code class="nf">carAForm</code> <code class="n">mcar</code> <code class="ow">=</code> <code class="kt">Car</code>
    <code class="o">&lt;$&gt;</code> <code class="n">areq</code> <code class="n">textField</code> <code class="s">"Model"</code> <code class="p">(</code><code class="n">carModel</code> <code class="o">&lt;$&gt;</code> <code class="n">mcar</code><code class="p">)</code>
    <code class="o">&lt;*&gt;</code> <code class="n">areq</code> <code class="n">intField</code>  <code class="s">"Year"</code>  <code class="p">(</code><code class="n">carYear</code>  <code class="o">&lt;$&gt;</code> <code class="n">mcar</code><code class="p">)</code>
    <code class="o">&lt;*&gt;</code> <code class="n">aopt</code> <code class="n">textField</code> <code class="s">"Color"</code> <code class="p">(</code><code class="n">carColor</code> <code class="o">&lt;$&gt;</code> <code class="n">mcar</code><code class="p">)</code>

<code class="nf">carForm</code> <code class="ow">::</code> <code class="kt">Html</code> <code class="ow">-&gt;</code> <code class="kt">MForm</code> <code class="kt">Synopsis</code> <code class="kt">Synopsis</code> <code class="p">(</code><code class="kt">FormResult</code> <code class="kt">Car</code><code class="p">,</code> <code class="kt">Widget</code><code class="p">)</code>
<code class="nf">carForm</code> <code class="ow">=</code> <code class="n">renderTable</code> <code class="o">$</code> <code class="n">carAForm</code> <code class="o">$</code> <code class="kt">Just</code> <code class="o">$</code> <code class="kt">Car</code> <code class="s">"Forte"</code> <code class="mi">2010</code> <code class="o">$</code> <code class="kt">Just</code> <code class="s">"gray"</code>
</pre></div></div></div></div></div>

{% endraw %}

