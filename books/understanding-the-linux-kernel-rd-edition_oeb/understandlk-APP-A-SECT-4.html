---
layout: page
title: "Understanding the Linux Kernel, 3rd Edition"
prev: understandlk-APP-A-SECT-3.html
next: understandlk-APP-A-SECT-5.html
book_path: books/understanding-the-linux-kernel-rd-edition_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<a name="understandlk-APP-A-SECT-4"></a>
<h3 class="docSection1Title">A.4. Renaissance: the startup_32( ) Functions</h3><a name="IDX-APP-A-0027"></a>
<a name="IDX-APP-A-0028"></a>
<p class="docText1">There are two different <tt class="calibre25">startup_32( )</tt> functions; the one we refer to here is coded in the <i class="docEmphasis">arch/i386/boot/compressed/head.S</i><a name="IDX-APP-A-0029"></a> 
 file. After <tt class="calibre25">setup( )</tt> terminates, the function has been moved either to physical address <tt class="calibre25">0x00100000</tt> or to physical address <tt class="calibre25">0x00001000</tt>, depending on whether the kernel image was loaded high or low in RAM.</p>
<p class="docText1">This function performs the following operations:</p>
<div class="calibre44"><ol class="docList1" type="1"><li class="calibre12"><div class="calibre45"><p class="docList">Initializes the segmentation registers and a provisional stack.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Clears all bits in the <tt class="calibre25">eflags</tt><a name="IDX-APP-A-0030"></a> 
 register.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Fills the area of uninitialized data of the kernel identified by the <tt class="calibre25">_edata</tt> and <tt class="calibre25">_end</tt> symbols with zeros (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-2-SECT-5.html#understandlk-CHP-2-SECT-5.3">Physical Memory Layout</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-2.html#understandlk-CHP-2">Chapter 2</a>).</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Invokes the <tt class="calibre25">decompress_kernel( )</tt> function to decompress the kernel image. The "Uncompressing Linux..." message is displayed first. After the kernel image is decompressed, the "O K, booting the kernel." message is shown. If the kernel image was loaded low, the decompressed kernel is placed at physical address <tt class="calibre25">0x00100000</tt>. Otherwise, if the kernel image was loaded high, the decompressed kernel is placed in a temporary buffer located after the compressed image. The decompressed image is then moved into its final position, which starts at physical address <tt class="calibre25">0x00100000</tt>.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Jumps to physical address <tt class="calibre25">0x00100000</tt>.</p></div></li></ol></div>
<p class="docText1">The decompressed kernel image begins with another <tt class="calibre25">startup_32( )</tt> function included in the <i class="docEmphasis">arch/i386/kernel/head.S</i><a name="IDX-APP-A-0031"></a> 
 file. Using the same name for both the functions does not create any problems (besides confusing our readers), because both functions are executed by jumping to their initial physical addresses.</p>
<p class="docText1">The second <tt class="calibre25">startup_32( )</tt> function sets up the execution environment for the first Linux process (process 0). The function performs the following operations:</p>
<div class="calibre44"><ol class="docList1" type="1"><li class="calibre12"><div class="calibre45"><p class="docList">Initializes the segmentation registers with their final values.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Fills the bss segment of the kernel (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-20-SECT-1.html#understandlk-CHP-20-SECT-1.4">Program Segments and Process Memory Regions</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-20.html#understandlk-CHP-20">Chapter 20</a>) with zeros.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Initializes the provisional kernel Page Tables contained in <tt class="calibre25">swapper_pg_dir</tt> and <tt class="calibre25">pg0</tt> to identically map the linear addresses to the same physical addresses, as explained in the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-2-SECT-5.html#understandlk-CHP-2-SECT-5.5">Kernel Page Tables</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-2.html#understandlk-CHP-2">Chapter 2</a>.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Stores the address of the Page Global Directory in the <tt class="calibre25">cr3</tt><a name="IDX-APP-A-0032"></a> 
 register, and enables paging by setting the <tt class="calibre25">PG</tt> bit in the <tt class="calibre25">cr0</tt> register.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Sets up the Kernel Mode stack for process 0 (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-3-SECT-4.html#understandlk-CHP-3-SECT-4.2">Kernel Threads</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-3.html#understandlk-CHP-3">Chapter 3</a>).</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Once again, the function clears all bits in the <tt class="calibre25">eflags</tt> register.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Invokes <tt class="calibre25">setup_idt( )</tt> to fill the IDT with null interrupt handlers (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-4-SECT-4.html#understandlk-CHP-4-SECT-4.2">Preliminary Initialization of the IDT</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-4.html#understandlk-CHP-4">Chapter 4</a>).</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Puts the system parameters obtained from the BIOS and the parameters passed to the operating system into the first page frame (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-2-SECT-5.html#understandlk-CHP-2-SECT-5.3">Physical Memory Layout</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-2.html#understandlk-CHP-2">Chapter 2</a>).</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Identifies the model of the processor.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Loads the <tt class="calibre25">gdtr</tt><a name="IDX-APP-A-0033"></a> 
 and <tt class="calibre25">idtr</tt><a name="IDX-APP-A-0034"></a> 
 registers with the addresses of the GDT and IDT tables.</p></div></li><li class="calibre12"><div class="calibre45"><p class="docList">Jumps to the <tt class="calibre25">start_kernel( )</tt> function.</p></div></li></ol></div>

<br class="calibre7"/>

</div>

{% endraw %}

