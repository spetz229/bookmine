---
layout: page
title: "Understanding the Linux Kernel, 3rd Edition"
prev: understandlk-CHP-18-SECT-4.html
next: understandlk-CHP-18-SECT-6.html
book_path: books/understanding-the-linux-kernel-rd-edition_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<a name="understandlk-CHP-18-SECT-5"></a>
<h3 class="docSection1Title">18.5. Ext2 Methods</h3><a name="IDX-CHP-18-4391"></a>
<a name="IDX-CHP-18-4392"></a>
<a name="IDX-CHP-18-4393"></a>
<a name="IDX-CHP-18-4394"></a>
<a name="IDX-CHP-18-4395"></a>
<p class="docText1">Many of the VFS methods<a name="IDX-CHP-18-4396"></a> 
 described in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-12.html#understandlk-CHP-12">Chapter 12</a> have a corresponding Ext2 implementation. Because it would take a whole book to describe all of them, we limit ourselves to briefly reviewing the methods implemented in Ext2. Once the disk and the memory data structures are clearly understood, the reader should be able to follow the code of the Ext2 functions that implement them.</p>
<a name="understandlk-CHP-18-SECT-5.1"></a>
<h4 class="docSection2Title">18.5.1. Ext2 Superblock Operations</h4>
<p class="docText1">Many VFS superblock operations<a name="IDX-CHP-18-4397"></a> 
 have a specific implementation in Ext2, namely <tt class="calibre25">alloc_inode</tt>, <tt class="calibre25">destroy_inode</tt>, <tt class="calibre25">read_inode</tt>, <tt class="calibre25">write_inode</tt>, <tt class="calibre25">delete_inode</tt>, <tt class="calibre25">put_super</tt>, <tt class="calibre25">write_super</tt>, <tt class="calibre25">statfs</tt>, <tt class="calibre25">remount_fs</tt>, and <tt class="calibre25">clear_inode</tt>. The addresses of the superblock methods are stored in the <tt class="calibre25">ext2_sops</tt> array of pointers.</p>
<a name="understandlk-CHP-18-SECT-5.2"></a>
<h4 class="docSection2Title">18.5.2. Ext2 inode Operations</h4>
<p class="docText1">Some of the VFS inode operations<a name="IDX-CHP-18-4398"></a> 
 have a specific implementation in Ext2, which depends on the type of the file to which the inode refers.</p>
<p class="docText1">The inode operations for Ext2 regular files and Ext2 directories are shown in <a class="pcalibre5 docLink pcalibre1" href="#understandlk-CHP-18-TABLE-8">Table 18-8</a>; the purpose of each method is described in the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-12-SECT-2.html#understandlk-CHP-12-SECT-2.2">Inode Objects</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-12.html#understandlk-CHP-12">Chapter 12</a>. The table does not show the methods that are undefined (a <tt class="calibre25">NULL</tt> pointer) for both regular files and directories; recall that if a method is undefined, the VFS either invokes a generic function or does nothing at all. The addresses of the Ext2 methods for regular files and directories are stored in the <tt class="calibre25">ext2_file_inode_operations</tt> and <tt class="calibre25">ext2_dir_inode_operations</tt> tables, respectively.</p>
<a name="understandlk-CHP-18-TABLE-8"></a><p class="calibre14"><table cellspacing="0" frame="hsides" rules="all" cellpadding="4" width="100%" class="calibre15"><caption class="calibre33"><h5 class="docFigureTitle">Table 18-8. Ext2 inode operations for regular files and directories</h5></caption><colgroup class="calibre16"><col class="calibre17"/><col class="calibre17"/><col class="calibre17"/></colgroup><thead class="calibre18"><tr class="calibre34"><th class="thead" scope="col"><p class="docText1"><span class="calibre5">VFS inode operation</span></p></th><th class="thead" scope="col"><p class="docText1"><span class="calibre5">Regular file</span></p></th><th class="thead" scope="col"><p class="docText1"><span class="calibre5">Directory</span></p></th></tr></thead><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">create</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_create( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">lookup</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_lookup( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">link</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_link( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">unlink</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_unlink( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">symlink</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_symlink( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">mkdir</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_mkdir( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">rmdir</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_rmdir( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">mknod</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_mknod( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">rename</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_rename( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">truncate</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_TRuncate( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">permission</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_permission( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_permission( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">setattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_setattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_setattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">setxattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_setxattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_setxattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">getxattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_getxattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_getxattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">listxattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_listxattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_listxattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">removexattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_removexattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_removexattr( )</tt></p></td></tr></table></p><br class="calibre7"/>
<p class="docText1">The inode operations for Ext2 symbolic links are shown in <a class="pcalibre5 docLink pcalibre1" href="#understandlk-CHP-18-TABLE-9">Table 18-9</a> (undefined methods have been omitted). Actually, there are two types of symbolic links: the fast symbolic links represent pathnames that can be fully stored inside the inodes, while the regular symbolic links represent longer pathnames. Accordingly, there are two sets of inode operations, which are stored in the <tt class="calibre25">ext2_fast_symlink_inode_operations</tt> and <tt class="calibre25">ext2_symlink_inode_operations</tt> tables, respectively.</p>
<a name="understandlk-CHP-18-TABLE-9"></a><p class="calibre14"><table cellspacing="0" frame="hsides" rules="all" cellpadding="4" width="100%" class="calibre15"><caption class="calibre33"><h5 class="docFigureTitle">Table 18-9. Ext2 inode operations for fast and regular symbolic links</h5></caption><colgroup class="calibre16"><col class="calibre17"/><col class="calibre17"/><col class="calibre17"/></colgroup><thead class="calibre18"><tr class="calibre34"><th class="thead" scope="col"><p class="docText1"><span class="calibre5">VFS inode operation</span></p></th><th class="thead" scope="col"><p class="docText1"><span class="calibre5">Fast symbolic link</span></p></th><th class="thead" scope="col"><p class="docText1"><span class="calibre5">Regular symbolic link</span></p></th></tr></thead><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">readlink</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_readlink( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_readlink( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">follow_link</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_follow_link( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">page_follow_link_light( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">put_link</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">NULL</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">page_put_link( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">setxattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_setxattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_setxattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">getxattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_getxattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_getxattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">listxattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_listxattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_listxattr( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">removexattr</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_removexattr( )</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_removexattr( )</tt></p></td></tr></table></p><br class="calibre7"/>
<p class="docText1">If the inode refers to a character device file, to a block device file, or to a named pipe (see "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-19-SECT-2.html#understandlk-CHP-19-SECT-2">FIFOs</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-19.html#understandlk-CHP-19">Chapter 19</a>), the inode operations do not depend on the filesystem. They are specified in the <tt class="calibre25">chrdev_inode_operations</tt>, <tt class="calibre25">blkdev_inode_operations</tt>, and <tt class="calibre25">fifo_inode_operations</tt> tables, respectively.</p>
<a name="understandlk-CHP-18-SECT-5.3"></a>
<h4 class="docSection2Title">18.5.3. Ext2 File Operations</h4><a name="IDX-CHP-18-4399"></a>
<a name="IDX-CHP-18-4400"></a>
<a name="IDX-CHP-18-4401"></a>
<a name="IDX-CHP-18-4402"></a>
<a name="IDX-CHP-18-4403"></a>
<a name="IDX-CHP-18-4404"></a>
<a name="IDX-CHP-18-4405"></a>
<a name="IDX-CHP-18-4406"></a>
<a name="IDX-CHP-18-4407"></a>
<a name="IDX-CHP-18-4408"></a>
<a name="IDX-CHP-18-4409"></a>
<a name="IDX-CHP-18-4410"></a>
<a name="IDX-CHP-18-4411"></a>
<a name="IDX-CHP-18-4412"></a>
<a name="IDX-CHP-18-4413"></a>
<a name="IDX-CHP-18-4414"></a>
<a name="IDX-CHP-18-4415"></a>
<p class="docText1">The file operations<a name="IDX-CHP-18-4416"></a> 
 specific to the Ext2 filesystem are listed in <a class="pcalibre5 docLink pcalibre1" href="#understandlk-CHP-18-TABLE-10">Table 18-10</a>. As you can see, several VFS methods are implemented by generic functions that are common to many filesystems. The addresses of these methods are stored in the <tt class="calibre25">ext2_file_operations</tt> table.</p>
<a name="understandlk-CHP-18-TABLE-10"></a><p class="calibre14"><table cellspacing="0" frame="hsides" rules="all" cellpadding="4" width="100%" class="calibre15"><caption class="calibre33"><h5 class="docFigureTitle">Table 18-10. Ext2 file operations</h5></caption><colgroup class="calibre16"><col class="calibre17"/><col class="calibre17"/></colgroup><thead class="calibre18"><tr class="calibre34"><th class="thead" scope="col"><p class="docText1"><span class="calibre5">VFS file operation</span></p></th><th class="thead" scope="col"><p class="docText1"><span class="calibre5">Ext2 method</span></p></th></tr></thead><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">llseek</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_file_llseek( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">read</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_file_read( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">write</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_file_write( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2">aio_read</p></td><td class="docTableCell"><p class="docText2">generic_file_aio_read( )</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2">aio_write</p></td><td class="docTableCell"><p class="docText2">generic_file_aio_write( )</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">ioctl</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_ioctl( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">mmap</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_file_mmap( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">open</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">generic_file_open( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">release</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_release_file( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">fsync</tt></p></td><td class="docTableCell"><p class="docText2"><tt class="calibre25">ext2_sync_file( )</tt></p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2">readv</p></td><td class="docTableCell"><p class="docText2">generic_file_readv( )</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2">writev</p></td><td class="docTableCell"><p class="docText2">generic_file_writev( )</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2">sendfile</p></td><td class="docTableCell"><p class="docText2">generic_file_sendfile( )</p></td></tr></table></p><br class="calibre7"/>
<p class="docText1">Notice that the Ext2's <tt class="calibre25">read</tt> and <tt class="calibre25">write</tt> methods are implemented by the <tt class="calibre25">generic_file_read( )</tt> and <tt class="calibre25">generic_file_write( )</tt> functions, respectively. These are described in the sections "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-16-SECT-1.html#understandlk-CHP-16-SECT-1.1">Reading from a File</a>" and "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-16-SECT-1.html#understandlk-CHP-16-SECT-1.3">Writing to a File</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-16.html#understandlk-CHP-16">Chapter 16</a>.</p>
<a href="31071535.html"><img src="pixel.jpg" alt="" border="0" class="calibre19"/></a>
<br class="calibre7"/>

</div>

{% endraw %}

