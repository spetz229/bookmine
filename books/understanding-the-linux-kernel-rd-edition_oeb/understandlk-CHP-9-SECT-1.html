---
layout: page
title: "Understanding the Linux Kernel, 3rd Edition"
prev: understandlk-CHP-9.html
next: understandlk-CHP-9-SECT-2.html
book_path: books/understanding-the-linux-kernel-rd-edition_oeb/
---
{% include JB/setup %}
{% raw %}
<div>


<a name="understandlk-CHP-9-SECT-1"></a>
<h3 class="docSection1Title">9.1. The Process's Address Space</h3>
<p class="docText1">The <span class="docEmphasis">address space</span> of a process consists of all linear addresses that the process is allowed to use. Each process sees a different set of linear addresses; the address used by one process bears no relation to the address used by another. As we will see later, the kernel may dynamically modify a process address space by adding or removing intervals of linear addresses.</p>
<p class="docText1">The kernel represents intervals of linear addresses by means of resources called <span class="docEmphasis">memory regions</span><a name="IDX-CHP-9-2299"></a> 
, which are characterized by an initial linear address, a length, and some access rights. For reasons of efficiency, both the initial address and the length of a memory region must be multiples of 4,096, so that the data identified by each memory region completely fills up the page frames allocated to it. Following are some typical situations in which a process gets new memory regions:</p>
<ul class="calibre11"><li class="calibre12"><p class="docText1">When the user types a command at the console, the shell process creates a new process to execute the command. As a result, a fresh address space, and thus a set of memory regions, is assigned to the new process (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-9-SECT-5.html#understandlk-CHP-9-SECT-5">Creating and Deleting a Process Address Space</a>" later in this chapter; also, see <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-20.html#understandlk-CHP-20">Chapter 20</a>).</p></li><li class="calibre12"><p class="docText1">A running process may decide to load an entirely different program. In this case, the process ID remains unchanged, but the memory regions used before loading the program are released and a new set of memory regions is assigned to the process (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-20-SECT-4.html#understandlk-CHP-20-TABLE-7">The exec Functions</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-20.html#understandlk-CHP-20">Chapter 20</a>).</p></li><li class="calibre12"><p class="docText1">A running process may perform a "memory mapping" on a file (or on a portion of it). In such cases, the kernel assigns a new memory region to the process to map the file (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-16-SECT-2.html#understandlk-CHP-16-SECT-2">Memory Mapping</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-16.html#understandlk-CHP-16">Chapter 16</a>).</p></li><li class="calibre12"><p class="docText1">A process may keep adding data on its User Mode stack until all addresses in the memory region that map the stack have been used. In this case, the kernel may decide to expand the size of that memory region (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-9-SECT-4.html#understandlk-CHP-9-SECT-4">Page Fault Exception Handler</a>" later in this chapter).</p></li><li class="calibre12"><p class="docText1">A process may create an IPC-shared memory region to share data with other cooperating processes. In this case, the kernel assigns a new memory region to the process to implement this construct (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-19-SECT-3.html#understandlk-CHP-19-SECT-3.5">IPC Shared Memory</a>" in <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-19.html#understandlk-CHP-19">Chapter 19</a>).</p></li><li class="calibre12"><p class="docText1">A process may expand its dynamic area (the heap) through a function such as <tt class="calibre25">malloc( )</tt>. As a result, the kernel may decide to expand the size of the memory region assigned to the heap (see the section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-9-SECT-6.html#understandlk-CHP-9-SECT-6">Managing the Heap</a>" later in this chapter).</p></li></ul>
<p class="docText1"><a class="pcalibre5 docLink pcalibre1" href="#understandlk-CHP-9-TABLE-1">Table 9-1</a> illustrates some of the system calls related to the previously mentioned tasks. <tt class="calibre25">brk( )</tt> is discussed at the end of this chapter, while the remaining system calls are described in other chapters.</p>
<a name="understandlk-CHP-9-TABLE-1"></a><p class="calibre14"><table cellspacing="0" frame="hsides" rules="all" cellpadding="4" width="100%" class="calibre15"><caption class="calibre33"><h5 class="docFigureTitle">Table 9-1. System calls related to memory region creation and deletion</h5></caption><colgroup class="calibre16"><col class="calibre17"/><col class="calibre17"/></colgroup><thead class="calibre18"><tr class="calibre34"><th class="thead" scope="col"><p class="docText1"><span class="calibre5">System call</span></p></th><th class="thead" scope="col"><p class="docText1"><span class="calibre5">Description</span></p></th></tr></thead><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">brk( )</tt></p></td><td class="docTableCell"><p class="docText2">Changes the heap size of the process</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">execve( )</tt></p></td><td class="docTableCell"><p class="docText2">Loads a new executable file, thus changing the process address space</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">_exit( )</tt></p></td><td class="docTableCell"><p class="docText2">Terminates the current process and destroys its address space</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">fork( )</tt></p></td><td class="docTableCell"><p class="docText2">Creates a new process, and thus a new address space</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">mmap( )</tt>, <tt class="calibre25">mmap2( )</tt><a name="IDX-CHP-9-2300"></a>
</p></td><td class="docTableCell"><p class="docText2">Creates a memory mapping for a file, thus enlarging the process address space</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">mremap( )</tt></p></td><td class="docTableCell"><p class="docText2">Expands or shrinks a memory region</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">remap_file_pages( )</tt><a name="IDX-CHP-9-2301"></a>
</p></td><td class="docTableCell"><p class="docText2">Creates a non-linear mapping for a file (see <a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-16.html#understandlk-CHP-16">Chapter 16</a>)</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">munmap( )</tt></p></td><td class="docTableCell"><p class="docText2">Destroys a memory mapping for a file, thus contracting the process address space</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">shmat( )</tt></p></td><td class="docTableCell"><p class="docText2">Attaches a shared memory region</p></td></tr><tr class="calibre2"><td class="docTableCell"><p class="docText2"><tt class="calibre25">shmdt( )</tt></p></td><td class="docTableCell"><p class="docText2">Detaches a shared memory region</p></td></tr></table></p><br class="calibre7"/>
<p class="docText1">As we'll see in the later section "<a class="pcalibre5 docLink pcalibre1" href="understandlk-CHP-9-SECT-4.html#understandlk-CHP-9-SECT-4">Page Fault Exception Handler</a>," it is essential for the kernel to identify the memory regions currently owned by a process (the address space of a process), because that allows the Page Fault exception handler to efficiently distinguish between two types of invalid linear addresses that cause it to be invoked:</p>
<ul class="calibre11"><li class="calibre12"><p class="docText1">Those caused by programming errors.</p></li><li class="calibre12"><p class="docText1">Those caused by a missing page; even though the linear address belongs to the process's address space, the page frame corresponding to that address has yet to be allocated.</p></li></ul>
<p class="docText1">The latter addresses are not invalid from the process's point of view; the induced Page Faults are exploited by the kernel to implement demand paging<a name="IDX-CHP-9-2302"></a> 
: the kernel provides the missing page frame and lets the process continue.</p>

<br class="calibre7"/>

</div>

{% endraw %}

